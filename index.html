<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sintaxe da Luz | Lighting Design & Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'midnight': '#020617',     // Fundo principal (quase preto azulado)
                        'twilight': '#0f172a',     // Fundo secundário / Cards
                        'glass': 'rgba(15, 23, 42, 0.6)', // Vidro para painéis
                        'luminous-gold': '#FBBF24', // Dourado mais vibrante (Amber-400)
                        'muted-blue': '#94a3b8',   // Texto secundário (Slate-400)
                        'starlight': '#f8fafc'     // Branco suave
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                    },
                    backgroundImage: {
                        'blue-hour-gradient': 'linear-gradient(to bottom, #020617, #0f172a)',
                        'gold-glow': 'radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, rgba(2, 6, 23, 0) 70%)'
                    }
                }
            }
        }
    </script>

    <style>
        /* --- ESTILOS GLOBAIS --- */
        body {
            font-family: 'Manrope', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            /* Fundo sutil simulando o céu noturno */
            background: linear-gradient(180deg, #020617 0%, #0f172a 100%);
            letter-spacing: 0.5px;
            min-height: 100vh;
        }

        h1, h2, h3, h4, .nav-link, button, input { text-transform: uppercase !important; }

        /* --- GLASSMORPHISM UTILS --- */
        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .glass-input {
            background: rgba(2, 6, 23, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: #f8fafc;
            transition: all 0.3s ease;
        }
        .glass-input:focus {
            outline: none;
            border-color: #FBBF24;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.1);
            background: rgba(2, 6, 23, 0.8);
        }

        /* --- CUSTOM RANGE SLIDER (BLUE HOUR STYLE) --- */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        
        input[type=range]::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            height: 14px; 
            width: 14px; 
            border-radius: 50%; 
            background: #FBBF24; 
            cursor: pointer; 
            margin-top: -5px; 
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.8); 
            border: 2px solid #0f172a; 
        }
        
        input[type=range]::-webkit-slider-runnable-track { 
            width: 100%; 
            height: 4px; 
            cursor: pointer; 
            background: #1e293b; 
            border-radius: 2px; 
        }

        /* --- INPUTS NUMÉRICOS MINIMALISTAS --- */
        input[type=number] { 
            background-color: transparent; 
            color: #f8fafc; 
            border: none; 
            border-bottom: 1px solid #334155; 
            text-align: right; 
            width: 80px; 
            font-family: 'Manrope', sans-serif; 
            font-weight: 300; 
            -moz-appearance: textfield; 
        }
        input[type=number]:focus { outline: none; border-bottom: 1px solid #FBBF24; color: #FBBF24; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        /* --- RADIO BUTTONS PERSONALIZADOS --- */
        input[type="radio"] { 
            appearance: none; 
            background-color: transparent; 
            margin: 0; 
            font: inherit; 
            color: #FBBF24; 
            width: 1.15em; 
            height: 1.15em; 
            border: 1px solid #FBBF24; 
            border-radius: 50%; 
            display: grid; 
            place-content: center; 
        }
        input[type="radio"]::before { 
            content: ""; 
            width: 0.65em; 
            height: 0.65em; 
            background-color: #FBBF24; 
            border-radius: 50%; 
            transform: scale(0); 
            transition: 120ms transform ease-in-out; 
        }
        input[type="radio"]:checked::before { transform: scale(1); }

        /* Efeito de navegação */
        .nav-link { position: relative; font-size: 0.85rem; letter-spacing: 2px; color: #94a3b8; transition: color 0.3s; }
        .nav-link:hover { color: #FBBF24; text-shadow: 0 0 8px rgba(251, 191, 36, 0.4); }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 1px; bottom: -4px; left: 0; background-color: #FBBF24; transition: width 0.3s; }
        .nav-link:hover::after { width: 100%; }

        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Container do gráfico com gradiente sutil */
        .canvas-container { 
            background: linear-gradient(135deg, #0B1221 0%, #1e293b 100%);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        .blur-lock { filter: blur(12px) brightness(0.7); pointer-events: none; opacity: 0.4; transition: all 0.5s ease; }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-luminous-gold selection:text-midnight">

    <nav class="fixed w-full z-50 bg-midnight/80 backdrop-blur-xl border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)]">
                SINTAXE<span class="text-white font-light opacity-60">DALUZ</span>
            </a>
            
            <!-- Desktop Menu -->
            <div class="hidden md:flex gap-8 items-center">
                <a href="#calculadora" class="nav-link"><span data-i18n="nav_calculator">CALCULADORA</span> <i class="fas fa-unlock text-[10px] ml-1 text-luminous-gold drop-shadow-md" id="nav-lock-icon"></i></a>
                <a href="#conceito" class="nav-link text-luminous-gold" data-i18n="nav_concepts">CONCEITOS</a>
                
                <!-- Language Toggle -->
                <button onclick="toggleLanguage()" class="text-xs text-muted-blue hover:text-luminous-gold transition-colors font-bold tracking-widest border-l border-white/10 pl-4 ml-2">
                    <span class="lang-display">PT / EN</span>
                </button>

                <button id="btn-logout" onclick="handleLogout()" class="text-xs text-muted-blue hover:text-luminous-gold transition-colors tracking-widest ml-4 pl-4 border-l border-white/10" data-i18n="nav_logout">
                    LOGOUT
                </button>
            </div>

            <!-- Mobile Menu Button -->
            <div class="md:hidden text-luminous-gold text-2xl cursor-pointer" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </div>
        </div>

        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-midnight/95 backdrop-blur-xl border-b border-white/10 flex-col items-center py-6 space-y-6 shadow-2xl">
            <a href="#calculadora" class="text-sm tracking-widest text-starlight hover:text-luminous-gold transition-colors" onclick="toggleMobileMenu()"><span data-i18n="nav_calculator">CALCULADORA</span></a>
            <a href="#conceito" class="text-sm tracking-widest text-luminous-gold hover:text-white transition-colors" onclick="toggleMobileMenu()" data-i18n="nav_concepts">CONCEITOS</a>
            
            <button onclick="toggleLanguage(); toggleMobileMenu()" class="text-xs text-muted-blue hover:text-luminous-gold transition-colors font-bold tracking-widest border-t border-white/10 pt-4 w-1/2">
                <span class="lang-display">PT / EN</span>
            </button>

            <button id="btn-logout-mobile" onclick="handleLogout(); toggleMobileMenu()" class="text-xs text-muted-blue hover:text-luminous-gold transition-colors tracking-widest" data-i18n="nav_logout">
                LOGOUT
            </button>
        </div>
    </nav>

    <!-- SEÇÃO 1: CALCULADORA -->
    <section id="calculadora" class="pt-32 pb-20 px-4 md:px-8 relative min-h-[600px] overflow-hidden">
        
        <!-- Background Light Effect -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-gold-glow pointer-events-none opacity-40"></div>

        <div class="text-center mb-12 relative z-10 fade-in-up">
            <h1 class="text-base sm:text-2xl md:text-4xl lg:text-5xl font-bold mb-4 leading-tight whitespace-nowrap text-starlight drop-shadow-xl">
                <span data-i18n="hero_title_pre">A CALCULADORA DO</span> <span class="text-luminous-gold">LIGHTING DESIGNER</span>
            </h1>
            <h2 class="text-xl text-muted-blue font-bold tracking-widest mb-4 opacity-80" data-i18n="hero_subtitle">MÉTODO PONTO A PONTO</h2>
            
            <!-- License Status (Simulated Active) -->
            <div id="license-status" class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-green-500/30 bg-green-900/20 backdrop-blur-sm fade-in-up shadow-[0_0_15px_rgba(34,197,94,0.1)]">
                <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse box-shadow-[0_0_8px_rgba(74,222,128,0.8)]"></div>
                <span class="text-[10px] text-green-400 font-bold tracking-widest uppercase" id="license-date-text">CARREGANDO...</span>
            </div>
        </div>

        <!-- Lock Screen (Hidden for Demo) -->
        <div id="access-lock" class="hidden absolute inset-0 z-20 flex flex-col items-center justify-center pt-32 bg-midnight/70 backdrop-blur-md transition-all duration-700">
            <!-- Conteúdo de bloqueio oculto -->
        </div>

        <div id="calculator-interface" class="">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 max-w-7xl mx-auto w-full">

                <div class="lg:col-span-4 flex flex-col gap-6">
                    
                    <div class="glass-panel p-6 rounded-2xl relative h-full">
                        <div class="mb-4">
                            <h3 class="text-lg text-white mb-2 font-bold whitespace-nowrap text-center drop-shadow-md" data-i18n="calc_params">Parâmetros da Fonte</h3>
                            
                            <div class="flex flex-col sm:flex-row gap-4 p-1 mb-6 border-b border-white/10 pb-4 justify-center">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="calc_mode" value="direct" checked onchange="toggleMode('direct')">
                                    <span class="text-xs text-muted-blue group-hover:text-luminous-gold transition-colors font-bold" data-i18n="radio_intensity">Intensidade (cd)</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="calc_mode" value="photometric" onchange="toggleMode('photometric')">
                                    <span class="text-xs text-muted-blue group-hover:text-luminous-gold transition-colors font-bold" data-i18n="radio_photo">Fotometria (cd/klm)</span>
                                </label>
                            </div>
                        </div>

                        <div id="mode-direct" class="mb-6 group">
                            <div class="flex justify-between items-end mb-2">
                                <label class="text-xs text-luminous-gold tracking-widest font-bold" data-i18n="label_intensity">Intensidade (I)</label>
                                <div class="flex items-baseline gap-1">
                                    <input type="number" id="num-intensity" min="0" max="100000" step="10" value="3000">
                                    <span class="text-[10px] text-muted-blue font-bold">CD</span>
                                </div>
                            </div>
                            <input type="range" id="range-intensity" min="0" max="20000" step="10" value="3000">
                            <p class="text-[10px] text-muted-blue mt-1 font-light normal-case opacity-70" data-i18n="desc_intensity">Intensidade no centro do facho (candelas).</p>
                        </div>

                        <div id="mode-photometric" class="hidden mb-6 space-y-4">
                            <div class="group">
                                <div class="flex justify-between items-end mb-2">
                                    <label class="text-xs text-luminous-gold tracking-widest font-bold" data-i18n="label_curve">Valor Curva</label>
                                    <div class="flex items-baseline gap-1">
                                        <input type="number" id="num-cdklm" min="0" max="100000" step="10" value="2000">
                                        <span class="text-[10px] text-muted-blue font-bold">CD/KLM</span>
                                    </div>
                                </div>
                                <input type="range" id="range-cdklm" min="0" max="10000" step="10" value="2000">
                            </div>

                            <div class="group">
                                <div class="flex justify-between items-end mb-2">
                                    <label class="text-xs text-luminous-gold tracking-widest font-bold" data-i18n="label_flux">Fluxo Luminoso</label>
                                    <div class="flex items-baseline gap-1">
                                        <input type="number" id="num-flux" min="0" max="100000" step="10" value="1500">
                                        <span class="text-[10px] text-muted-blue font-bold">LM</span>
                                    </div>
                                </div>
                                <input type="range" id="range-flux" min="0" max="10000" step="10" value="1500">
                            </div>

                            <div class="border-t border-white/10 pt-3 flex justify-between items-center">
                                <span class="text-[10px] text-muted-blue font-light" data-i18n="label_calc_int">Intensidade Calculada</span>
                                <span id="calc-intensity-result" class="text-sm text-luminous-gold font-bold">3000 CD</span>
                            </div>
                        </div>

                        <hr class="border-white/10 my-6 border-dashed opacity-50">

                        <div class="mb-6 group">
                            <div class="flex justify-between items-end mb-2">
                                <label class="text-xs text-luminous-gold tracking-widest font-bold" data-i18n="label_height">Altura (h)</label>
                                <div class="flex items-baseline gap-1">
                                    <input type="number" id="num-height" min="0.5" max="20.0" step="0.1" value="3.0">
                                    <span class="text-[10px] text-muted-blue font-bold">M</span>
                                </div>
                            </div>
                            <input type="range" id="range-height" min="0.5" max="20.0" step="0.1" value="3.0">
                        </div>

                        <div class="mb-6 group">
                            <div class="flex justify-between items-end mb-2">
                                <label class="text-xs text-luminous-gold tracking-widest font-bold" data-i18n="label_beam">Abertura do Facho</label>
                                <div class="flex items-baseline gap-1">
                                    <input type="number" id="num-beam" min="5" max="120" step="1" value="30">
                                    <span class="text-[10px] text-muted-blue font-bold">°</span>
                                </div>
                            </div>
                            <input type="range" id="range-beam" min="5" max="120" step="1" value="30">
                        </div>

                        <div class="mb-2 group">
                            <div class="flex justify-between items-end mb-2">
                                <label class="text-xs text-luminous-gold tracking-widest font-bold" data-i18n="label_tilt">Orientação (Tilt)</label>
                                <div class="flex items-baseline gap-1">
                                    <input type="number" id="num-tilt" min="0" max="60" step="1" value="0">
                                    <span class="text-[10px] text-muted-blue font-bold">°</span>
                                </div>
                            </div>
                            <input type="range" id="range-tilt" min="0" max="60" step="1" value="0">
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-8 flex flex-col gap-6">
                    
                    <div class="glass-panel p-6 rounded-2xl flex-grow flex flex-col relative h-full">
                        
                        <h3 class="text-lg text-white mb-6 border-b border-white/10 pb-4 drop-shadow-md" data-i18n="result_title">RESULTADO</h3>
                        
                        <div class="relative w-full h-[400px] bg-twilight/50 border border-white/10 rounded-lg mb-6 overflow-hidden canvas-container shadow-inner">
                            <!-- Background Grid -->
                            <div class="absolute inset-0 opacity-10 pointer-events-none" 
                                 style="background-image: linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px); background-size: 40px 40px;">
                            </div>
                            
                            <canvas id="beamCanvas" class="w-full h-full relative z-10"></canvas>
                            <div class="absolute bottom-2 right-4 text-[10px] text-muted-blue font-mono opacity-60" data-i18n="canvas_scale">ESCALA 1:50 APROX.</div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            
                            <div class="bg-black/30 p-4 rounded-lg border-l-2 border-luminous-gold">
                                <div class="text-[10px] text-muted-blue uppercase tracking-widest mb-1" data-i18n="res_lux_title">Iluminância no Centro (E)</div>
                                <div class="flex items-baseline gap-2">
                                    <span id="result-lux" class="text-4xl text-starlight font-light">333</span>
                                    <span class="text-sm text-luminous-gold font-bold">LUX</span>
                                </div>
                                <p class="text-[10px] text-muted-blue mt-2 italic opacity-70" data-i18n="res_lux_desc">Resultado baseado nos parâmetros indicados.</p>
                            </div>

                            <div class="bg-black/30 p-4 rounded-lg border-l-2 border-slate-600">
                                <div class="text-[10px] text-muted-blue uppercase tracking-widest mb-1" data-i18n="res_dia_title">Diâmetro Estimado (Ø)</div>
                                <div class="flex items-baseline gap-2">
                                    <span id="result-diameter" class="text-4xl text-starlight font-light">1.61</span>
                                    <span class="text-sm text-luminous-gold font-bold">M</span>
                                </div>
                                <p class="text-[10px] text-muted-blue mt-2 italic opacity-70" data-i18n="res_dia_desc">Projeção da mancha de luz no nível do piso.</p>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

        </div>
    </section>

    <!-- SEÇÃO 2: CONCEITOS -->
    <section id="conceito" class="py-20 px-6 border-t border-white/5 bg-twilight/40">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-3xl text-luminous-gold font-bold tracking-widest mb-4 drop-shadow-[0_0_10px_rgba(251,191,36,0.3)]" data-i18n="concepts_title">CONCEITOS</h2>
                <p class="text-muted-blue font-light max-w-2xl mx-auto leading-relaxed" data-i18n="concepts_desc">
                    Baseada na trigonometria e fotometria clássica, apresentamos as equações fundamentais que garantem a fidelidade física desta simulação.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-panel p-8 rounded-2xl relative group hover:border-luminous-gold/30 transition-all duration-500">
                    <!-- Ícone Calculadora - Ajustado para maior visibilidade e brilho -->
                    <div class="absolute top-0 right-0 p-5 opacity-50 group-hover:opacity-100 transition-all duration-300 text-luminous-gold drop-shadow-[0_0_8px_rgba(251,191,36,0.6)]">
                        <i class="fas fa-calculator text-4xl"></i>
                    </div>
                    
                    <h3 class="text-starlight text-md font-bold mb-6 tracking-wider border-b border-luminous-gold/30 pb-2 inline-block" data-i18n="card1_title">INTENSIDADE ABSOLUTA</h3>
                    <p class="text-muted-blue text-xs mb-6 font-light leading-relaxed min-h-[60px]" data-i18n="card1_desc">Converte dados fotométricos relativos (comuns em catálogos) para intensidade absoluta (Candelas), normalizando pelo fluxo total.</p>
                    <div class="bg-black/40 p-4 rounded-lg border border-white/5 text-center mb-6 shadow-inner"><span class="text-xl font-serif text-luminous-gold italic font-medium">I = (Φ · γ) / 1000</span></div>
                    <ul class="text-xs text-muted-blue space-y-3 font-mono">
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">I</span> <span data-i18n="card1_i">Intensidade (cd)</span></li>
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">Φ</span> <span data-i18n="card1_flux">Fluxo Luminoso (lm)</span></li>
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">γ</span> <span data-i18n="card1_gamma">Valor Tabela (cd/klm)</span></li>
                    </ul>
                </div>

                <div class="glass-panel p-8 rounded-2xl relative group hover:border-luminous-gold/30 transition-all duration-500">
                    <!-- Ícone Lâmpada - Ajustado para maior visibilidade e brilho -->
                    <div class="absolute top-0 right-0 p-5 opacity-50 group-hover:opacity-100 transition-all duration-300 text-luminous-gold drop-shadow-[0_0_8px_rgba(251,191,36,0.6)]">
                        <i class="fas fa-lightbulb text-4xl"></i>
                    </div>

                    <h3 class="text-starlight text-md font-bold mb-6 tracking-wider border-b border-luminous-gold/30 pb-2 inline-block" data-i18n="card2_title">LEI DO COSSENO CÚBICO</h3>
                    <p class="text-muted-blue text-xs mb-6 font-light leading-relaxed min-h-[60px]" data-i18n="card2_desc">Variação da Lei do Inverso do Quadrado. Determina a iluminância horizontal (E) considerando a inclinação e a altura da fonte.</p>
                    <div class="bg-black/40 p-4 rounded-lg border border-white/5 text-center mb-6 shadow-inner"><span class="text-xl font-serif text-luminous-gold italic font-medium">E = (I · cos³θ) / h²</span></div>
                    <ul class="text-xs text-muted-blue space-y-3 font-mono">
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">E</span> <span data-i18n="card2_e">Iluminância (Lux)</span></li>
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">I</span> <span data-i18n="card2_i">Intensidade (cd)</span></li>
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">θ</span> <span data-i18n="card2_theta">Ângulo Tilt (°)</span></li>
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">h</span> <span data-i18n="card2_h">Altura (m)</span></li>
                    </ul>
                </div>

                <div class="glass-panel p-8 rounded-2xl relative group hover:border-luminous-gold/30 transition-all duration-500">
                    <!-- Ícone Régua - Ajustado para maior visibilidade e brilho -->
                    <div class="absolute top-0 right-0 p-5 opacity-50 group-hover:opacity-100 transition-all duration-300 text-luminous-gold drop-shadow-[0_0_8px_rgba(251,191,36,0.6)]">
                        <i class="fas fa-ruler-combined text-4xl"></i>
                    </div>

                    <h3 class="text-starlight text-md font-bold mb-6 tracking-wider border-b border-luminous-gold/30 pb-2 inline-block" data-i18n="card3_title">GEOMETRIA DO FACHO</h3>
                    <p class="text-muted-blue text-xs mb-6 font-light leading-relaxed min-h-[60px]" data-i18n="card3_desc">Cálculo trigonométrico do diâmetro da projeção (spot), considerando a distância real percorrida pela luz até o plano.</p>
                    <div class="bg-black/40 p-4 rounded-lg border border-white/5 text-center mb-6 shadow-inner"><span class="text-xl font-serif text-luminous-gold italic font-medium">Ø = 2 · d · tan(α/2)</span></div>
                    <ul class="text-xs text-muted-blue space-y-3 font-mono">
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">Ø</span> <span data-i18n="card3_dia">Diâmetro (m)</span></li>
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">d</span> <span data-i18n="card3_d">Distância (h/cosθ)</span></li>
                        <li class="flex justify-between border-b border-white/5 pb-1"><span class="text-white">α</span> <span data-i18n="card3_alpha">Abertura (°)</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-midnight py-12 px-6 border-t border-white/5 mt-auto">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left">
            <div>
                <a href="#" class="text-lg font-bold tracking-[0.2em] text-luminous-gold drop-shadow-sm">
                    SINTAXE<span class="text-white font-light opacity-60">DALUZ</span>
                </a>
                <p class="text-muted-blue text-xs mt-2">© 2026 Sintaxe da Luz. All rights reserved.</p>
            </div>
            <div class="flex gap-6 text-muted-blue">
                <a href="https://www.instagram.com/sintaxedaluz/" target="_blank" class="hover:text-luminous-gold transition-colors"><i class="fab fa-instagram"></i></a>
                <a href="mailto:sintaxedalux@gmail.com" class="hover:text-luminous-gold transition-colors"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // --- TRANSLATION DATA ---
        let currentLang = 'pt';
        
        const translations = {
            pt: {
                nav_concepts: "CONCEITOS",
                nav_calculator: "CALCULADORA",
                nav_logout: "LOGOUT",
                concepts_title: "CONCEITOS",
                concepts_desc: "Baseada na trigonometria e fotometria clássica, apresentamos as equações fundamentais que garantem a fidelidade física desta simulação.",
                card1_title: "INTENSIDADE ABSOLUTA",
                card1_desc: "Converte dados fotométricos relativos (comuns em catálogos) para intensidade absoluta (Candelas), normalizando pelo fluxo total.",
                card1_i: "Intensidade (cd)",
                card1_flux: "Fluxo Luminoso (lm)",
                card1_gamma: "Valor Tabela (cd/klm)",
                card2_title: "LEI DO COSSENO CÚBICO",
                card2_desc: "Variação da Lei do Inverso do Quadrado. Determina a iluminância horizontal (E) considerando a inclinação e a altura da fonte.",
                card2_e: "Iluminância (Lux)",
                card2_i: "Intensidade (cd)",
                card2_theta: "Ângulo Tilt (°)",
                card2_h: "Altura (m)",
                card3_title: "GEOMETRIA DO FACHO",
                card3_desc: "Cálculo trigonométrico do diâmetro da projeção (spot), considerando a distância real percorrida pela luz até o plano.",
                card3_dia: "Diâmetro (m)",
                card3_d: "Distância (h/cosθ)",
                card3_alpha: "Abertura (°)",
                hero_title_pre: "A CALCULADORA DO",
                hero_subtitle: "MÉTODO PONTO A PONTO",
                lock_title: "Área de Login",
                lock_desc: "Faça login para acessar o simulador ponto a ponto.",
                ph_password: "Senha",
                btn_login: "ENTRAR / DESBLOQUEAR",
                btn_signup: "CRIAR CONTA NOVA",
                btn_subscribe: "ASSINAR AGORA",
                btn_forgot: "Esqueci minha senha",
                calc_params: "Parâmetros da Fonte",
                radio_intensity: "Intensidade (cd)",
                radio_photo: "Fotometria (cd/klm)",
                label_intensity: "Intensidade (I)",
                desc_intensity: "Intensidade no centro do facho (candelas).",
                label_curve: "Valor Curva",
                label_flux: "Fluxo Luminoso",
                label_calc_int: "Intensidade Calculada",
                label_height: "Altura (h)",
                label_beam: "Abertura do Facho",
                label_tilt: "Orientação (Tilt)",
                result_title: "RESULTADO",
                canvas_scale: "ESCALA 1:50 APROX.",
                res_lux_title: "Iluminância no Centro (E)",
                res_lux_desc: "Resultado baseado nos parâmetros indicados.",
                res_dia_title: "Diâmetro Estimado (Ø)",
                res_dia_desc: "Projeção da mancha de luz no nível do piso.",
                lic_active_pre: "LICENÇA VÁLIDA ATÉ:",
                lic_expired: "LICENÇA EXPIRADA",
                lic_free: "VERSÃO GRATUITA (BLOQUEADA)",
                loading: "CARREGANDO..."
            },
            en: {
                nav_concepts: "CONCEPTS",
                nav_calculator: "CALCULATOR",
                nav_logout: "LOGOUT",
                concepts_title: "CONCEPTS",
                concepts_desc: "Based on classical trigonometry and photometry, we present the fundamental equations that ensure the physical fidelity of this simulation.",
                card1_title: "ABSOLUTE INTENSITY",
                card1_desc: "Converts relative photometric data (common in catalogs) to absolute intensity (Candelas), normalized by total flux.",
                card1_i: "Intensity (cd)",
                card1_flux: "Luminous Flux (lm)",
                card1_gamma: "Table Value (cd/klm)",
                card2_title: "CUBIC COSINE LAW",
                card2_desc: "Variation of the Inverse Square Law. Determines horizontal illuminance (E) considering the source inclination and height.",
                card2_e: "Illuminance (Lux)",
                card2_i: "Intensity (cd)",
                card2_theta: "Tilt Angle (°)",
                card2_h: "Height (m)",
                card3_title: "BEAM GEOMETRY",
                card3_desc: "Trigonometric calculation of the projection diameter (spot), considering the actual distance traveled by light to the plane.",
                card3_dia: "Diameter (m)",
                card3_d: "Distance (h/cosθ)",
                card3_alpha: "Beam Angle (°)",
                hero_title_pre: "THE LIGHTING DESIGNER'S",
                hero_subtitle: "POINT BY POINT METHOD",
                lock_title: "Login Area",
                lock_desc: "Log in to access the point-by-point simulator.",
                ph_password: "Password",
                btn_login: "ENTER / UNLOCK",
                btn_signup: "CREATE NEW ACCOUNT",
                btn_subscribe: "SUBSCRIBE NOW",
                btn_forgot: "Forgot my password",
                calc_params: "Source Parameters",
                radio_intensity: "Intensity (cd)",
                radio_photo: "Photometry (cd/klm)",
                label_intensity: "Intensity (I)",
                desc_intensity: "Intensity at the center of the beam (candelas).",
                label_curve: "Curve Value",
                label_flux: "Luminous Flux",
                label_calc_int: "Calculated Intensity",
                label_height: "Height (h)",
                label_beam: "Beam Angle",
                label_tilt: "Tilt",
                result_title: "RESULT",
                canvas_scale: "APPROX SCALE 1:50",
                res_lux_title: "Center Illuminance (E)",
                res_lux_desc: "Result based on indicated parameters.",
                res_dia_title: "Estimated Diameter (Ø)",
                res_dia_desc: "Light spot projection at floor level.",
                lic_active_pre: "LICENSE VALID UNTIL:",
                lic_expired: "LICENSE EXPIRED",
                lic_free: "FREE VERSION (LOCKED)",
                loading: "LOADING..."
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'pt' ? 'en' : 'pt';
            document.querySelectorAll('.lang-display').forEach(el => el.innerText = currentLang === 'pt' ? 'PT / EN' : 'EN / PT');
            
            // Update simple text elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    el.innerText = translations[currentLang][key];
                }
            });

            // Update placeholders
            document.querySelectorAll('[data-i18n-ph]').forEach(el => {
                const key = el.getAttribute('data-i18n-ph');
                if (translations[currentLang][key]) {
                    el.placeholder = translations[currentLang][key];
                }
            });

            // Update Dynamic Content (License Display)
            if (state.profile) {
                updateLicenseDisplay(state.profile);
            } else {
                document.getElementById('license-date-text').innerText = translations[currentLang].loading;
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('flex');
        }

        // --- CREDENCIAIS DO SUPABASE ---
        const SUPABASE_URL = 'https://ozytwdhuxsdefnunzinm.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_DSLOW6cRyUKlRj-k4MWZGw_2SGACdnh';
        
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const state = {
            user: null,
            profile: null,
            mode: 'direct', 
            intensity: 3000,
            cdKlm: 2000,
            flux: 1500,
            height: 3.0,
            beamAngle: 30,
            tilt: 0
        };

        // --- AUTENTICAÇÃO E PERFIL (MODO DEMO PREMIUM) ---

        async function checkSession() {
            // SIMULAÇÃO: Forçar estado logado e premium
            console.log("Modo Demo: Simulando usuário Premium");
            
            state.user = { id: 'demo_user' };
            state.profile = { 
                is_pro: true, 
                license_expiry: '2027-12-31', // Data futura
                isValid: true 
            };
            
            updateLicenseDisplay(state.profile);
            unlockInterface(false);
        }

        async function loadUserProfile(userId, animate = false) {
            // No modo demo, ignoramos o carregamento real do banco
            // e usamos os dados já definidos em checkSession
            if (state.profile) {
                updateLicenseDisplay(state.profile);
                if (state.profile.isValid) {
                    unlockInterface(animate);
                } else {
                    lockInterface();
                }
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            // Simulação de login bem-sucedido
            state.user = { id: 'demo_user' };
            state.profile = { is_pro: true, license_expiry: '2027-12-31', isValid: true };
            unlockInterface(true);
            updateLicenseDisplay(state.profile);
        }

        async function handleSignUp() {
            alert(currentLang === 'pt' ? "Cadastro realizado (simulação)!" : "Registration successful (simulation)!");
        }

        async function handleForgotPassword() {
            alert(currentLang === 'pt' ? "Verifique seu e-mail (simulação)!" : "Check your email (simulation)!");
        }

        async function handleLogout() {
            state.user = null;
            state.profile = null;
            lockInterface();
        }

        // --- UI CONTROL ---

        function unlockInterface(animate) {
            const lockScreen = document.getElementById('access-lock');
            const interface = document.getElementById('calculator-interface');
            const logoutBtn = document.getElementById('btn-logout');
            const logoutBtnMobile = document.getElementById('btn-logout-mobile');
            const lockIcon = document.getElementById('nav-lock-icon');
            const licenseStatus = document.getElementById('license-status');

            if (animate) {
                lockScreen.style.opacity = "0";
                setTimeout(() => { finalizeUnlock(); }, 500);
            } else {
                finalizeUnlock();
            }

            function finalizeUnlock() {
                lockScreen.classList.add('hidden');
                interface.classList.remove('blur-lock');
                logoutBtn.classList.remove('hidden');
                logoutBtnMobile.classList.remove('hidden');
                licenseStatus.classList.remove('hidden');
                licenseStatus.classList.add('inline-flex');
                lockIcon.className = "fas fa-unlock text-[10px] ml-1 text-luminous-gold drop-shadow-md";
                resizeCanvas();
            }
        }

        function lockInterface() {
            const lockScreen = document.getElementById('access-lock');
            const interface = document.getElementById('calculator-interface');
            const logoutBtn = document.getElementById('btn-logout');
            const logoutBtnMobile = document.getElementById('btn-logout-mobile');
            const lockIcon = document.getElementById('nav-lock-icon');
            const licenseStatus = document.getElementById('license-status');

            lockScreen.classList.remove('hidden');
            setTimeout(() => { lockScreen.style.opacity = "1"; }, 10);
            interface.classList.add('blur-lock');
            logoutBtn.classList.add('hidden');
            logoutBtnMobile.classList.add('hidden');
            licenseStatus.classList.add('hidden');
            licenseStatus.classList.remove('inline-flex');
            lockIcon.className = "fas fa-lock text-[10px] ml-1 text-muted-blue";
        }

        function updateLicenseDisplay(profile) {
            const el = document.getElementById('license-date-text');
            const statusDiv = document.getElementById('license-status');
            const t = translations[currentLang];
            
            const activeClass = "inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-green-500/30 bg-green-900/20 backdrop-blur-sm fade-in-up shadow-[0_0_15px_rgba(34,197,94,0.1)]";
            const expiredClass = "inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-red-500/30 bg-red-900/20 backdrop-blur-sm fade-in-up shadow-[0_0_15px_rgba(239,68,68,0.1)]";
            const freeClass = "inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-gray-600/30 bg-gray-800/20 backdrop-blur-sm fade-in-up";

            if (profile.isValid && profile.license_expiry) {
                const dateParts = profile.license_expiry.split('-');
                const formattedDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
                
                el.innerText = `${t.lic_active_pre} ${formattedDate}`;
                
                statusDiv.className = activeClass;
                statusDiv.innerHTML = `
                    <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse shadow-[0_0_8px_rgba(74,222,128,0.8)]"></div>
                    <span class="text-[10px] text-green-400 font-bold tracking-widest uppercase">${el.innerText}</span>
                `;
            } else if (profile.is_pro && !profile.isValid) {
                statusDiv.className = expiredClass;
                statusDiv.innerHTML = `
                    <div class="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8)]"></div>
                    <span class="text-[10px] text-red-500 font-bold tracking-widest uppercase">${t.lic_expired}</span>
                `;
            } else {
                statusDiv.className = freeClass;
                statusDiv.innerHTML = `
                    <span class="text-[10px] text-muted-blue font-bold tracking-widest uppercase">${t.lic_free}</span>
                `;
            }
            statusDiv.classList.remove('hidden');
            statusDiv.classList.add('inline-flex');
        }

        // --- CORE CALCULATOR LOGIC ---
        const els = {
            modeDirect: document.getElementById('mode-direct'),
            modePhoto: document.getElementById('mode-photometric'),
            numIntensity: document.getElementById('num-intensity'),
            rangeIntensity: document.getElementById('range-intensity'),
            numCdKlm: document.getElementById('num-cdklm'),
            rangeCdKlm: document.getElementById('range-cdklm'),
            numFlux: document.getElementById('num-flux'),
            rangeFlux: document.getElementById('range-flux'),
            numHeight: document.getElementById('num-height'),
            rangeHeight: document.getElementById('range-height'),
            numBeam: document.getElementById('num-beam'),
            rangeBeam: document.getElementById('range-beam'),
            numTilt: document.getElementById('num-tilt'),
            rangeTilt: document.getElementById('range-tilt'),
            calcIntensity: document.getElementById('calc-intensity-result'),
            resLux: document.getElementById('result-lux'),
            resDia: document.getElementById('result-diameter'),
            canvas: document.getElementById('beamCanvas')
        };

        const ctx = els.canvas.getContext('2d');
        let canvasWidth, canvasHeight;

        function resizeCanvas() {
            if (!els.canvas.offsetParent) return;
            const container = els.canvas.parentElement;
            canvasWidth = container.clientWidth;
            canvasHeight = container.clientHeight;
            els.canvas.width = canvasWidth;
            els.canvas.height = canvasHeight;
            draw();
        }

        window.addEventListener('resize', resizeCanvas);

        function toggleMode(mode) {
            state.mode = mode;
            if (mode === 'direct') {
                els.modeDirect.classList.remove('hidden');
                els.modePhoto.classList.add('hidden');
            } else {
                els.modeDirect.classList.add('hidden');
                els.modePhoto.classList.remove('hidden');
            }
            updateCalculations();
        }

        function calculateLux() {
            let I = 0;
            if (state.mode === 'direct') {
                I = state.intensity;
            } else {
                I = (state.flux * state.cdKlm) / 1000;
                els.calcIntensity.innerText = Math.round(I) + ' CD';
            }

            const tiltRad = state.tilt * (Math.PI / 180);
            const cosTilt = Math.cos(tiltRad);
            const lux = (I * Math.pow(cosTilt, 3)) / (state.height * state.height);
            
            const beamRad = state.beamAngle * (Math.PI / 180);
            const distance = state.height / cosTilt;
            const diameter = 2 * distance * Math.tan(beamRad / 2);

            return {
                lux: Math.round(lux),
                diameter: diameter.toFixed(2)
            };
        }

        function updateCalculations() {
            const results = calculateLux();
            els.resLux.innerText = results.lux;
            els.resDia.innerText = results.diameter;
            draw();
        }

        function draw() {
            if (!ctx || !canvasWidth || !canvasHeight) return;
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            const floorY = canvasHeight - 70; 
            const centerX = canvasWidth / 2;
            
            const tiltRad = state.tilt * (Math.PI / 180);
            const beamRad = state.beamAngle * (Math.PI / 180);
            
            const angleL = tiltRad - beamRad / 2;
            const angleR = tiltRad + beamRad / 2;
            
            const limitAngle = 85 * (Math.PI / 180);
            const effAngleL = Math.max(-limitAngle, Math.min(limitAngle, angleL));
            const effAngleR = Math.max(-limitAngle, Math.min(limitAngle, angleR));
            
            const distL_m = state.height * Math.tan(effAngleL);
            const distR_m = state.height * Math.tan(effAngleR);
            const maxWidthFromCenter_m = Math.max(Math.abs(distL_m), Math.abs(distR_m));
            
            const availableHeightPx = floorY - 60;
            const scaleH = availableHeightPx / state.height;
            const availableWidthPx = centerX - 40;
            const scaleW = maxWidthFromCenter_m > 0.1 ? availableWidthPx / maxWidthFromCenter_m : 100;
            
            let scalePixelsPerMeter = Math.min(scaleH, scaleW);
            scalePixelsPerMeter = Math.min(Math.max(scalePixelsPerMeter, 2), 40);
            
            const sourceY = floorY - (state.height * scalePixelsPerMeter);
            
            // Floor with subtle glow
            ctx.beginPath();
            ctx.moveTo(0, floorY);
            ctx.lineTo(canvasWidth, floorY);
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Height indicator
            ctx.beginPath();
            ctx.setLineDash([2, 4]);
            ctx.moveTo(centerX - 100, sourceY);
            ctx.lineTo(centerX - 10, sourceY);
            ctx.strokeStyle = '#475569';
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.font = "12px Manrope";
            ctx.fillStyle = "#94a3b8";
            ctx.fillText(`${state.height}m`, centerX - 130, sourceY + 3);

            const h_px = floorY - sourceY;
            const xL = h_px * Math.tan(effAngleL);
            const xR = h_px * Math.tan(effAngleR);
            
            ctx.save();
            ctx.translate(centerX, sourceY);
            
            // Light Source
            ctx.beginPath();
            ctx.arc(0, 0, 6, 0, Math.PI*2);
            ctx.fillStyle = '#FBBF24';
            ctx.shadowColor = '#FBBF24';
            ctx.shadowBlur = 15;
            ctx.fill();
            ctx.shadowBlur = 0; // Reset shadow

            // Beam
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(xL, h_px);
            ctx.lineTo(xR, h_px);
            ctx.closePath();
            
            if (Number.isFinite(h_px)) {
                const gradient = ctx.createLinearGradient(0, 0, 0, h_px);
                // Adjust colors for blue hour theme
                gradient.addColorStop(0, "rgba(251, 191, 36, 0.7)"); // Amber 400
                gradient.addColorStop(1, "rgba(251, 191, 36, 0.05)"); 
                ctx.fillStyle = gradient;
                ctx.fill();
            }
            
            const xC = h_px * Math.tan(tiltRad);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(xC, h_px);
            ctx.strokeStyle = "rgba(255, 255, 255, 0.2)";
            ctx.setLineDash([5, 5]);
            ctx.stroke();

            ctx.restore();
            
            // Spot projection
            ctx.beginPath();
            ctx.moveTo(centerX + xL, floorY);
            ctx.lineTo(centerX + xR, floorY);
            ctx.lineWidth = 4;
            ctx.strokeStyle = "rgba(251, 191, 36, 0.9)";
            ctx.shadowColor = "rgba(251, 191, 36, 0.5)";
            ctx.shadowBlur = 10;
            ctx.stroke();
            ctx.shadowBlur = 0;
            
            const spotCenter = centerX + (xL + xR) / 2;
            
            const currentLux = document.getElementById('result-lux').innerText;
            ctx.fillStyle = "#fff";
            ctx.font = "bold 10px Manrope";
            ctx.textAlign = "center";
            ctx.fillText(currentLux + " LUX", spotCenter, floorY - 12);

            // Dimensions logic same as before but colors adapted
            const currentDia = document.getElementById('result-diameter').innerText;
            const dimY_Dia = floorY + 15;
            const textDia = "Ø " + currentDia + "m";

            ctx.beginPath();
            ctx.strokeStyle = "#94a3b8"; // Slate 400
            ctx.lineWidth = 1;
            ctx.setLineDash([]);
            ctx.moveTo(centerX + xL, floorY + 5);
            ctx.lineTo(centerX + xL, dimY_Dia + 5);
            ctx.moveTo(centerX + xR, floorY + 5);
            ctx.lineTo(centerX + xR, dimY_Dia + 5);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(centerX + xL, dimY_Dia);
            ctx.lineTo(centerX + xR, dimY_Dia);
            ctx.stroke();

            ctx.font = "12px Manrope";
            const widthDia = ctx.measureText(textDia).width;
            ctx.fillStyle = "#0f172a"; // Background to clear line
            ctx.fillRect(spotCenter - widthDia/2 - 4, dimY_Dia - 6, widthDia + 8, 12);
            ctx.fillStyle = "#94a3b8";
            ctx.fillText(textDia, spotCenter, dimY_Dia + 4);

            if (state.tilt > 0) {
                const distM = state.height * Math.tan(tiltRad);
                const dimY_Dist = floorY + 35;
                const textDist = "d: " + distM.toFixed(2) + "m";
                
                const xC_scale = (state.height * scalePixelsPerMeter) * Math.tan(tiltRad);
                
                ctx.beginPath();
                ctx.strokeStyle = "#94a3b8";
                ctx.lineWidth = 1;

                ctx.moveTo(centerX, floorY + 10);
                ctx.lineTo(centerX, dimY_Dist + 5);
                
                ctx.moveTo(centerX + xC_scale, floorY + 10);
                ctx.lineTo(centerX + xC_scale, dimY_Dist + 5);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(centerX, dimY_Dist);
                ctx.lineTo(centerX + xC_scale, dimY_Dist);
                ctx.stroke();

                ctx.fillStyle = "#94a3b8";
                ctx.beginPath();
                ctx.arc(centerX, dimY_Dist, 2, 0, Math.PI * 2);
                ctx.arc(centerX + xC_scale, dimY_Dist, 2, 0, Math.PI * 2);
                ctx.fill();

                ctx.font = "12px Manrope";
                const widthDist = ctx.measureText(textDist).width;
                ctx.fillStyle = "#0f172a";
                ctx.fillRect(centerX + (xC_scale / 2) - (widthDist / 2) - 4, dimY_Dist - 6, widthDist + 8, 12);
                
                ctx.fillStyle = "#94a3b8";
                ctx.fillText(textDist, centerX + (xC_scale / 2), dimY_Dist + 4);
            }
        }

        // --- Event Listeners Setup ---

        function bindInput(numId, rangeId, key) {
            const num = document.getElementById(numId);
            const range = document.getElementById(rangeId);
            
            num.addEventListener('input', (e) => {
                let val = parseFloat(e.target.value);
                range.value = val;
                state[key] = val;
                updateCalculations();
            });
            
            range.addEventListener('input', (e) => {
                let val = parseFloat(e.target.value);
                num.value = val;
                state[key] = val;
                updateCalculations();
            });
        }

        bindInput('num-intensity', 'range-intensity', 'intensity');
        bindInput('num-cdklm', 'range-cdklm', 'cdKlm');
        bindInput('num-flux', 'range-flux', 'flux');
        bindInput('num-height', 'range-height', 'height');
        bindInput('num-beam', 'range-beam', 'beamAngle');
        bindInput('num-tilt', 'range-tilt', 'tilt');

        resizeCanvas(); 
        updateCalculations();
        
        window.toggleMode = toggleMode;

        // Auto-check session on load
        checkSession();

    </script>
</body>
</html>