<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxSintax | Lighting Design SaaS (BETA)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'midnight': '#020617',
                        'twilight': '#0f172a',
                        'glass': 'rgba(15, 23, 42, 0.6)',
                        'luminous-gold': '#FBBF24',
                        'tech-cyan': '#22d3ee',
                        'dim-gray': '#94a3b8',
                        'dim-line': '#cbd5e1',
                        'starlight': '#f8fafc',
                        'leed-green': '#84cc16'
                    },
                    fontFamily: { sans: ['Manrope', 'sans-serif'] },
                    backgroundImage: {
                        'blue-hour-gradient': 'linear-gradient(to bottom, #020617, #0f172a)',
                        'gold-glow': 'radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, rgba(2, 6, 23, 0) 70%)'
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Manrope', sans-serif; background-color: #020617; color: #f8fafc; background: linear-gradient(180deg, #020617 0%, #0f172a 100%); letter-spacing: 0.5px; min-height: 100vh; }
        h1, h2, h3, h4, .nav-link, button, input, label, select { text-transform: uppercase !important; }
        .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(148, 163, 184, 0.1); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: #FBBF24; cursor: pointer; margin-top: -5px; box-shadow: 0 0 10px rgba(251, 191, 36, 0.8); border: 2px solid #0f172a; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #1e293b; border-radius: 2px; }
        input[type=number], select, input[type=text], input[type=email], input[type=password] { background-color: transparent; color: #f8fafc; border: none; border-bottom: 1px solid #334155; width: 100%; padding: 8px 0; }
        input:focus { outline: none; border-bottom: 1px solid #FBBF24 !important; color: #FBBF24; }
        .calc-input { text-align: right !important; width: 65px !important; }
        .nav-link { position: relative; font-size: 0.85rem; letter-spacing: 2px; color: #94a3b8; transition: color 0.3s; }
        .nav-link:hover { color: #FBBF24; }
        .app-locked { filter: blur(12px) grayscale(0.6); pointer-events: none; user-select: none; overflow: hidden; height: 100vh; }
        .tab-active { border-bottom: 2px solid #FBBF24 !important; color: #FBBF24 !important; }
        .tab-inactive { color: #94a3b8 !important; opacity: 0.6; }
        .mode-tab-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 20px; min-width: 130px; height: 90px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05); background: rgba(255, 255, 255, 0.02); transition: all 0.3s ease; }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-luminous-gold selection:text-midnight">

    <div id="auth-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-midnight/90 backdrop-blur-md"></div>
        <div class="glass-panel w-full max-w-md p-8 rounded-2xl relative z-10 border border-luminous-gold/20">
            <div class="text-center mb-8">
                <div class="text-2xl font-bold tracking-[0.2em] text-luminous-gold mb-2">LUX<span class="text-white font-light opacity-60">SINTAX</span></div>
                <p class="text-[10px] text-dim-gray uppercase tracking-widest">Inteligência em Iluminação</p>
            </div>
            <div class="flex border-b border-white/10 mb-6">
                <button onclick="AuthManager.switchTab('login')" id="tab-auth-login" class="flex-1 py-3 text-xs font-bold uppercase text-luminous-gold border-b-2 border-luminous-gold">Login</button>
                <button onclick="AuthManager.switchTab('register')" id="tab-auth-register" class="flex-1 py-3 text-xs font-bold uppercase text-dim-gray">Cadastro</button>
            </div>
            <div id="form-login" class="space-y-6">
                <input type="email" id="login-email" placeholder="E-MAIL">
                <input type="password" id="login-password" placeholder="SENHA">
                <button onclick="AuthManager.handleLogin()" class="w-full py-4 bg-luminous-gold text-midnight font-bold rounded-lg uppercase tracking-widest text-xs hover:bg-white transition-colors">Acessar</button>
            </div>
            <div id="form-register" class="space-y-5 hidden">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="reg-name" placeholder="NOME">
                    <input type="text" id="reg-surname" placeholder="SOBRENOME">
                </div>
                <input type="email" id="reg-email" placeholder="E-MAIL CORPORATIVO">
                <input type="password" id="reg-password" placeholder="CRIAR SENHA">
                <div class="flex items-start gap-2">
                    <input type="checkbox" id="reg-terms" class="mt-1 accent-luminous-gold">
                    <label class="text-[9px] text-dim-gray">Concordo com os termos e coleta de dados.</label>
                </div>
                <button onclick="AuthManager.handleRegister()" class="w-full py-4 border border-luminous-gold text-luminous-gold font-bold rounded-lg uppercase tracking-widest text-xs hover:bg-luminous-gold hover:text-midnight transition-colors">Criar Conta</button>
            </div>
        </div>
    </div>

    <div id="app-content" class="transition-all duration-700 app-locked">
        <nav class="fixed w-full z-50 bg-midnight/90 backdrop-blur-xl border-b border-white/5">
            <div class="max-w-[1800px] mx-auto px-6 py-4 flex justify-between items-center">
                <div class="text-xl font-bold tracking-[0.2em] text-luminous-gold">LUX<span class="text-white font-light opacity-60">SINTAX</span></div>
                <div id="user-display" class="flex items-center gap-4">
                    <span id="user-name-display" class="text-[10px] font-bold text-white uppercase">Usuário</span>
                    <button onclick="AuthManager.logout()" class="text-[9px] text-red-400 font-bold uppercase">Sair</button>
                </div>
            </div>
        </nav>

        <section id="calculadora" class="pt-24 pb-10 px-8 min-h-screen">
            <div class="max-w-[1800px] mx-auto">
                <div class="flex gap-4 mb-8 overflow-x-auto pb-2">
                    <button onclick="switchTool('query')" id="tab-query" class="mode-tab-btn tab-active"><i class="fas fa-search"></i><span>CONSULTA</span></button>
                    <button onclick="switchTool('ponto')" id="tab-ponto" class="mode-tab-btn tab-inactive"><i class="fas fa-grip-lines"></i><span>HORIZONTAL</span></button>
                    <button onclick="switchTool('vertical')" id="tab-vertical" class="mode-tab-btn tab-inactive"><i class="fas fa-grip-lines-vertical"></i><span>VERTICAL</span></button>
                </div>

                <div id="calculator-interface" class="grid grid-cols-12 gap-8">
                    <div id="calc-inputs-panel" class="col-span-12 lg:col-span-3 hidden">
                        <div class="glass-panel p-6 rounded-2xl sticky top-24">
                            <h3 class="text-xs font-bold text-white mb-6 border-b border-white/10 pb-2">Parâmetros</h3>
                            <div id="inputs-container"></div> </div>
                    </div>
                    <div id="calc-viz-panel" class="col-span-12 lg:col-span-9 hidden">
                        <div class="glass-panel p-6 rounded-2xl min-h-[600px] flex flex-col">
                            <canvas id="beamCanvas" class="w-full flex-grow bg-midnight/40 rounded-xl"></canvas>
                        </div>
                    </div>
                    <div id="query-panel" class="col-span-12">
                        <div class="glass-panel p-6 rounded-2xl">
                            <table class="w-full text-left">
                                <thead class="text-[10px] text-dim-gray uppercase border-b border-white/10">
                                    <tr><th class="p-4">Ambiente</th><th class="p-4">Lux (Em)</th><th class="p-4">UGR</th><th class="p-4">Ra</th></tr>
                                </thead>
                                <tbody id="norms-body" class="text-sm text-dim-line"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // CONFIG SUPABASE
        const SUPABASE_URL = 'https://ozytwdhuxsdefnunzinm.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96eXR3ZGh1eHNkZWZudW56aW5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NjM2MjEsImV4cCI6MjA4NjIzOTYyMX0.G6d564WnaaUQVSjTjpCDEA4d6zaVMvB_NQpo1KtE24s';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // AUTH MANAGER
        const AuthManager = {
            init: async function() {
                const { data: { session } } = await supabase.auth.getSession();
                this.handleSessionUpdate(session);
                supabase.auth.onAuthStateChange((_event, session) => this.handleSessionUpdate(session));
            },
            handleSessionUpdate: function(session) {
                if (session) {
                    document.getElementById('user-name-display').innerText = (session.user.user_metadata.first_name || "Membro").toUpperCase();
                    this.unlockApp();
                } else {
                    this.lockApp();
                }
            },
            lockApp: () => { document.getElementById('auth-modal').classList.remove('hidden'); document.getElementById('app-content').classList.add('app-locked'); },
            unlockApp: () => { document.getElementById('auth-modal').classList.add('hidden'); document.getElementById('app-content').classList.remove('app-locked'); },
            switchTab: (tab) => {
                const isLogin = tab === 'login';
                document.getElementById('form-login').classList.toggle('hidden', !isLogin);
                document.getElementById('form-register').classList.toggle('hidden', isLogin);
                document.getElementById('tab-auth-login').className = isLogin ? "flex-1 py-3 text-xs font-bold uppercase text-luminous-gold border-b-2 border-luminous-gold" : "flex-1 py-3 text-xs font-bold uppercase text-dim-gray";
                document.getElementById('tab-auth-register').className = !isLogin ? "flex-1 py-3 text-xs font-bold uppercase text-luminous-gold border-b-2 border-luminous-gold" : "flex-1 py-3 text-xs font-bold uppercase text-dim-gray";
            },
            handleLogin: async () => {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) alert(error.message);
            },
            handleRegister: async function() {
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                const first_name = document.getElementById('reg-name').value;
                const last_name = document.getElementById('reg-surname').value;
                if (!document.getElementById('reg-terms').checked) return alert("Aceite os termos.");

                const { data, error } = await supabase.auth.signUp({
                    email, password, options: { data: { first_name, last_name } }
                });

                if (error) alert(error.message);
                else if (data.session) {
                    alert("Bem-vindo ao LuxSintax! Acesso liberado.");
                    this.unlockApp();
                }
            },
            logout: async () => { await supabase.auth.signOut(); location.reload(); }
        };

        // UI & CALCULADORA (LÓGICA PRESERVADA)
        const state = { height: 3, beam: 30, tilt: 0, intensity: 3000 };
        
        function switchTool(tool) {
            const isQuery = tool === 'query';
            document.getElementById('query-panel').classList.toggle('hidden', !isQuery);
            document.getElementById('calc-inputs-panel').classList.toggle('hidden', isQuery);
            document.getElementById('calc-viz-panel').classList.toggle('hidden', isQuery);
            
            document.querySelectorAll('.mode-tab-btn').forEach(btn => {
                btn.classList.toggle('tab-active', btn.id === `tab-${tool}`);
                btn.classList.toggle('tab-inactive', btn.id !== `tab-${tool}`);
            });
            if (!isQuery) renderInputs();
        }

        function renderInputs() {
            const container = document.getElementById('inputs-container');
            container.innerHTML = `
                <div class="mb-4"><label class="text-[10px] text-dim-gray">Altura (m)</label><input type="number" value="${state.height}" oninput="state.height=this.value;updateCalculations()"></div>
                <div class="mb-4"><label class="text-[10px] text-dim-gray">Facho (°)</label><input type="number" value="${state.beam}" oninput="state.beam=this.value;updateCalculations()"></div>
                <div class="mb-4"><label class="text-[10px] text-dim-gray">Intensidade (cd)</label><input type="number" value="${state.intensity}" oninput="state.intensity=this.value;updateCalculations()"></div>
            `;
            updateCalculations();
        }

        function updateCalculations() {
            const canvas = document.getElementById('beamCanvas');
            if (!canvas || canvas.offsetParent === null) return;
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const floorY = canvas.height - 50;
            const centerX = canvas.width / 2;
            const sy = floorY - (state.height * 80);

            // Desenho simplificado do facho
            ctx.fillStyle = 'rgba(251, 191, 36, 0.3)';
            ctx.beginPath(); ctx.moveTo(centerX, sy);
            ctx.lineTo(centerX - 100, floorY); ctx.lineTo(centerX + 100, floorY);
            ctx.fill();

            // Fonte
            ctx.fillStyle = '#FBBF24'; ctx.beginPath(); ctx.arc(centerX, sy, 6, 0, Math.PI*2); ctx.fill();
            
            // Resultado (Lei do Cosseno Cúbico)
            const lux = (state.intensity * Math.pow(Math.cos(0), 3)) / Math.pow(state.height, 2);
            ctx.fillStyle = "#fff"; ctx.font = "bold 14px Manrope";
            ctx.fillText(`${Math.round(lux)} LUX NO EIXO`, centerX + 20, sy + 5);
        }

        // INIT
        document.addEventListener("DOMContentLoaded", () => {
            AuthManager.init();
            document.getElementById('norms-body').innerHTML = `
                <tr class="border-b border-white/5"><td class="p-4">Escritório (Geral)</td><td class="p-4">500</td><td class="p-4">19</td><td class="p-4">80</td></tr>
                <tr class="border-b border-white/5"><td class="p-4">Circulação / Corredores</td><td class="p-4">100</td><td class="p-4">28</td><td class="p-4">40</td></tr>
            `;
        });
    </script>
</body>
</html>