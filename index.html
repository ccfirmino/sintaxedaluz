<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxSintax | Lighting Design SaaS (RC-1.0)</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'midnight': '#020617',
                        'twilight': '#0f172a',
                        'glass': 'rgba(15, 23, 42, 0.6)',
                        'luminous-gold': '#FBBF24',
                        'tech-cyan': '#22d3ee',
                        'dim-gray': '#94a3b8',
                        'dim-line': '#cbd5e1',
                        'starlight': '#f8fafc',
                        'leed-green': '#84cc16',
                        'danger': '#ef4444'
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                    },
                    backgroundImage: {
                        'blue-hour-gradient': 'linear-gradient(to bottom, #020617, #0f172a)',
                        'gold-glow': 'radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, rgba(2, 6, 23, 0) 70%)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Manrope', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            background: linear-gradient(180deg, #020617 0%, #0f172a 100%);
            letter-spacing: 0.5px;
            min-height: 100vh;
        }
        
        body.auth-locked { overflow: hidden; }

        h1, h2, h3, h4, .nav-link, button, input, label, select { text-transform: uppercase !important; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        /* Login Wall */
        .login-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: rgba(2, 6, 23, 0.4);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        .login-overlay.active { opacity: 1; pointer-events: auto; }
        .login-card {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(251, 191, 36, 0.2);
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.1);
            transform: translateY(20px); transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .login-overlay.active .login-card { transform: translateY(0); }

        /* Form Elements */
        .signup-input {
            background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); color: white;
            padding: 12px; border-radius: 8px; width: 100%; font-size: 0.85rem; outline: none; transition: all 0.3s;
        }
        .signup-input:focus { border-color: #FBBF24; background: rgba(0, 0, 0, 0.5); }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: #FBBF24; cursor: pointer; margin-top: -5px; box-shadow: 0 0 10px rgba(251, 191, 36, 0.8); border: 2px solid #0f172a; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #1e293b; border-radius: 2px; }

        input[type=number], select, input[type=text]:not(.signup-input) { background-color: transparent; color: #f8fafc; border: none; border-bottom: 1px solid #334155; text-align: right; width: 65px; font-family: 'Manrope', sans-serif; font-weight: 300; -moz-appearance: textfield; }
        input[type=number]:focus, select:focus { outline: none; border-bottom: 1px solid #FBBF24; color: #FBBF24; }
        
        select.custom-select option { background-color: #0f172a; color: #f8fafc; }

        .nav-link { position: relative; font-size: 0.85rem; letter-spacing: 2px; color: #94a3b8; transition: color 0.3s; }
        .nav-link:hover { color: #FBBF24; }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 1px; bottom: -4px; left: 0; background-color: #FBBF24; transition: width 0.3s; }
        .nav-link:hover::after { width: 100%; }

        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        .canvas-container { background: linear-gradient(135deg, #0B1221 0%, #1e293b 100%); box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        
        /* Interactive Elements */
        .mode-tab-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
            padding: 16px 20px; min-width: 130px; height: 90px; border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05); background: rgba(255, 255, 255, 0.02);
            transition: all 0.3s ease; backdrop-filter: blur(5px); position: relative;
        }
        .mode-tab-btn:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); border-color: rgba(255, 255, 255, 0.2); }
        .tab-active { border-bottom: 2px solid #FBBF24 !important; color: #FBBF24 !important; opacity: 1 !important; }
        .tab-inactive { border-bottom: 2px solid transparent !important; color: #94a3b8 !important; opacity: 0.6; }

        .query-tab-btn { padding: 8px 16px; font-size: 10px; font-weight: bold; text-transform: uppercase; border-radius: 9999px; border: 1px solid transparent; transition: all 0.3s; color: #94a3b8; }
        .query-tab-active { background-color: rgba(251, 191, 36, 0.1); color: #FBBF24; border-color: #FBBF24; }

        .leed-level-box { transition: all 0.3s; border: 1px solid transparent; opacity: 0.5; cursor: pointer; }
        .leed-level-box:hover { opacity: 0.8; background: rgba(255,255,255,0.05); }
        .leed-level-box.active { opacity: 1; border-color: #FBBF24; background: rgba(251, 191, 36, 0.1); transform: scale(1.05); box-shadow: 0 0 15px rgba(251,191,36,0.1); }
        
        .well-toggle-group { cursor: pointer; border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s; }
        .well-toggle-group.active { border-color: #22d3ee; background: rgba(34, 211, 238, 0.05); }
        
        .bar-container { width: 100%; background: rgba(255,255,255,0.1); height: 6px; border-radius: 99px; overflow: hidden; margin-top: 4px; }
        .bar-fill { height: 100%; border-radius: 99px; transition: width 1s ease-out; }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(251, 191, 36, 0.3); border-radius: 4px; }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-luminous-gold selection:text-midnight auth-locked">

    <div id="auth-wall" class="login-overlay active">
        <div id="login-step-1" class="login-card p-8 md:p-12 w-full max-w-md rounded-2xl text-center relative overflow-hidden">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-32 bg-luminous-gold opacity-10 blur-3xl pointer-events-none"></div>

            <div class="relative z-10 flex flex-col items-center">
                <div class="mb-6">
                    <span class="text-2xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)]">
                        LUX<span class="text-white font-light opacity-60">SINTAX</span>
                    </span>
                    <div class="bg-luminous-gold/20 text-luminous-gold text-[9px] font-black px-2 py-0.5 rounded border border-luminous-gold/30 tracking-widest inline-block ml-2 align-middle">SAAS</div>
                </div>

                <h2 class="text-white text-lg font-bold uppercase tracking-widest mb-3">ACESSO PROFISSIONAL</h2>
                <p class="text-dim-gray text-xs leading-relaxed mb-8 font-light">
                    Plataforma de cálculo luminotécnico e conformidade normativa.<br>
                    <strong class="text-white">Gerencie projetos com precisão.</strong>
                </p>

                <button onclick="AuthService.openSignup('google')" class="w-full bg-white text-midnight font-bold py-3 rounded-lg hover:bg-gray-100 transition-all flex items-center justify-center gap-3 text-sm uppercase tracking-wider mb-3 group">
                    <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Google">
                    <span>Entrar com Google</span>
                </button>
                
                <button onclick="AuthService.openSignup('email')" class="w-full bg-white/5 border border-white/10 text-white font-bold py-3 rounded-lg hover:bg-white/10 transition-all text-xs uppercase tracking-wider">
                    Entrar com E-mail
                </button>
                
                 <div class="mt-6 pt-4 border-t border-white/5 w-full">
                    <p class="text-[9px] text-dim-gray mb-2 font-bold uppercase">Selecione o Nível (Simulação)</p>
                    <div class="flex gap-2 justify-center">
                        <button onclick="AuthService.setDemoPlan('BETA')" class="text-[9px] bg-white/5 px-3 py-1 rounded hover:bg-white/10 text-dim-gray border border-white/10">BETA (Grátis)</button>
                        <button onclick="AuthService.setDemoPlan('PRO')" class="text-[9px] bg-luminous-gold/10 px-3 py-1 rounded hover:bg-luminous-gold/20 text-luminous-gold border border-luminous-gold/30">PRO (Ilimitado)</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="login-step-2" class="hidden login-card p-8 w-full max-w-md rounded-2xl relative overflow-hidden">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-32 bg-tech-cyan opacity-10 blur-3xl pointer-events-none"></div>
            
            <div class="relative z-10">
                <button onclick="AuthService.backToLogin()" class="absolute top-0 left-0 text-dim-gray hover:text-white transition-colors text-xs uppercase font-bold"><i class="fas fa-arrow-left mr-1"></i> Voltar</button>
                
                <div class="text-center mb-6 mt-4">
                    <h2 class="text-white text-md font-bold uppercase tracking-widest mb-1">Finalizar Cadastro</h2>
                    <p class="text-[10px] text-dim-gray">Configure seu perfil de Lighting Designer.</p>
                </div>

                <form onsubmit="AuthService.submitSignup(event)" class="space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[9px] text-luminous-gold font-bold uppercase block mb-1">Nome</label>
                            <input type="text" id="reg-name" class="signup-input" placeholder="Seu nome" required>
                        </div>
                        <div>
                            <label class="text-[9px] text-dim-gray font-bold uppercase block mb-1">Sobrenome</label>
                            <input type="text" id="reg-surname" class="signup-input" placeholder="Sobrenome" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-[9px] text-dim-gray font-bold uppercase block mb-1">E-mail Corporativo</label>
                        <input type="email" id="reg-email" class="signup-input" placeholder="nome@studio.com" required>
                    </div>

                    <button type="submit" id="btn-submit-auth" class="w-full bg-luminous-gold text-midnight font-bold py-3 rounded-lg hover:bg-white transition-all text-xs uppercase tracking-wider mt-4 shadow-[0_0_15px_rgba(251,191,36,0.3)]">
                        Iniciar Sessão
                    </button>
                </form>
            </div>
        </div>
    </div>

    <nav class="fixed w-full z-50 bg-midnight/90 backdrop-blur-xl border-b border-white/5">
        <div class="max-w-[1800px] mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <a href="#" class="text-xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)]">
                    LUX<span class="text-white font-light opacity-60">SINTAX</span>
                </a>
                <span id="nav-plan-badge" class="bg-white/10 text-white text-[9px] font-black px-2 py-0.5 rounded border border-white/20 tracking-widest">LOADING</span>
            </div>
            
            <div class="hidden md:flex gap-8 items-center">
                <a href="#calculadora" class="nav-link">FERRAMENTAS</a>
                
                <div class="flex flex-col items-end mr-4">
                    <div class="text-[9px] text-dim-gray font-bold uppercase tracking-wider">Cota Diária</div>
                    <div class="w-24 h-1.5 bg-white/10 rounded-full mt-1 overflow-hidden">
                        <div id="quota-bar" class="h-full bg-tech-cyan transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

                <div id="user-nav-area" class="hidden flex items-center gap-4 pl-4 border-l border-white/10">
                    <div class="text-right leading-tight">
                        <div id="user-name-display" class="text-[10px] text-white font-bold uppercase"></div>
                        <div id="user-role-display" class="text-[9px] text-luminous-gold font-bold uppercase tracking-widest"></div>
                    </div>
                    <button onclick="AuthService.logout()" class="text-[10px] text-red-400 hover:text-red-300 font-bold tracking-widest uppercase border border-red-900/30 bg-red-900/10 px-3 py-1 rounded hover:bg-red-900/20 transition-all">
                        SAIR
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <section id="calculadora" class="pt-24 pb-10 px-4 md:px-8 relative min-h-screen">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-gold-glow pointer-events-none opacity-30"></div>

        <div class="max-w-[1800px] mx-auto flex flex-col items-center">
            
            <div class="flex justify-start w-full gap-4 sm:gap-6 mb-8 relative z-10 fade-in-up overflow-x-auto pb-2 custom-scrollbar">
                <button onclick="switchTool('query')" id="tab-query" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-active whitespace-nowrap text-luminous-gold">
                    <i class="fas fa-search"></i>
                    <span>NORMATIVAS<br>& CERTIFICAÇÃO</span>
                </button>

                <button onclick="switchTool('ponto')" id="tab-ponto" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                    <i class="fas fa-grip-lines"></i>
                    <span>SUPERFÍCIE<br>HORIZONTAL</span>
                </button>
                <button onclick="switchTool('vertical')" id="tab-vertical" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                    <i class="fas fa-grip-lines-vertical"></i>
                    <span>SUPERFÍCIE<br>VERTICAL</span>
                </button>
                <button onclick="switchTool('homog')" id="tab-homog" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                    <i class="fas fa-border-all"></i>
                    <span>DISTRIBUIÇÃO<br>& DESENHO</span>
                </button>
            </div>

            <div id="calculator-interface" class="w-full relative">
                
                <div id="visual-tools" class="grid grid-cols-1 lg:grid-cols-12 gap-8 w-full transition-opacity duration-300 hidden">
                    <div class="lg:col-span-3 flex flex-col gap-6">
                        <div class="glass-panel p-6 rounded-2xl relative h-auto sticky top-24">
                            <h3 class="text-md text-white mb-4 font-bold whitespace-nowrap text-center drop-shadow-md border-b border-white/10 pb-3">Parâmetros da Fonte</h3>
                            
                            <div id="inputs-ponto" class="hidden space-y-4">
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">ALTURA (H)</label><div class="flex items-baseline gap-1"><input type="number" id="p-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-muted-blue">m</span></div></div><input type="range" id="range-p-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">PLANO (HP)</label><div class="flex items-baseline gap-1"><input type="number" id="p-plane" value="0.75" min="0" max="5" step="0.05"><span class="text-[9px] text-muted-blue">m</span></div></div><input type="range" id="range-p-plane" min="0" max="5" step="0.05" value="0.75"></div>
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="p-beam" value="30" min="5" max="120"><span class="text-[9px] text-muted-blue">°</span></div></div><input type="range" id="range-p-beam" min="5" max="120" step="1" value="30"></div>
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">TILT</label><div class="flex items-baseline gap-1"><input type="number" id="p-tilt" value="0" min="0" max="60"><span class="text-[9px] text-muted-blue">°</span></div></div><input type="range" id="range-p-tilt" min="0" max="60" step="1" value="0"></div>
                                <div class="group border-t border-white/5 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-luminous-gold font-bold">INTENSIDADE</label><div class="flex items-baseline gap-1"><input type="number" id="p-intensity" value="3000"><span class="text-[9px] text-luminous-gold">cd</span></div></div><input type="range" id="range-p-intensity" min="0" max="20000" step="10" value="3000"></div>
                            </div>

                            <div id="inputs-vertical" class="hidden space-y-4">
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">ALTURA (H)</label><div class="flex items-baseline gap-1"><input type="number" id="v-height" value="3.0"><span class="text-[9px]">m</span></div></div><input type="range" id="range-v-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">DISTÂNCIA (D)</label><div class="flex items-baseline gap-1"><input type="number" id="v-dist" value="1.0"><span class="text-[9px]">m</span></div></div><input type="range" id="range-v-dist" min="0.5" max="10" step="0.1" value="1.0"></div>
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">TILT</label><div class="flex items-baseline gap-1"><input type="number" id="v-tilt" value="30"><span class="text-[9px]">°</span></div></div><input type="range" id="range-v-tilt" min="0" max="90" step="1" value="30"></div>
                                <div class="group pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-luminous-gold font-bold">INTENSIDADE</label><div class="flex items-baseline gap-1"><input type="number" id="v-intensity" value="3000"><span class="text-[9px]">cd</span></div></div><input type="range" id="range-v-intensity" min="0" max="20000" step="10" value="3000"></div>
                            </div>
                            
                            <div id="inputs-homog" class="hidden space-y-4">
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">ALTURA (H)</label><div class="flex items-baseline gap-1"><input type="number" id="h-height" value="3.0"><span class="text-[9px]">m</span></div></div><input type="range" id="range-h-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">ESPAÇAMENTO</label><div class="flex items-baseline gap-1"><input type="number" id="h-spacing" value="2.0"><span class="text-[9px]">m</span></div></div><input type="range" id="range-h-spacing" min="0.5" max="10" step="0.1" value="2.0"></div>
                                <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold">FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="h-beam" value="30"><span class="text-[9px]">°</span></div></div><input type="range" id="range-h-beam" min="5" max="120" step="1" value="30"></div>
                                <div class="group pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-luminous-gold font-bold">INTENSIDADE</label><div class="flex items-baseline gap-1"><input type="number" id="h-intensity" value="3000"><span class="text-[9px]">cd</span></div></div><input type="range" id="range-h-intensity" min="0" max="20000" step="10" value="3000"></div>
                            </div>

                        </div>
                    </div>

                    <div class="lg:col-span-9 flex flex-col gap-6">
                        <div class="glass-panel p-6 rounded-2xl flex-grow flex flex-col relative h-full min-h-[600px]">
                            <h3 class="text-sm text-white mb-6 border-b border-white/10 pb-4 drop-shadow-md uppercase tracking-widest font-bold">Resultados em Tempo Real</h3>
                            <div class="relative w-full flex-grow bg-twilight/50 border border-white/10 rounded-2xl mb-6 overflow-hidden canvas-container shadow-inner">
                                <canvas id="beamCanvas" class="w-full h-full relative z-10"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="query-tool" class="w-full animate-fade-in-up col-span-12">
                    <div class="glass-panel p-6 rounded-2xl">
                        
                        <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-white/10 pb-4 gap-4">
                            <div>
                                <h3 class="text-lg text-luminous-gold font-bold tracking-widest flex items-center gap-2 uppercase">
                                    <i class="fas fa-book"></i> <span>Biblioteca de Normas</span>
                                </h3>
                                <p class="text-xs text-muted-blue mt-1">Conformidade NBR 8995-1, NBR 5101 e Certificações Sustentáveis.</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="switchQueryTab('nbr8995')" id="btn-q-nbr8995" class="query-tab-btn query-tab-active">Interiores (NBR 8995)</button>
                                <button onclick="switchQueryTab('nbr5101')" id="btn-q-nbr5101" class="query-tab-btn">Viária (NBR 5101)</button>
                                <button onclick="switchQueryTab('leed')" id="btn-q-leed" class="query-tab-btn">LEED / WELL</button>
                            </div>
                        </div>

                        <div id="content-nbr8995" class="query-content">
                            <div class="mb-4"><select id="category-filter" onchange="filterNorms()" class="w-full bg-black/40 border border-white/10 rounded-lg py-3 px-6 text-sm text-white outline-none custom-select uppercase"><option value="all">Todas as Categorias</option></select></div>
                            <div class="overflow-hidden rounded-xl border border-white/10">
                                <div class="overflow-x-auto max-h-[500px] overflow-y-auto custom-scrollbar">
                                    <table class="w-full text-left border-collapse">
                                        <thead class="bg-white/5 text-xs text-white font-bold uppercase tracking-wider sticky top-0 bg-midnight z-10">
                                            <tr><th class="p-4 border-b border-white/10">Categoria</th><th class="p-4 border-b border-white/10">Ambiente</th><th class="p-4 border-b border-white/10 text-center text-luminous-gold">Lux (Em)</th><th class="p-4 border-b border-white/10 text-center">UGR</th><th class="p-4 border-b border-white/10 text-center">Ra</th></tr>
                                        </thead>
                                        <tbody id="nbr8995-tbody" class="text-sm text-dim-gray divide-y divide-white/5"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="content-nbr5101" class="query-content hidden">
                            <div class="p-4 bg-white/5 rounded text-center text-dim-gray border border-white/10">
                                <i class="fas fa-road text-3xl mb-3 text-dim-gray"></i>
                                <p class="text-xs uppercase font-bold">Módulo de Iluminação Pública</p>
                                <p class="text-[10px]">Utilize os seletores para definir a classe M1-M6.</p>
                            </div>
                        </div>

                        <div id="content-leed" class="query-content hidden">
                            <div class="flex gap-2 mb-4 border-b border-white/5 pb-2">
                                <span class="cert-tab active">LEED v4.1 (BD+C)</span>
                            </div>

                            <div class="bg-black/30 p-6 rounded-xl border border-white/5 shadow-lg">
                                <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                                    <h4 class="text-sm font-bold text-luminous-gold flex items-center gap-2"><i class="fas fa-calculator"></i> Calculadora LPD (Orçamento Energético)</h4>
                                    <div class="text-[9px] bg-leed-green/20 px-2 py-1 rounded text-leed-green font-bold">ASHRAE 90.1-2016</div>
                                </div>
                                
                                <div class="flex flex-col md:flex-row gap-8 items-end mb-8">
                                    <div class="w-full md:w-1/2">
                                        <label class="text-[10px] text-dim-gray font-bold uppercase block mb-3">Meta de Certificação</label>
                                        <div class="grid grid-cols-4 gap-2 text-center">
                                            <div onclick="setLeedTarget('certified')" id="lvl-certified" class="leed-level-box bg-white/5 p-2 rounded border border-transparent hover:border-white/20"><div class="text-[9px] font-bold text-gray-400">CERTIFIED</div></div>
                                            <div onclick="setLeedTarget('silver')" id="lvl-silver" class="leed-level-box bg-white/5 p-2 rounded border border-transparent hover:border-white/20"><div class="text-[9px] font-bold text-gray-300">SILVER</div></div>
                                            <div onclick="setLeedTarget('gold')" id="lvl-gold" class="leed-level-box bg-white/5 p-2 rounded border border-luminous-gold/20 active"><div class="text-[9px] font-bold text-luminous-gold">GOLD</div></div>
                                            <div onclick="setLeedTarget('platinum')" id="lvl-platinum" class="leed-level-box bg-white/5 p-2 rounded border border-transparent hover:border-white/20"><div class="text-[9px] font-bold text-cyan-200">PLATINUM</div></div>
                                        </div>
                                    </div>
                                    <div class="w-full md:w-1/4 text-right md:text-left">
                                        <div class="text-[10px] text-dim-gray font-bold uppercase mb-1">Redução Necessária</div>
                                        <div id="leed-reduction-display" class="text-3xl font-black text-leed-green">20%</div>
                                    </div>
                                    <div class="w-full md:w-1/4">
                                        <label class="text-[10px] text-tech-cyan font-bold uppercase block mb-2">Área do Projeto (m²)</label>
                                        <div class="relative"><input type="number" id="leed-area-input" value="100" oninput="updateLeedTargets()" class="w-full bg-midnight border border-white/20 rounded px-3 py-2 text-xs text-white outline-none focus:border-luminous-gold text-right pr-8"><span class="absolute right-3 top-2 text-xs text-tech-cyan">m²</span></div>
                                    </div>
                                </div>

                                <table class="w-full text-xs text-left border-collapse">
                                    <thead class="text-white border-b border-white/10 bg-white/5">
                                        <tr><th class="p-3 font-bold">Tipologia</th><th class="p-3 text-center font-bold text-dim-gray">Base ASHRAE<br><span class="text-[9px] opacity-70">(W/m²)</span></th><th class="p-3 text-center font-bold text-luminous-gold">Meta LPD<br><span class="text-[9px] opacity-70">(W/m²)</span></th><th class="p-3 text-right font-bold text-tech-cyan">CARGA PERMITIDA<br><span class="text-[9px] opacity-70">(Watts)</span></th></tr>
                                    </thead>
                                    <tbody id="leed-lpd-body" class="text-dim-line text-xs font-medium"></tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // --- AUTH & QUOTA SYSTEM ---
        const AuthService = {
            STORAGE_KEY: 'lux_user_session',
            demoPlan: 'BETA', // Default demo plan

            init: function() {
                this.checkAuth();
            },

            setDemoPlan: function(plan) {
                this.demoPlan = plan;
                // Visual feedback for demo buttons
                const btns = document.querySelectorAll('#login-step-1 button');
                btns.forEach(b => {
                    if(b.innerText.includes(plan)) b.style.borderColor = '#FBBF24';
                    else b.style.borderColor = 'rgba(255,255,255,0.1)';
                });
            },

            openSignup: function(provider) {
                document.getElementById('login-step-1').classList.add('hidden');
                document.getElementById('login-step-2').classList.remove('hidden');
                document.getElementById('login-step-2').classList.add('fade-in-up');
            },

            backToLogin: function() {
                document.getElementById('login-step-2').classList.add('hidden');
                document.getElementById('login-step-1').classList.remove('hidden');
            },

            submitSignup: function(e) {
                e.preventDefault();
                const btn = document.getElementById('btn-submit-auth');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
                btn.disabled = true;

                const fName = document.getElementById('reg-name').value;
                const lName = document.getElementById('reg-surname').value;
                const email = document.getElementById('reg-email').value;

                setTimeout(() => {
                    const quotaLimit = this.demoPlan === 'PRO' ? 1000 : 20; // 20 actions for Beta
                    const user = {
                        id: 'usr_' + Date.now(),
                        name: `${fName} ${lName}`,
                        email: email,
                        plan: this.demoPlan,
                        quota: { used: 0, limit: quotaLimit, lastReset: new Date().toDateString() }
                    };

                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(user));
                    
                    document.getElementById('auth-wall').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('auth-wall').classList.remove('active');
                        document.body.classList.remove('auth-locked');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                        this.backToLogin();
                        e.target.reset();
                        this.checkAuth();
                    }, 500);
                }, 800);
            },

            checkAuth: function() {
                const session = localStorage.getItem(this.STORAGE_KEY);
                if (!session) {
                    document.getElementById('auth-wall').classList.add('active');
                    document.getElementById('auth-wall').style.opacity = '1';
                    document.body.classList.add('auth-locked');
                    document.getElementById('user-nav-area').classList.add('hidden');
                } else {
                    const user = JSON.parse(session);
                    // Check Quote Reset (Daily)
                    if (user.quota.lastReset !== new Date().toDateString()) {
                        user.quota.used = 0;
                        user.quota.lastReset = new Date().toDateString();
                        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(user));
                    }

                    document.getElementById('auth-wall').classList.remove('active');
                    document.body.classList.remove('auth-locked');
                    
                    // UI Updates
                    document.getElementById('user-nav-area').classList.remove('hidden');
                    document.getElementById('user-name-display').innerText = user.name;
                    document.getElementById('user-role-display').innerText = user.plan + " MEMBER";
                    
                    const planBadge = document.getElementById('nav-plan-badge');
                    planBadge.innerText = user.plan;
                    planBadge.className = user.plan === 'PRO' 
                        ? "bg-luminous-gold text-midnight font-black px-2 py-0.5 rounded tracking-widest"
                        : "bg-white/10 text-white font-black px-2 py-0.5 rounded border border-white/20 tracking-widest";

                    this.updateQuotaUI(user);
                }
            },

            updateQuotaUI: function(user) {
                const pct = (user.quota.used / user.quota.limit) * 100;
                const bar = document.getElementById('quota-bar');
                if(bar) {
                    bar.style.width = `${Math.min(pct, 100)}%`;
                    bar.className = pct > 90 
                        ? "h-full bg-danger transition-all duration-500" 
                        : "h-full bg-tech-cyan transition-all duration-500";
                }
            },

            useQuota: function() {
                const session = localStorage.getItem(this.STORAGE_KEY);
                if(!session) return false;
                const user = JSON.parse(session);
                
                if (user.quota.used >= user.quota.limit) {
                    alert("Limite diário do plano BETA atingido! Faça upgrade para PRO.");
                    return false;
                }
                
                user.quota.used++;
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(user));
                this.updateQuotaUI(user);
                return true;
            },

            logout: function() {
                localStorage.removeItem(this.STORAGE_KEY);
                location.reload();
            }
        };

        // --- DATA ---
        const normsData = [
            { cat: "Escritório", room: "Escrita / Digitação", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Reunião", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Recepção", lux: 300, ugr: 22, ra: 80 },
            { cat: "Industrial", room: "Montagem Fina", lux: 750, ugr: 19, ra: 80 },
            { cat: "Industrial", room: "Depósito", lux: 100, ugr: 25, ra: 60 },
            { cat: "Saúde", room: "Cirurgia", lux: 1000, ugr: 19, ra: 90 },
            { cat: "Saúde", room: "Espera", lux: 200, ugr: 22, ra: 80 },
            { cat: "Varejo", room: "Loja (Geral)", lux: 500, ugr: 22, ra: 80 },
            { cat: "Varejo", room: "Vitrine", lux: 1000, ugr: "-", ra: 80 },
            { cat: "Educação", room: "Sala de Aula", lux: 300, ugr: 19, ra: 80 }
        ];

        const lpdBaselines = [
            { type: "Escritório", base: 6.9 },
            { type: "Varejo", base: 9.0 },
            { type: "Educação", base: 7.5 },
            { type: "Saúde", base: 9.0 },
            { type: "Indústria", base: 6.0 },
            { type: "Estacionamento", base: 1.6 }
        ];

        // --- LOGIC ---
        let currentLeedTarget = 'gold';

        function switchTool(toolId) {
            // Check Quota on major tool switch
            if (toolId !== 'query' && !AuthService.useQuota()) return;

            document.querySelectorAll('.mode-tab-btn').forEach(b => {
                b.classList.remove('tab-active');
                b.classList.add('tab-inactive');
            });
            const btn = document.getElementById('tab-' + toolId);
            if(btn) {
                btn.classList.add('tab-active');
                btn.classList.remove('tab-inactive');
            }

            const visualTools = document.getElementById('visual-tools');
            const queryTool = document.getElementById('query-tool');

            if (toolId === 'query') {
                visualTools.classList.add('hidden');
                queryTool.classList.remove('hidden');
            } else {
                queryTool.classList.add('hidden');
                visualTools.classList.remove('hidden');
                
                // Toggle inputs
                ['inputs-ponto', 'inputs-vertical', 'inputs-homog'].forEach(id => document.getElementById(id).classList.add('hidden'));
                document.getElementById('inputs-' + toolId).classList.remove('hidden');
                
                renderCanvas(toolId);
            }
        }

        function switchQueryTab(tabId) {
            document.querySelectorAll('.query-tab-btn').forEach(b => b.classList.remove('query-tab-active'));
            document.getElementById('btn-q-' + tabId).classList.add('query-tab-active');
            
            document.querySelectorAll('.query-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('content-' + tabId).classList.remove('hidden');
            
            if(tabId === 'nbr8995') filterNorms();
            if(tabId === 'leed') updateLeedTargets();
        }

        function filterNorms() {
            const cat = document.getElementById('category-filter').value;
            const tbody = document.getElementById('nbr8995-tbody');
            tbody.innerHTML = '';

            // Populate categories if empty
            const select = document.getElementById('category-filter');
            if (select.options.length === 1) {
                const cats = [...new Set(normsData.map(i => i.cat))];
                cats.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.text = c;
                    select.add(opt);
                });
            }

            const filtered = cat === 'all' ? normsData : normsData.filter(i => i.cat === cat);
            filtered.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-white/5 transition border-b border-white/5";
                tr.innerHTML = `
                    <td class="p-4 font-bold text-luminous-gold text-xs uppercase">${item.cat}</td>
                    <td class="p-4 text-dim-gray">${item.room}</td>
                    <td class="p-4 text-center text-white font-bold bg-white/5">${item.lux}</td>
                    <td class="p-4 text-center text-dim-gray">${item.ugr}</td>
                    <td class="p-4 text-center text-dim-gray">${item.ra}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function setLeedTarget(target) {
            currentLeedTarget = target;
            updateLeedTargets();
        }

        function updateLeedTargets() {
            const area = parseFloat(document.getElementById('leed-area-input').value) || 100;
            const boxes = document.querySelectorAll('.leed-level-box');
            boxes.forEach(b => b.classList.remove('active'));
            document.getElementById('lvl-' + currentLeedTarget).classList.add('active');

            let reduction = 0;
            switch(currentLeedTarget) {
                case 'certified': reduction = 0.05; break;
                case 'silver': reduction = 0.10; break;
                case 'gold': reduction = 0.20; break;
                case 'platinum': reduction = 0.30; break;
            }

            document.getElementById('leed-reduction-display').innerText = (reduction * 100).toFixed(0) + "%";

            const tbody = document.getElementById('leed-lpd-body');
            tbody.innerHTML = '';
            lpdBaselines.forEach(row => {
                const targetLPD = (row.base * (1 - reduction)).toFixed(2);
                const watts = (targetLPD * area).toFixed(0);
                const tr = document.createElement('tr');
                tr.className = "border-b border-white/5 hover:bg-white/5";
                tr.innerHTML = `
                    <td class="p-3 text-white font-medium">${row.type}</td>
                    <td class="p-3 text-center text-dim-gray font-mono">${row.base}</td>
                    <td class="p-3 text-center"><span class="text-luminous-gold font-bold">${targetLPD}</span></td>
                    <td class="p-3 text-right"><span class="text-tech-cyan font-bold bg-tech-cyan/10 px-2 py-1 rounded">${watts} W</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- CANVAS LOGIC (Simplified for Demo, but Functional) ---
        function renderCanvas(mode) {
            const canvas = document.getElementById('beamCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width; canvas.height = rect.height;
            const w = canvas.width; const h = canvas.height;
            const cx = w/2; const floorY = h - 50;

            // Get inputs
            const H = parseFloat(document.getElementById(mode === 'homog' ? 'h-height' : mode === 'ponto' ? 'p-height' : 'v-height').value) * 20; // Scale
            
            ctx.clearRect(0,0,w,h);
            
            // Draw Floor
            ctx.strokeStyle = '#334155'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(0, floorY); ctx.lineTo(w, floorY); ctx.stroke();
            
            // Draw Source
            const sourceY = floorY - H;
            ctx.fillStyle = '#FBBF24';
            ctx.beginPath(); ctx.arc(cx, sourceY, 6, 0, Math.PI*2); ctx.fill();

            // Draw Beam (Visual Cone)
            ctx.fillStyle = 'rgba(251, 191, 36, 0.1)';
            ctx.beginPath(); ctx.moveTo(cx, sourceY); ctx.lineTo(cx - 50, floorY); ctx.lineTo(cx + 50, floorY); ctx.fill();

            // Labels
            ctx.fillStyle = '#94a3b8'; ctx.font = "12px Manrope";
            ctx.fillText("H = " + (H/20).toFixed(1) + "m", cx + 10, sourceY + H/2);
        }

        // Initialize Listeners
        document.querySelectorAll('input').forEach(i => i.addEventListener('input', (e) => {
            // Sync range and number
            if(e.target.type === 'range') {
                const num = document.getElementById(e.target.id.replace('range-', ''));
                if(num) num.value = e.target.value;
            } else if(e.target.type === 'number') {
                const rng = document.getElementById('range-' + e.target.id);
                if(rng) rng.value = e.target.value;
            }
            // Re-render active tool
            const active = document.querySelector('.tab-active');
            if(active && active.id.includes('ponto')) renderCanvas('ponto');
        }));

        // BOOTSTRAP
        AuthService.init();
        switchTool('query');
        filterNorms();

    </script>
</body>
</html>