<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxSintax | Lighting Design & Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'midnight': '#020617',
                        'twilight': '#0f172a',
                        'glass': 'rgba(15, 23, 42, 0.6)',
                        'luminous-gold': '#FBBF24',
                        'muted-blue': '#94a3b8',
                        'starlight': '#f8fafc',
                        'leed-green': '#84cc16'
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                    },
                    backgroundImage: {
                        'blue-hour-gradient': 'linear-gradient(to bottom, #020617, #0f172a)',
                        'gold-glow': 'radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, rgba(2, 6, 23, 0) 70%)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Manrope', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            background: linear-gradient(180deg, #020617 0%, #0f172a 100%);
            letter-spacing: 0.5px;
            min-height: 100vh;
        }

        h1, h2, h3, h4, .nav-link, button, input, label, select { text-transform: uppercase !important; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .glass-input {
            background: rgba(2, 6, 23, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: #f8fafc;
            transition: all 0.3s ease;
        }
        .glass-input:focus {
            outline: none;
            border-color: #FBBF24;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.1);
            background: rgba(2, 6, 23, 0.8);
        }

        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: #FBBF24; cursor: pointer; margin-top: -5px; box-shadow: 0 0 10px rgba(251, 191, 36, 0.8); border: 2px solid #0f172a; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #1e293b; border-radius: 2px; }

        input[type=number], select, input[type=text], input[type=date] { background-color: transparent; color: #f8fafc; border: none; border-bottom: 1px solid #334155; text-align: right; width: 65px; font-family: 'Manrope', sans-serif; font-weight: 300; -moz-appearance: textfield; }
        input[type=number]:focus, select:focus, input[type=text]:focus, input[type=date]:focus { outline: none; border-bottom: 1px solid #FBBF24; color: #FBBF24; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=date]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        select { text-align-last: right; cursor: pointer; }
        select option { background-color: #0f172a; color: white; }

        .nav-link { position: relative; font-size: 0.85rem; letter-spacing: 2px; color: #94a3b8; transition: color 0.3s; }
        .nav-link:hover { color: #FBBF24; text-shadow: 0 0 8px rgba(251, 191, 36, 0.4); }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 1px; bottom: -4px; left: 0; background-color: #FBBF24; transition: width 0.3s; }
        .nav-link:hover::after { width: 100%; }

        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        .canvas-container { background: linear-gradient(135deg, #0B1221 0%, #1e293b 100%); box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .blur-lock { filter: blur(12px) brightness(0.7); pointer-events: none; opacity: 0.4; transition: all 0.5s ease; }
        
        .tab-active { border-bottom: 2px solid #FBBF24 !important; color: #FBBF24 !important; opacity: 1 !important; }
        .tab-inactive { border-bottom: 2px solid transparent !important; color: #94a3b8 !important; opacity: 0.6; }
        .tab-inactive:hover { opacity: 1; color: #f8fafc !important; }
        
        input[type="radio"] { appearance: none; background-color: transparent; margin: 0; font: inherit; color: #FBBF24; width: 1.15em; height: 1.15em; border: 1px solid #FBBF24; border-radius: 50%; display: grid; place-content: center; }
        input[type="radio"]::before { content: ""; width: 0.65em; height: 0.65em; background-color: #FBBF24; border-radius: 50%; transform: scale(0); transition: 120ms transform ease-in-out; }
        input[type="radio"]:checked::before { transform: scale(1); }

        /* Estilo para botões de modo com ícone acima */
        .mode-tab-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 20px;
            min-width: 130px;
            height: 90px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.02);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            position: relative;
        }
        
        .mode-tab-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .mode-tab-btn i.fa-lock {
            font-size: 0.75rem; /* Ajuste tamanho cadeado */
        }
        
        .mode-tab-btn i:not(.fa-lock) {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        .mode-tab-btn span {
            font-size: 0.65rem;
            font-weight: 800;
            letter-spacing: 0.1em;
            line-height: 1.2;
            text-align: center;
        }

        /* Custom Scrollbar for Norms Table */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(251, 191, 36, 0.3); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(251, 191, 36, 0.6); }

        /* Estilos sub-abas consulta */
        .query-tab-btn {
            padding: 8px 16px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 9999px;
            border: 1px solid transparent;
            transition: all 0.3s;
            color: #94a3b8;
        }
        .query-tab-active {
            background-color: rgba(251, 191, 36, 0.1);
            color: #FBBF24;
            border-color: #FBBF24;
        }

        /* Cores de Texto Coerentes */
        label { color: #94a3b8 !important; } /* Padronização com PLANO DE TRABALHO (HP) */
        
        /* Modal */
        #nbr-modal table th { color: #FBBF24; font-weight: bold; text-transform: uppercase; background-color: rgba(255,255,255,0.05); }
        #nbr-modal table td { color: #94a3b8; border-bottom: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-luminous-gold selection:text-midnight">

    <nav class="fixed w-full z-50 bg-midnight/90 backdrop-blur-xl border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)]">
                LUX<span class="text-white font-light opacity-60">SINTAX</span>
            </a>
            
            <div class="hidden md:flex gap-8 items-center">
                <div id="license-status" class="hidden inline-flex items-center gap-2 px-2 py-1 rounded-full border border-green-500/30 bg-green-900/20 backdrop-blur-sm shadow-[0_0_10px_rgba(34,197,94,0.1)]">
                    <div class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></div>
                    <span class="text-[9px] text-green-400 font-bold tracking-widest uppercase" id="license-date-text">CARREGANDO...</span>
                </div>
                
                <a href="#calculadora" class="nav-link"><span data-i18n="nav_calculator">CALCULADORA</span> <i class="fas fa-unlock text-[10px] ml-1 text-luminous-gold drop-shadow-md" id="nav-lock-icon"></i></a>
                <a href="#fundamentos" class="nav-link" data-i18n="nav_concepts">FUNDAMENTOS</a>
                
                <button onclick="toggleLanguage()" class="text-xs text-muted-blue hover:text-luminous-gold transition-colors font-bold tracking-widest border-l border-white/10 pl-4 ml-2 uppercase">
                    <span class="lang-display">PT / EN</span>
                </button>
                <button id="btn-logout" onclick="handleLogout()" class="text-xs text-muted-blue hover:text-luminous-gold transition-colors tracking-widest ml-4 pl-4 border-l border-white/10" data-i18n="nav_logout">LOGOUT</button>
            </div>

            <div class="md:hidden text-luminous-gold text-2xl cursor-pointer" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <section id="calculadora" class="pt-24 pb-20 px-4 md:px-8 relative min-h-screen">
        
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[400px] bg-gold-glow pointer-events-none opacity-40"></div>

        <div class="max-w-7xl mx-auto flex flex-col items-center">
            
            <!-- TAB NAVIGATION REORDENADA -->
            <div class="flex justify-center gap-4 sm:gap-10 mb-10 relative z-10 fade-in-up flex-wrap mt-6">
                <!-- CONSULTA (PRIMEIRO, LIVRE) -->
                <button onclick="switchTool('query')" id="tab-query" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-active whitespace-nowrap text-purple-400">
                    <i class="fas fa-search"></i>
                    <span>CONSULTA<br>(NBR/LEED)</span>
                </button>

                <!-- MODOS DE CÁLCULO (ASSINANTES, COM CADEADO) -->
                <button onclick="switchTool('ponto')" id="tab-ponto" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                    <i class="fas fa-grip-lines"></i>
                    <span>SUPERFÍCIE<br>HORIZONTAL</span>
                    <i class="fas fa-lock text-[10px] absolute top-2 right-2 text-muted-blue opacity-50"></i>
                </button>
                <button onclick="switchTool('vertical')" id="tab-vertical" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                    <i class="fas fa-grip-lines-vertical"></i>
                    <span>SUPERFÍCIE<br>VERTICAL</span>
                    <i class="fas fa-lock text-[10px] absolute top-2 right-2 text-muted-blue opacity-50"></i>
                </button>
                <button onclick="switchTool('homog')" id="tab-homog" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                    <i class="fas fa-border-all"></i>
                    <span>DISTRIBUIÇÃO<br>& DESENHO</span>
                    <i class="fas fa-lock text-[10px] absolute top-2 right-2 text-muted-blue opacity-50"></i>
                </button>
            </div>

            <div id="calculator-interface" class="w-full relative">
                
                <div id="visual-tools" class="grid grid-cols-1 lg:grid-cols-12 gap-8 w-full transition-opacity duration-300">
                    <!-- COLUNA ESQUERDA (INPUTS) -->
                    <div class="lg:col-span-4 flex flex-col gap-6">
                        <div class="glass-panel p-6 rounded-2xl relative h-full">
                            <div class="mb-4">
                                <h3 class="text-md text-white mb-2 font-bold whitespace-nowrap text-center drop-shadow-md" data-i18n="calc_params">Parâmetros da Fonte</h3>
                                <div class="flex flex-col sm:flex-row gap-4 p-1 mb-6 border-b border-white/10 pb-4 justify-center">
                                    <label class="flex items-center gap-2 cursor-pointer group">
                                        <input type="radio" name="calc_mode" value="direct" checked onchange="updateCalcMode('direct')">
                                        <span class="text-[10px] text-muted-blue group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap">INTENSIDADE (CD)</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer group">
                                        <input type="radio" name="calc_mode" value="photometric" onchange="updateCalcMode('photometric')">
                                        <span class="text-[10px] text-muted-blue group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap">FOTOMETRIA (CD/KLM)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- MODO PONTO A PONTO -->
                            <div id="inputs-ponto" class="hidden">
                                 <div class="mode-direct-group mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">INTENSIDADE (I)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="p-intensity" value="3000"><span class="text-[9px] text-muted-blue font-bold">CD</span></div>
                                    </div>
                                    <input type="range" id="range-p-intensity" min="0" max="20000" step="10" value="3000">
                                </div>
                                <div class="mode-photo-group hidden space-y-6 mb-6">
                                    <div class="group">
                                        <div class="flex justify-between items-end mb-2">
                                            <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">VALOR FOTOMÉTRICO</label>
                                            <div class="flex items-baseline gap-1"><input type="number" id="p-cdklm" value="2000"><span class="text-[9px] text-muted-blue font-bold">CD/KLM</span></div>
                                        </div>
                                        <input type="range" id="range-p-cdklm" min="0" max="10000" step="10" value="2000">
                                    </div>
                                    <div class="group">
                                        <div class="flex justify-between items-end mb-2">
                                            <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">FLUXO LUMINOSO</label>
                                            <div class="flex items-baseline gap-1"><input type="number" id="p-flux" value="1500"><span class="text-[9px] text-muted-blue font-bold">LM</span></div>
                                        </div>
                                        <input type="range" id="range-p-flux" min="0" max="10000" step="10" value="1500">
                                    </div>
                                </div>
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ALTURA DA FONTE (H)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="p-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-p-height" min="0.5" max="20" step="0.1" value="3.0">
                                </div>
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ABERTURA DO FACHO</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="p-beam" value="30" min="5" max="120"><span class="text-[9px] text-muted-blue font-bold">°</span></div>
                                    </div>
                                    <input type="range" id="range-p-beam" min="5" max="120" step="1" value="30">
                                </div>
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ORIENTAÇÃO (TILT)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="p-tilt" value="0" min="0" max="60"><span class="text-[9px] text-muted-blue font-bold">°</span></div>
                                    </div>
                                    <input type="range" id="range-p-tilt" min="0" max="60" step="1" value="0">
                                </div>
                                <div class="group border-t border-white/5 pt-4">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">PLANO DE TRABALHO (HP)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="p-plane" value="0.75" min="0" max="5" step="0.05"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-p-plane" min="0" max="5" step="0.05" value="0.75">
                                </div>
                            </div>

                            <!-- MODO VERTICAL -->
                            <div id="inputs-vertical" class="hidden">
                                 <div class="mode-direct-group mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">INTENSIDADE (I)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="v-intensity" value="3000"><span class="text-[9px] text-muted-blue font-bold">CD</span></div>
                                    </div>
                                    <input type="range" id="range-v-intensity" min="0" max="20000" step="10" value="3000">
                                </div>
                                <div class="mode-photo-group hidden space-y-6 mb-6">
                                    <div class="group">
                                        <div class="flex justify-between items-end mb-2">
                                            <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">VALOR FOTOMÉTRICO</label>
                                            <div class="flex items-baseline gap-1"><input type="number" id="v-cdklm" value="2000"><span class="text-[9px] text-muted-blue font-bold">CD/KLM</span></div>
                                        </div>
                                        <input type="range" id="range-v-cdklm" min="0" max="10000" step="10" value="2000">
                                    </div>
                                    <div class="group">
                                        <div class="flex justify-between items-end mb-2">
                                            <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">FLUXO LUMINOSO</label>
                                            <div class="flex items-baseline gap-1"><input type="number" id="v-flux" value="1500"><span class="text-[9px] text-muted-blue font-bold">LM</span></div>
                                        </div>
                                        <input type="range" id="range-v-flux" min="0" max="10000" step="10" value="1500">
                                    </div>
                                </div>
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ALTURA DA FONTE (H)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="v-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-v-height" min="0.5" max="20" step="0.1" value="3.0">
                                </div>
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">DISTÂNCIA DA PAREDE (D)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="v-dist" value="1.0" min="0.5" max="10" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-v-dist" min="0.5" max="10" step="0.1" value="1.0">
                                </div>
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ABERTURA DO FACHO</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="v-beam" value="30" min="5" max="120"><span class="text-[9px] text-muted-blue font-bold">°</span></div>
                                    </div>
                                    <input type="range" id="range-v-beam" min="5" max="120" step="1" value="30">
                                </div>
                                <div class="mb-2 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ORIENTAÇÃO (TILT)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="v-tilt" value="30" min="0" max="90"><span class="text-[9px] text-muted-blue font-bold">°</span></div>
                                    </div>
                                    <input type="range" id="range-v-tilt" min="0" max="90" step="1" value="30">
                                </div>
                                <!-- NOVO CAMPO: EIXO DO QUADRO (hq) -->
                                <div class="group border-t border-white/5 pt-4">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap uppercase">EIXO DO QUADRO (hq)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="v-hq" value="1.6" min="0" max="10" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-v-hq" min="0" max="10" step="0.1" value="1.6">
                                </div>
                            </div>

                            <!-- MODO DISTRIBUIÇÃO & DESENHO -->
                            <div id="inputs-homog" class="hidden space-y-6">
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ALTURA DA FONTE (H)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="h-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-h-height" min="0.5" max="20" step="0.1" value="3.0">
                                </div>
                                <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">DISTÂNCIA ENTRE FONTES (D)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="h-spacing" value="2.0" min="0.5" max="10" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-h-spacing" min="0.5" max="10" step="0.1" value="2.0">
                                </div>
                                 <div class="mb-6 group">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ABERTURA DO FACHO</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="h-beam" value="30" min="5" max="120"><span class="text-[9px] text-muted-blue font-bold">°</span></div>
                                    </div>
                                    <input type="range" id="range-h-beam" min="5" max="120" step="1" value="30">
                                </div>
                                <div class="group border-t border-white/5 pt-4">
                                    <div class="flex justify-between items-end mb-2">
                                        <label class="text-[10px] text-muted-blue font-bold whitespace-nowrap uppercase">PLANO DE TRABALHO (HP)</label>
                                        <div class="flex items-baseline gap-1"><input type="number" id="h-plane" value="0.75" min="0" max="5" step="0.05"><span class="text-[9px] text-muted-blue font-bold">M</span></div>
                                    </div>
                                    <input type="range" id="range-h-plane" min="0" max="5" step="0.05" value="0.75">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- COLUNA DIREITA (RESULTADOS + CANVAS) -->
                    <div class="lg:col-span-8 flex flex-col gap-6">
                        <div class="glass-panel p-6 rounded-2xl flex-grow flex flex-col relative h-full">
                            <h3 class="text-sm text-white mb-6 border-b border-white/10 pb-4 drop-shadow-md uppercase tracking-widest font-bold">Resultados</h3>
                            
                            <div class="relative w-full h-[400px] bg-twilight/50 border border-white/10 rounded-2xl mb-6 overflow-hidden canvas-container shadow-inner">
                                <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px); background-size: 40px 40px;"></div>
                                <canvas id="beamCanvas" class="w-full h-full relative z-10"></canvas>
                            </div>

                            <div id="results-ponto" class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center hidden">
                                <div class="bg-black/30 p-4 rounded-lg border-l-2 border-slate-600 shadow-lg">
                                    <div class="text-[10px] text-muted-blue uppercase tracking-widest mb-1 font-bold">ILUMINÂNCIA NO PLANO DE TRABALHO (hp)</div>
                                    <div class="flex items-baseline justify-center gap-2"><span id="res-p-lux-plane" class="text-4xl text-starlight font-light">0</span><span class="text-sm text-luminous-gold font-bold uppercase">Lux</span></div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg border-l-2 border-luminous-gold shadow-lg">
                                    <div class="text-[10px] text-muted-blue uppercase tracking-widest mb-1 font-bold">ILUMINÂNCIA NO NÍVEL DO PISO</div>
                                    <div class="flex items-baseline justify-center gap-2"><span id="res-p-lux" class="text-4xl text-starlight font-light">333</span><span class="text-xs text-luminous-gold font-bold uppercase">Lux</span></div>
                                </div>
                            </div>

                            <div id="results-vertical" class="hidden grid grid-cols-1 gap-6 text-center">
                                <div class="bg-black/30 p-4 rounded-lg border-l-2 border-luminous-gold flex flex-col items-center">
                                    <div class="text-[10px] text-muted-blue uppercase tracking-widest mb-1 font-bold">Iluminância Vertical (Ev)</div>
                                    <div class="flex items-baseline gap-2"><span id="res-v-lux" class="text-5xl text-starlight font-light">0</span><span class="text-sm text-luminous-gold font-bold uppercase">Lux</span></div>
                                </div>
                            </div>

                            <div id="results-homog" class="hidden grid grid-cols-1 gap-6 text-center">
                                 <div class="bg-black/30 p-6 rounded-lg border-l-2 border-luminous-gold flex flex-col items-center justify-center">
                                    <div class="text-[10px] text-muted-blue uppercase tracking-widest mb-2 font-bold">Distribuição Luminosa</div>
                                    <p class="text-[11px] text-muted-blue opacity-80 max-w-md">O objetivo desta ferramenta é permitir analise rápida da distribuição da luz.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONSULTA (CENTRO DE CONSULTAS UNIFICADO) -->
                <div id="query-tool" class="hidden w-full animate-fade-in-up col-span-12">
                    <div class="glass-panel p-6 rounded-2xl">
                        
                        <!-- Navegação Interna -->
                        <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-white/10 pb-4 gap-4">
                            <div>
                                <h3 class="text-lg text-purple-400 font-bold tracking-widest flex items-center gap-2 uppercase">
                                    <i class="fas fa-search"></i> Centro de Consultas
                                </h3>
                                <p class="text-[10px] text-muted-blue mt-1">Acesso rápido a normas e referências técnicas.</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="switchQueryTab('nbr8995')" id="btn-q-nbr8995" class="query-tab-btn query-tab-active">Interiores (NBR 8995)</button>
                                <button onclick="switchQueryTab('nbr5101')" id="btn-q-nbr5101" class="query-tab-btn">Viária (NBR 5101)</button>
                                <button onclick="switchQueryTab('leed')" id="btn-q-leed" class="query-tab-btn">LEED / Well</button>
                            </div>
                        </div>

                        <!-- Barra de Busca -->
                        <div class="relative w-full mb-6">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-muted-blue text-xs"></i>
                            <input type="text" id="global-search" placeholder="Pesquisar ambiente, classe viária ou crédito..." 
                                class="w-full bg-black/40 border border-white/10 rounded-full py-2 pl-8 pr-4 text-xs text-white focus:border-purple-400 outline-none transition-all" 
                                oninput="filterQueryContent()">
                        </div>

                        <!-- Conteúdo: NBR 8995-1 -->
                        <div id="content-nbr8995" class="query-content">
                            <div class="overflow-hidden rounded-xl border border-white/10">
                                <div class="overflow-x-auto max-h-[300px] overflow-y-auto custom-scrollbar">
                                    <table class="w-full text-left border-collapse">
                                        <thead class="bg-white/5 text-[9px] text-luminous-gold font-bold uppercase tracking-wider sticky top-0 bg-midnight z-10">
                                            <tr><th class="p-4 border-b border-white/10">Categoria</th><th class="p-4 border-b border-white/10">Ambiente / Tarefa</th><th class="p-4 border-b border-white/10 text-center text-white">Lux (Em)</th><th class="p-4 border-b border-white/10 text-center">UGR Máx</th><th class="p-4 border-b border-white/10 text-center">Ra Min</th></tr>
                                        </thead>
                                        <tbody id="nbr8995-tbody" class="text-[11px] text-muted-blue divide-y divide-white/5"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Conteúdo: NBR 5101 -->
                        <div id="content-nbr5101" class="query-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 max-h-[300px] overflow-y-auto custom-scrollbar">
                                <!-- Classe M -->
                                <div class="bg-black/20 p-4 rounded-xl border border-white/5">
                                    <h4 class="text-sm font-bold text-leed-green mb-3 border-b border-white/10 pb-2">Classe M (Motorizados)</h4>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-[10px] text-center norm-table">
                                            <thead class="text-white bg-white/5"><tr><th class="p-1">Cl.</th><th class="p-1">Lmed</th><th class="p-1">U0</th><th class="p-1">Ul</th><th class="p-1">TI%</th></tr></thead>
                                            <tbody class="text-muted-blue divide-y divide-white/5">
                                                <tr><td>M1</td><td>2.0</td><td>0.40</td><td>0.70</td><td>10</td></tr>
                                                <tr><td>M2</td><td>1.5</td><td>0.40</td><td>0.70</td><td>10</td></tr>
                                                <tr><td>M3</td><td>1.0</td><td>0.40</td><td>0.60</td><td>15</td></tr>
                                                <tr><td>M4</td><td>0.75</td><td>0.40</td><td>0.60</td><td>15</td></tr>
                                                <tr><td>M5</td><td>0.50</td><td>0.35</td><td>0.40</td><td>15</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- Classe C -->
                                <div class="bg-black/20 p-4 rounded-xl border border-white/5">
                                    <h4 class="text-sm font-bold text-leed-green mb-3 border-b border-white/10 pb-2">Classe C (Conflito)</h4>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-[10px] text-center norm-table">
                                            <thead class="text-white bg-white/5"><tr><th class="p-1">Cl.</th><th class="p-1">Emed</th><th class="p-1">U0</th></tr></thead>
                                            <tbody class="text-muted-blue divide-y divide-white/5">
                                                <tr><td>C0</td><td>50</td><td>0.40</td></tr>
                                                <tr><td>C1</td><td>30</td><td>0.40</td></tr>
                                                <tr><td>C2</td><td>20</td><td>0.30</td></tr>
                                                <tr><td>C3</td><td>15</td><td>0.20</td></tr>
                                                <tr><td>C4</td><td>10</td><td>0.20</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- Classe P -->
                                <div class="bg-black/20 p-4 rounded-xl border border-white/5">
                                    <h4 class="text-sm font-bold text-leed-green mb-3 border-b border-white/10 pb-2">Classe P (Pedestres)</h4>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-[10px] text-center norm-table">
                                            <thead class="text-white bg-white/5"><tr><th class="p-1">Cl.</th><th class="p-1">Emed</th><th class="p-1">Emin</th></tr></thead>
                                            <tbody class="text-muted-blue divide-y divide-white/5">
                                                <tr><td>P1</td><td>20.0</td><td>5.0</td></tr>
                                                <tr><td>P2</td><td>10.0</td><td>2.0</td></tr>
                                                <tr><td>P3</td><td>7.5</td><td>1.5</td></tr>
                                                <tr><td>P4</td><td>5.0</td><td>1.0</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conteúdo: LEED -->
                        <div id="content-leed" class="query-content hidden">
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-h-[300px] overflow-y-auto custom-scrollbar">
                                <div class="bg-black/20 p-4 rounded-xl border border-white/5">
                                    <h4 class="text-sm font-bold text-green-400 mb-2">Crédito: Poluição Luminosa (BUG)</h4>
                                    <p class="text-[10px] text-muted-blue mb-2">Requer o uso de luminárias com classificação BUG adequada à Zona de Iluminação (LZ).</p>
                                    <table class="w-full text-[10px] text-left norm-table">
                                        <thead class="text-white border-b border-white/10"><tr><th class="p-1">Zona</th><th class="p-1">Descrição</th><th class="p-1">Uplight Max</th></tr></thead>
                                        <tbody class="text-muted-blue">
                                            <tr><td class="p-1">LZ0</td><td>Áreas Selvagens</td><td class="p-1">U0</td></tr>
                                            <tr><td class="p-1">LZ1</td><td>Rural / Parques</td><td class="p-1">U1</td></tr>
                                            <tr><td class="p-1">LZ2</td><td>Residencial / Leve</td><td class="p-1">U2</td></tr>
                                            <tr><td class="p-1">LZ3</td><td>Urbano / Comercial</td><td class="p-1">U3</td></tr>
                                            <tr><td class="p-1">LZ4</td><td>Centros de Alta Ativ.</td><td class="p-1">U4</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="bg-black/20 p-4 rounded-xl border border-white/5">
                                    <h4 class="text-sm font-bold text-green-400 mb-2">Crédito: Qualidade da Iluminação Interna</h4>
                                    <ul class="list-disc pl-4 text-[10px] text-muted-blue space-y-2">
                                        <li><strong>Controle:</strong> Fornecer controle individual de iluminação para 90% dos ocupantes.</li>
                                        <li><strong>Qualidade:</strong> Usar fontes de luz com CRI > 80.</li>
                                        <li><strong>Vida Útil:</strong> Luminárias LED devem ter L70 de pelo menos 50.000 horas.</li>
                                        <li><strong>Reflectância:</strong> Tetos > 85%, Paredes > 60%, Pisos > 25%.</li>
                                    </ul>
                                </div>
                             </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FUNDAMENTOS -->
    <section id="fundamentos" class="py-24 px-6 border-t border-white/5 bg-midnight">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-3xl text-luminous-gold font-bold tracking-widest mb-4 uppercase">FUNDAMENTOS</h2>
                <p class="text-sm text-muted-blue font-light max-w-4xl mx-auto leading-relaxed">
                    O LuxSintax foi projetado para otimizar a rotina técnica do Lighting Designer, trazendo agilidade e precisão para a tomada de decisão no dia a dia do projeto. É importante ressaltar que os resultados obtidos nesta ferramenta são simulações teóricas e não substituem a elaboração de um projeto luminotécnico completo por profissional habilitado. Fundamentada nos princípios da trigonometria e da fotometria clássica, apresentamos abaixo as equações fundamentais que regem esta ferramenta.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                 <!-- CARD 1 -->
                 <div class="glass-panel p-6 rounded-2xl relative group hover:border-luminous-gold/30 transition-all">
                    <div class="absolute top-0 right-0 p-4 opacity-30 text-luminous-gold"><i class="fas fa-calculator text-2xl"></i></div>
                    <h3 class="text-starlight text-[10px] font-bold mb-4 tracking-wider border-b border-luminous-gold/30 pb-2 inline-block">INTENSIDADE ABSOLUTA</h3>
                    <p class="text-muted-blue text-[10px] mb-4 font-light leading-relaxed min-h-[50px]">Converte dados fotométricos relativos para intensidade absoluta (Candelas).</p>
                    <div class="bg-black/40 p-3 rounded-lg text-center shadow-inner"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-medium whitespace-nowrap">I = (Φ · γ) / 1000</span></div>
                </div>
                 <!-- CARD 2 -->
                 <div class="glass-panel p-6 rounded-2xl relative group hover:border-luminous-gold/30 transition-all">
                    <div class="absolute top-0 right-0 p-4 opacity-30 text-luminous-gold"><i class="fas fa-lightbulb text-2xl"></i></div>
                    <h3 class="text-starlight text-[10px] font-bold mb-4 tracking-wider border-b border-luminous-gold/30 pb-2 inline-block">LEI DO COSSENO CÚBICO</h3>
                    <p class="text-muted-blue text-[10px] mb-4 font-light leading-relaxed min-h-[50px]">Variação da Lei do Inverso do Quadrado para superfícies horizontais.</p>
                    <div class="bg-black/40 p-3 rounded-lg text-center shadow-inner"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-medium whitespace-nowrap">E = (I · cos³θ) / h²</span></div>
                </div>
                 <!-- CARD 3 -->
                 <div class="glass-panel p-6 rounded-2xl relative group hover:border-luminous-gold/30 transition-all">
                    <div class="absolute top-0 right-0 p-4 opacity-30 text-luminous-gold"><i class="fas fa-ruler-combined text-2xl"></i></div>
                    <h3 class="text-starlight text-[10px] font-bold mb-4 tracking-wider border-b border-luminous-gold/30 pb-2 inline-block">GEOMETRIA DO FACHO</h3>
                    <p class="text-muted-blue text-[10px] mb-4 font-light leading-relaxed min-h-[50px]">Cálculo trigonométrico do diâmetro da mancha luminosa projetada.</p>
                    <div class="bg-black/40 p-3 rounded-lg text-center shadow-inner"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-medium whitespace-nowrap">Ø = 2 · d · tan(α/2)</span></div>
                </div>
                <!-- CARD 4 -->
                <div class="glass-panel p-6 rounded-2xl relative group hover:border-luminous-gold/30 transition-all">
                    <div class="absolute top-0 right-0 p-4 opacity-30 text-luminous-gold"><i class="fas fa-arrows-alt-v text-2xl"></i></div>
                    <h3 class="text-starlight text-[10px] font-bold mb-4 tracking-wider border-b border-luminous-gold/30 pb-2 inline-block">ILUMINÂNCIA VERTICAL</h3>
                    <p class="text-muted-blue text-[10px] mb-4 font-light leading-relaxed min-h-[50px]">Determina a iluminância em paredes a partir do ângulo de incidência.</p>
                    <div class="bg-black/40 p-3 rounded-lg text-center shadow-inner"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-medium whitespace-nowrap">Ev = (I · sin³θ) / d²</span></div>
                </div>
            </div>
        </div>
    </section>
    
    <footer class="bg-midnight py-12 px-6 border-t border-white/5 mt-auto text-[10px] tracking-widest text-muted-blue opacity-60">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left uppercase font-black">
            <div>
                <a href="#" class="text-lg font-bold tracking-[0.2em] text-luminous-gold uppercase">LuxSintax</a>
                <p class="mt-2">© 2026 LuxSintax. All rights reserved.</p>
            </div>
            <div class="flex gap-6 items-center">
                <a href="javascript:openTerms()" class="hover:text-luminous-gold transition-colors">Termos de Uso</a>
                <a href="https://www.instagram.com/sintaxedaluz/" target="_blank" class="hover:text-luminous-gold"><i class="fab fa-instagram text-base"></i></a>
                <a href="mailto:sintaxedaluz@gmail.com" class="text-muted-blue hover:text-luminous-gold"><i class="fas fa-envelope text-base"></i></a>
            </div>
        </div>
    </footer>

    <div id="terms-modal" class="hidden fixed inset-0 z-[110] bg-midnight/95 backdrop-blur-md flex justify-center items-center p-4">
        <div class="w-full max-w-2xl glass-panel p-8 rounded-3xl border border-white/10 uppercase">
            <h2 class="text-xl text-luminous-gold font-bold mb-6 border-b border-white/10 pb-4 tracking-tighter">TERMOS DE RESPONSABILIDADE</h2>
            <div class="max-h-60 overflow-y-auto text-[10px] text-muted-blue space-y-4 leading-relaxed pr-2">
                <h4 class="text-white font-bold mb-1">1. Natureza do Serviço e Isenção Técnica</h4>
                <p><strong>Simulação Teórica:</strong> O LuxSintax é definido como um simulador técnico baseado em cálculos fotométricos clássicos (como o Método Ponto a Ponto).</p>
                <p><strong>Não Substituição de Projeto:</strong> Os resultados apresentados são estimativas teóricas e não substituem o detalhamento de um projeto luminotécnico completo ou medições físicas no local.</p>
                <p><strong>Responsabilidade do Usuário:</strong> A responsabilidade técnica final pela especificação em obra, execução e conformidade normativa é integralmente do usuário profissional.</p>

                <h4 class="text-white font-bold mb-1 mt-4">2. Parâmetros e Normas</h4>
                <p><strong>Precisão de Dados:</strong> A precisão dos resultados depende diretamente da veracidade dos dados inseridos pelo usuário (como arquivos IES e dimensões do ambiente).</p>
                <p><strong>Referência Normativa:</strong> A ferramenta segue os parâmetros mais atuais, como a ASHRAE 90.1-2022 para eficiência energética e a NBR 8995-1 para iluminância interna.</p>

                <h4 class="text-white font-bold mb-1 mt-4">3. Termos de Assinatura e Privacidade (LGPD)</h4>
                <p><strong>Validade:</strong> O acesso PRO é pessoal, intransferível e válido por 12 meses.</p>
                <p><strong>Direito de Arrependimento:</strong> Conforme o Art. 49 do CDC, o usuário tem 7 dias para solicitar o reembolso total em caso de arrependimento.</p>
                <p><strong>Proteção de Dados:</strong> Os dados de login são usados apenas para gestão de acesso, e os pagamentos são processados de forma segura via Stripe, sem armazenamento de dados de cartão nos nossos servidores.</p>
            </div>
            <button onclick="closeTerms()" class="mt-8 w-full py-3 bg-luminous-gold text-midnight font-bold text-xs rounded-xl uppercase tracking-widest">Entendido</button>
        </div>
    </div>

    <script>
        const translations = {
            pt: {
                nav_calculator: "CALCULADORA", nav_concepts: "FUNDAMENTOS", nav_logout: "LOGOUT",
                tab_ponto: "SUPERFÍCIE HORIZONTAL", tab_vertical: "SUPERFÍCIE VERTICAL", tab_homog: "DISTRIBUIÇÃO & DESENHO",
                calc_params: "Parâmetros da Fonte", radio_intensity: "Intensidade (cd)", radio_photo: "Fotometria (cd/klm)",
                lic_active_pre: "VÁLIDO ATÉ:", concepts_title: "FUNDAMENTOS"
            },
            en: {
                nav_calculator: "CALCULATOR", nav_concepts: "FUNDAMENTALS", nav_logout: "LOGOUT",
                tab_ponto: "HORIZONTAL SURFACE", tab_vertical: "VERTICAL SURFACE", tab_homog: "DISTRIBUTION & DESIGN",
                calc_params: "Source Parameters", radio_intensity: "Intensity (cd)", radio_photo: "Photometry (cd/klm)",
                lic_active_pre: "VALID UNTIL:", concepts_title: "FUNDAMENTALS"
            }
        };

        let currentLang = 'pt';
        let currentTool = 'query'; 
        let calcMode = 'direct'; 

        const state = {
            user: { id: 'demo' },
            profile: { is_pro: true, license_expiry: '2027-12-31', isValid: true },
            ponto: { intensity: 3000, height: 3.0, beam: 30, tilt: 0, workPlane: 0.75, flux: 1500, cdklm: 2000 },
            vertical: { intensity: 3000, height: 3.0, dist: 1.0, tilt: 30, beam: 30, flux: 1500, cdklm: 2000, hq: 1.6 }, 
            homog: { height: 3.0, spacing: 2.0, workPlane: 0.75, beam: 30 },
        };

        // --- DADOS DA NORMA (NBR 8995-1) ---
        const normsDatabase = [
            { cat: "Escritório", room: "Escrita, digitação, leitura", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Desenho técnico", lux: 750, ugr: 16, ra: 80 },
            { cat: "Escritório", room: "Salas de reunião", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Recepção / Atendimento", lux: 300, ugr: 22, ra: 80 },
            { cat: "Escritório", room: "Arquivo", lux: 200, ugr: 25, ra: 80 },
            
            { cat: "Educacional", room: "Sala de aula comum", lux: 300, ugr: 19, ra: 80 },
            { cat: "Educacional", room: "Sala de aula noturna / Adultos", lux: 500, ugr: 19, ra: 80 },
            { cat: "Educacional", room: "Quadro negro (Vertical)", lux: 500, ugr: 19, ra: 80 },
            { cat: "Educacional", room: "Laboratório / Artes", lux: 500, ugr: 19, ra: 80 },
            
            { cat: "Saúde / Hospital", room: "Quarto (Geral)", lux: 100, ugr: 19, ra: 80 },
            { cat: "Saúde / Hospital", room: "Quarto (Leitura)", lux: 300, ugr: 19, ra: 80 },
            { cat: "Saúde / Hospital", room: "Exames e tratamento", lux: 1000, ugr: 19, ra: 90 },
            { cat: "Saúde / Hospital", room: "Sala de cirurgia (Geral)", lux: 1000, ugr: 19, ra: 90 },
            
            { cat: "Varejo / Lojas", room: "Área de vendas (Geral)", lux: 300, ugr: 22, ra: 80 },
            { cat: "Varejo / Lojas", room: "Vitrine (Destaque)", lux: "1000+", ugr: "-", ra: 80 },
            { cat: "Varejo / Lojas", room: "Caixa / Empacotamento", lux: 500, ugr: 19, ra: 80 },
            
            { cat: "Industrial", room: "Usinagem grosseira", lux: 300, ugr: 22, ra: 60 },
            { cat: "Industrial", room: "Usinagem fina / Precisão", lux: 500, ugr: 19, ra: 80 },
            { cat: "Industrial", room: "Montagem eletrônica", lux: 1000, ugr: 16, ra: 80 },
            { cat: "Industrial", room: "Depósito / Estoque", lux: 100, ugr: 25, ra: 60 },
            
            { cat: "Áreas Comuns", room: "Corredores / Circulação", lux: 100, ugr: 28, ra: 40 },
            { cat: "Áreas Comuns", room: "Escadas", lux: 150, ugr: 25, ra: 40 },
            { cat: "Áreas Comuns", room: "Banheiros", lux: 200, ugr: 25, ra: 80 },
            { cat: "Áreas Comuns", room: "Estacionamento Coberto", lux: 75, ugr: "-", ra: 40 }
        ];

        // --- LÓGICA DE FILTRO ---
        function filterNorms() {
            const input = document.getElementById('global-search');
            if (!input) return;
            
            const term = input.value.toLowerCase();
            const tbody = document.getElementById('nbr8995-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = "";

            const filtered = normsDatabase.filter(n => 
                n.cat.toLowerCase().includes(term) || 
                n.room.toLowerCase().includes(term)
            );

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="p-6 text-center text-gray-500">Nenhum ambiente encontrado. Tente "Escritório" ou "Saúde".</td></tr>`;
                return;
            }

            filtered.forEach(n => {
                const row = document.createElement('tr');
                row.className = "hover:bg-white/5 transition-colors border-b border-white/5";
                row.innerHTML = `
                    <td class="p-4 font-bold text-purple-300">${n.cat}</td>
                    <td class="p-4 text-white">${n.room}</td>
                    <td class="p-4 text-center font-bold text-luminous-gold text-lg">${n.lux}</td>
                    <td class="p-4 text-center text-muted-blue">${n.ugr}</td>
                    <td class="p-4 text-center text-muted-blue">${n.ra}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function switchQueryTab(tabName) {
            // Atualiza botões
            document.querySelectorAll('.query-tab-btn').forEach(btn => btn.classList.remove('query-tab-active'));
            document.getElementById('btn-q-' + tabName).classList.add('query-tab-active');

            // Atualiza conteúdo
            document.querySelectorAll('.query-content').forEach(content => content.classList.add('hidden'));
            document.getElementById('content-' + tabName).classList.remove('hidden');

            // Se for a aba NBR 8995, garantir que a tabela seja renderizada
            if (tabName === 'nbr8995') filterNorms();
        }

        function filterQueryContent() {
            // Se a aba ativa for a 8995, filtra a tabela
            const activeTab = document.querySelector('.query-tab-active');
            if (activeTab && activeTab.id === 'btn-q-nbr8995') {
                filterNorms();
            }
            // Futuramente pode filtrar as outras abas se necessário
        }


        const tabs = ['ponto', 'vertical', 'homog', 'query'];

        function switchTool(toolId) {
            currentTool = toolId;
            tabs.forEach(id => {
                const btn = document.getElementById('tab-' + id);
                if(btn) {
                    let cls = "mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all whitespace-nowrap ";
                    if (id === 'query') cls += "text-purple-400 ";
                    btn.className = cls + (id === toolId ? "tab-active" : "tab-inactive");
                }
            });

            document.getElementById('visual-tools').classList.toggle('hidden', toolId === 'query');
            document.getElementById('query-tool').classList.toggle('hidden', toolId !== 'query');

            if (toolId === 'query') switchQueryTab('nbr8995'); // Inicia na primeira aba
            else {
                ['inputs-ponto', 'inputs-vertical', 'inputs-homog'].forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.classList.add('hidden');
                });
                const selectedInput = document.getElementById('inputs-' + (toolId === 'homog' ? 'homog' : toolId));
                if (selectedInput) selectedInput.classList.remove('hidden');

                ['results-ponto', 'results-vertical', 'results-homog'].forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.classList.add('hidden');
                });
                const selectedResult = document.getElementById('results-' + (toolId === 'homog' ? 'homog' : toolId));
                if (selectedResult) { selectedResult.classList.remove('hidden'); selectedResult.classList.add('grid'); }
                updateCalcMode(calcMode);
                updateCalculations();
            }
        }

        function updateCalcMode(mode) {
            calcMode = mode;
            document.querySelectorAll('.mode-direct-group').forEach(el => el.classList.toggle('hidden', mode !== 'direct'));
            document.querySelectorAll('.mode-photo-group').forEach(el => el.classList.toggle('hidden', mode !== 'photometric'));
            updateCalculations();
        }

        function updateLicenseDisplay(profile) {
            const el = document.getElementById('license-date-text');
            const statusDiv = document.getElementById('license-status');
            const t = translations[currentLang];
            if (!el || !statusDiv) return;
            if (profile.isValid && profile.license_expiry) {
                const parts = profile.license_expiry.split('-');
                el.innerText = `${t.lic_active_pre} ${parts[2]}/${parts[1]}/${parts[0]}`;
                statusDiv.classList.remove('hidden');
                statusDiv.classList.add('inline-flex');
            }
        }

        function getIntensity(s) {
            if (calcMode === 'direct') return s.intensity;
            return (s.cdklm * s.flux) / 1000;
        }

        function updateCalculations() {
            const canvas = document.getElementById('beamCanvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d'), cw = canvas.width = canvas.clientWidth, ch = canvas.height = canvas.clientHeight;
            const floorY = ch - 70, centerX = cw / 2;

            // Lógica de Escala Dinâmica (Auto-Zoom) para Altura e Largura
            let boundsH = 3.0;
            let boundsW = 3.0; 

            if (currentTool === 'ponto') {
                const s = state.ponto;
                boundsH = s.height;
                const maxAngleRad = (Math.abs(s.tilt) + s.beam/2) * Math.PI / 180;
                const limitRad = Math.min(maxAngleRad, 85 * Math.PI / 180); 
                boundsW = s.height * Math.tan(limitRad);
            } 
            else if (currentTool === 'vertical') {
                const s = state.vertical;
                boundsH = s.height;
                // Ajuste para garantir que o facho caiba, considerando a parede e a fonte
                // Aumentando a margem lateral para garantir visualização completa do facho E da parede
                // Se a distancia for pequena, o facho pode ir longe na altura.
                // Se a distancia for grande, a parede ta longe.
                boundsW = Math.max(s.dist * 1.8, 3.0); 
            } 
            else if (currentTool === 'homog') {
                const s = state.homog;
                boundsH = s.height;
                const halfBeamRad = (s.beam/2) * Math.PI / 180;
                boundsW = (s.spacing / 2) + (s.height * Math.tan(halfBeamRad));
            }

            const availH = floorY - 50; 
            const availW = (cw / 2) - 40; 
            
            const scaleH = availH / Math.max(boundsH, 0.5);
            const scaleW = availW / Math.max(boundsW, 0.5);

            let scale = Math.min(scaleH, scaleW);
            scale = Math.min(Math.max(scale, 10), 150);

            ctx.clearRect(0, 0, cw, ch);
            ctx.lineWidth = 2;

            const drawFloor = () => { 
                ctx.strokeStyle = '#334155'; 
                ctx.lineWidth = 2; 
                ctx.beginPath(); 
                ctx.moveTo(0, floorY); 
                ctx.lineTo(cw, floorY); 
                ctx.stroke(); 

                if (currentTool === 'ponto') {
                    ctx.fillStyle = "#94a3b8"; // Cor do HP
                    ctx.font = "10px Manrope";
                    ctx.textAlign = "left";
                    ctx.fillText("LINHA DE PISO (lp)", 10, floorY + 15);
                    ctx.fillText("lp: 0.00m", 10, floorY - 5);
                    
                    ctx.beginPath(); ctx.moveTo(0, floorY); ctx.lineTo(5, floorY); ctx.stroke();
                } else if (currentTool === 'vertical') {
                    ctx.fillStyle = "#94a3b8"; // Cor do HP
                    ctx.font = "10px Manrope";
                    ctx.textAlign = "left";
                    ctx.fillText("lp: 0.00m", 10, floorY - 5);
                }
            };
            const drawPlaneLine = (py, text) => { ctx.beginPath(); ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(148, 163, 184, 0.4)"; ctx.moveTo(0, py); ctx.lineTo(cw, py); ctx.stroke(); ctx.setLineDash([]); ctx.fillStyle = "#94a3b8"; ctx.font = "10px Manrope"; ctx.fillText(text, 10, py - 5); }; // Cor do HP
            const drawSource = (x, y) => { ctx.fillStyle = '#FBBF24'; ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI * 2); ctx.fill(); };
            const drawBeam = (x, y, bm, tl, op = 0.6) => {
                const H = floorY - y, tr = tl * Math.PI / 180, br = bm * Math.PI / 180;
                ctx.save(); ctx.translate(x, y);
                const g = ctx.createLinearGradient(0, 0, 0, H); g.addColorStop(0, `rgba(251, 191, 36, ${op})`); g.addColorStop(1, `rgba(251, 191, 36, 0)`);
                ctx.fillStyle = g; ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(H * Math.tan(tr - br / 2), H); ctx.lineTo(H * Math.tan(tr + br / 2), H); ctx.closePath(); ctx.fill(); ctx.restore();
            };
            const drawHeightLine = (x, y, hVal) => { ctx.beginPath(); ctx.setLineDash([2, 4]); ctx.moveTo(x - 20, y); ctx.lineTo(x - 10, y); ctx.strokeStyle = '#475569'; ctx.stroke(); ctx.setLineDash([]); ctx.font = "10px Manrope"; ctx.fillStyle = "#94a3b8"; ctx.fillText(`${hVal.toFixed(1)}m`, x - 45, y + 3); };
            const drawDimLine = (x1, y1, x2, y2, text) => { ctx.beginPath(); ctx.strokeStyle = "#94a3b8"; ctx.lineWidth = 1; ctx.moveTo(x1, y1 - 3); ctx.lineTo(x1, y1 + 3); ctx.moveTo(x1, y1); ctx.lineTo(x2, y1); ctx.moveTo(x2, y1 - 3); ctx.lineTo(x2, y1 + 3); ctx.stroke(); const mx = (x1 + x2) / 2, tw = ctx.measureText(text).width; ctx.fillStyle = "#0f172a"; ctx.fillRect(mx - tw / 2 - 2, y1 - 6, tw + 4, 12); ctx.fillStyle = "#94a3b8"; ctx.font = "10px Manrope"; ctx.fillText(text, mx - tw / 2, y1 + 3); };
            const drawDimLineVertical = (x, y1, y2, text) => { ctx.beginPath(); ctx.strokeStyle = "#94a3b8"; ctx.lineWidth = 1; ctx.moveTo(x, y1); ctx.lineTo(x, y2); ctx.stroke(); const cy = (y1 + y2) / 2; ctx.save(); ctx.translate(x, cy); ctx.rotate(-Math.PI/2); const tw = ctx.measureText(text).width; ctx.fillStyle = "#0f172a"; ctx.fillRect(-tw/2-2, -6, tw+4, 12); ctx.fillStyle = "#94a3b8"; ctx.font = "12px Manrope"; ctx.fillText(text, -tw/2, 4); ctx.restore(); };

            if (currentTool === 'ponto') {
                const s = state.ponto, I = getIntensity(s), sy = floorY - (s.height * scale), py = floorY - (s.workPlane * scale), tr = s.tilt * Math.PI / 180, br = s.beam * Math.PI / 180;
                
                const luxFloor = (I * Math.pow(Math.cos(tr), 3)) / (s.height ** 2);
                // Se workPlane > 0, calcular h efetivo
                const hEff = s.height - s.workPlane;
                const luxPlane = hEff > 0 ? (I * Math.pow(Math.cos(tr), 3)) / (hEff ** 2) : 0;
                
                const dia = 2 * (s.height / Math.cos(tr)) * Math.tan(br / 2); // Diâmetro aproximado no piso
                
                document.getElementById('res-p-lux').innerText = Math.round(luxFloor);
                document.getElementById('res-p-lux-plane').innerText = Math.round(luxPlane);
                
                drawFloor(); 
                drawSource(centerX, sy); 
                drawBeam(centerX, sy, s.beam, s.tilt); 
                drawHeightLine(centerX, sy, s.height); 
                drawPlaneLine(py, `hp: ${s.workPlane}m`);
                
                const hitXFloor = centerX + (s.height * scale) * Math.tan(tr);
                ctx.beginPath(); 
                ctx.setLineDash([5, 5]); 
                ctx.strokeStyle = "rgba(251, 191, 36, 0.4)";
                ctx.moveTo(centerX, sy); 
                ctx.lineTo(hitXFloor, floorY); 
                ctx.stroke(); 
                ctx.setLineDash([]);

                ctx.beginPath();
                ctx.arc(hitXFloor, floorY, 4, 0, Math.PI * 2);
                ctx.fillStyle = "#FBBF24";
                ctx.fill();

                if (hEff > 0) { 
                    const ix = centerX + (hEff * scale) * Math.tan(tr); 
                    ctx.beginPath(); 
                    ctx.arc(ix, py, 3, 0, Math.PI * 2); 
                    ctx.fillStyle = "#FBBF24"; 
                    ctx.fill(); 
                }
                const xL = (floorY - sy) * Math.tan(tr - br / 2), xR = (floorY - sy) * Math.tan(tr + br / 2); 
                drawDimLine(centerX + xL, floorY + 20, centerX + xR, floorY + 20, `Ø ${dia.toFixed(2)}m`);
                
            } else if (currentTool === 'vertical') {
                const s = state.vertical, I = getIntensity(s), sy = floorY - (s.height * scale), wx = centerX + (s.dist * scale), tr = s.tilt * Math.PI / 180;
                
                let ev = 0;
                if (s.tilt > 0) {
                     ev = (I * Math.pow(Math.sin(tr), 3)) / (s.dist * s.dist);
                }

                // Altura onde o eixo bate na parede
                let hitY_metric = s.height - (s.dist / Math.tan(tr));
                let hitY_px = floorY - (hitY_metric * scale);

                document.getElementById('res-v-lux').innerText = Math.round(ev);
                
                drawFloor(); 
                
                // Parede
                ctx.beginPath(); ctx.moveTo(wx, floorY); ctx.lineTo(wx, floorY - (s.height * scale * 1.5)); ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 3; ctx.stroke(); ctx.lineWidth = 2; 
                
                drawSource(centerX, sy);
                
                // Eixo do Quadro
                const hqY = floorY - (s.hq * scale);
                ctx.beginPath(); ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(148, 163, 184, 0.4)"; ctx.moveTo(0, hqY); ctx.lineTo(wx, hqY); ctx.stroke(); ctx.setLineDash([]);
                ctx.fillStyle = "#94a3b8"; // Cor do HP
                ctx.font = "10px Manrope"; 
                ctx.textAlign = "left"; 
                ctx.fillText(`EIXO DO QUADRO (hq): ${s.hq.toFixed(2)}m`, 10, hqY - 5);

                ctx.save(); 
                // Aumentando a área de clip
                ctx.beginPath(); ctx.rect(0, -1000, wx, floorY + 1000); ctx.clip(); 
                drawBeam(centerX, sy, s.beam, s.tilt, scale); 
                ctx.restore();
                
                if (s.tilt > 0) {
                    // Linha do eixo até a parede
                    ctx.beginPath(); ctx.moveTo(centerX, sy); ctx.lineTo(wx, hitY_px); ctx.strokeStyle = "rgba(255, 255, 255, 0.4)"; ctx.setLineDash([4, 4]); ctx.stroke(); ctx.setLineDash([]);
                    
                    // Ponto de impacto na parede (visualização)
                     if (hitY_metric > -10 && hitY_metric < s.height * 3) {
                        ctx.beginPath(); ctx.arc(wx, hitY_px, 3, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill();
                        ctx.beginPath(); ctx.moveTo(wx, hitY_px); ctx.lineTo(wx + 40, hitY_px); ctx.strokeStyle = "#FBBF24"; ctx.setLineDash([2, 2]); ctx.stroke(); ctx.setLineDash([]);
                        ctx.fillStyle = "#fff"; ctx.font = "bold 12px Manrope"; ctx.textAlign = "left"; ctx.fillText(Math.round(ev) + " LUX", wx + 45, hitY_px + 4);
                     }

                    // Se o raio atingir o chão antes da parede 
                    const hitXFloor = centerX + (s.height * scale) * Math.tan(tr);
                    if (hitXFloor < wx) { 
                         ctx.beginPath(); ctx.arc(hitXFloor, floorY, 4, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill();
                    }
                }
                
                drawHeightLine(centerX, sy, s.height, 12);
                
                drawDimLine(centerX, sy - 30, wx, sy - 30, `d: ${s.dist.toFixed(1)}m`, 12);
                
                drawDimLineVertical(wx + 15, floorY, hqY, `h_q: ${s.hq.toFixed(1)}m`, 12); 
            } else if (currentTool === 'homog') {
                const s = state.homog, sy = floorY - (s.height * scale), py = floorY - (s.workPlane * scale), hS = (s.spacing * scale) / 2, br = s.beam * Math.PI / 180, dia = 2 * s.height * Math.tan(br / 2);
                drawFloor(); drawPlaneLine(py, `hp: ${s.workPlane}m`, 12); drawSource(centerX - hS, sy); drawSource(centerX + hS, sy); drawBeam(centerX - hS, sy, s.beam, 0, 0.6); drawBeam(centerX + hS, sy, s.beam, 0, 0.6);
                ctx.beginPath(); ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.moveTo(centerX - hS, sy); ctx.lineTo(centerX - hS, floorY); ctx.moveTo(centerX + hS, sy); ctx.lineTo(centerX + hS, floorY); ctx.stroke(); ctx.setLineDash([]);
                drawHeightLine(centerX - hS, sy, s.height, 12); drawDimLine(centerX - hS, sy - 20, centerX + hS, sy - 20, `D: ${s.spacing.toFixed(1)}m`, 12);
                const xL = (centerX - hS) - (dia * scale / 2), xR = (centerX - hS) + (dia * scale / 2); drawDimLine(xL, floorY + 20, xR, floorY + 20, `Ø ${dia.toFixed(2)}m`, 12);
            }
        }

        // --- BINDING AND EVENTS ---
        function bind(id, key, param) { const el = document.getElementById(id); if(!el) return; el.addEventListener('input', (e) => { let val = parseFloat(e.target.value); const pairId = id.includes('range') ? id.replace('range-', '') : 'range-' + id, pairEl = document.getElementById(pairId); if(pairEl) pairEl.value = val; state[key][param] = val; updateCalculations(); }); }

        // Bindings...
        bind('p-intensity', 'ponto', 'intensity'); bind('range-p-intensity', 'ponto', 'intensity');
        bind('p-height', 'ponto', 'height'); bind('range-p-height', 'ponto', 'height');
        bind('p-plane', 'ponto', 'workPlane'); bind('range-p-plane', 'ponto', 'workPlane');
        bind('p-beam', 'ponto', 'beam'); bind('range-p-beam', 'ponto', 'beam');
        bind('p-tilt', 'ponto', 'tilt'); bind('range-p-tilt', 'ponto', 'tilt');
        bind('p-cdklm', 'ponto', 'cdklm'); bind('range-p-cdklm', 'ponto', 'cdklm');
        bind('p-flux', 'ponto', 'flux'); bind('range-p-flux', 'ponto', 'flux');

        bind('v-intensity', 'vertical', 'intensity'); bind('range-v-intensity', 'vertical', 'intensity');
        bind('v-height', 'vertical', 'height'); bind('range-v-height', 'vertical', 'height');
        bind('v-dist', 'vertical', 'dist'); bind('range-v-dist', 'vertical', 'dist');
        bind('v-tilt', 'vertical', 'tilt'); bind('range-v-tilt', 'vertical', 'tilt');
        bind('v-beam', 'vertical', 'beam'); bind('range-v-beam', 'vertical', 'beam');
        bind('v-cdklm', 'vertical', 'cdklm'); bind('range-v-cdklm', 'vertical', 'cdklm');
        bind('v-flux', 'vertical', 'flux'); bind('range-v-flux', 'vertical', 'flux');
        bind('v-hq', 'vertical', 'hq'); bind('range-v-hq', 'vertical', 'hq');

        bind('h-height', 'homog', 'height'); bind('range-h-height', 'homog', 'height');
        bind('h-plane', 'homog', 'workPlane'); bind('range-h-plane', 'homog', 'workPlane');
        bind('h-spacing', 'homog', 'spacing'); bind('range-h-spacing', 'homog', 'spacing');
        bind('h-beam', 'homog', 'beam'); bind('range-h-beam', 'homog', 'beam');

        function openTerms() { document.getElementById('terms-modal').classList.remove('hidden'); }
        function closeTerms() { document.getElementById('terms-modal').classList.add('hidden'); }
        function toggleLanguage() { currentLang = currentLang === 'pt' ? 'en' : 'pt'; document.querySelectorAll('.lang-display').forEach(e => e.innerText = currentLang === 'pt' ? 'PT / EN' : 'EN / PT'); updateCalculations(); updateLicenseDisplay(state.profile); }
        function handleLogout() { alert('Logout'); }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }

        document.addEventListener("DOMContentLoaded", () => {
            updateLicenseDisplay(state.profile); 
            // Inicia na ferramenta de consulta (query)
            switchTool('query'); 
            filterNorms();
        });
    </script>
</body>
</html>