<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WJ9RV22BTF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-WJ9RV22BTF');
    </script>

    <title>LuxSintax | Produtividade para LDs</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'midnight': '#f8fafc',
                        'twilight': '#ffffff',
                        'glass': 'rgba(255, 255, 255, 0.9)',
                        'luminous-gold': '#d97706',
                        'tech-cyan': '#0284c7',
                        'dim-gray': '#64748b',
                        'dim-line': '#e2e8f0',
                        'starlight': '#0f172a',
                        'leed-green': '#4d7c0f',
                        'muted-blue': '#475569'
                    },
                    fontFamily: { sans: ['Manrope', 'sans-serif'] },
                    backgroundImage: {
                        'blue-hour-gradient': 'linear-gradient(to bottom, #f8fafc, #f1f5f9)',
                        'gold-glow': 'radial-gradient(circle, rgba(217, 119, 6, 0.05) 0%, rgba(255, 255, 255, 0) 70%)'
                    },
                    animation: { 'fade-in-up': 'fadeInUp 0.8s ease-out forwards' },
                    keyframes: { fadeInUp: { '0%': { opacity: 0, transform: 'translateY(20px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } } }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Manrope', sans-serif; background-color: #f8fafc; color: #334155; background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%); letter-spacing: 0.5px; min-height: 100vh; transition: background 0.3s, color 0.3s; }
        h1, h2, h3, h4, .nav-link, button, input, label, select { text-transform: uppercase !important; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(0, 0, 0, 0.06); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.03); transition: background 0.3s, border-color 0.3s; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #d97706; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px rgba(217, 119, 6, 0.3); border: 2px solid #ffffff; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px; }
        input[type=number], select, input[type=text], input[type=date], input[type=email], input[type=password] { background-color: transparent; color: #0f172a; border: none; border-bottom: 1px solid #cbd5e1; text-align: left; width: 100%; font-family: 'Manrope', sans-serif; font-weight: 600; -moz-appearance: textfield; padding: 8px 0; transition: border-color 0.3s, color 0.3s; }
        input[type=number] { text-align: right; width: 65px; } 
        input:focus, select:focus { outline: none; border-bottom: 1px solid #d97706 !important; color: #d97706; }
        select.custom-select option { background-color: #ffffff; color: #0f172a; }
        input[type="file"] { font-size: 10px; color: #64748b; transition: color 0.3s; }
        input[type="file"]::file-selector-button { margin-right: 10px; border: 1px solid rgba(217, 119, 6, 0.3); background: rgba(217, 119, 6, 0.1); padding: 5px 10px; border-radius: 6px; color: #d97706; cursor: pointer; transition: all 0.2s; font-weight: bold; text-transform: uppercase; font-size: 9px; }
        input[type="file"]::file-selector-button:hover { background: rgba(217, 119, 6, 0.2); }
        .auth-input-group label { font-size: 10px; font-weight: 800; letter-spacing: 0.1em; text-transform: uppercase; color: #d97706 !important; }
        .auth-input-group input { width: 100%; text-align: left; font-weight: 400; }
        .app-locked { filter: blur(8px) grayscale(0.2); pointer-events: none; user-select: none; overflow: hidden; height: 100vh; transition: filter 0.5s ease; }
        .nav-link { position: relative; font-size: 0.85rem; letter-spacing: 2px; color: #64748b; font-weight: 700; transition: color 0.3s; }
        .nav-link:hover { color: #d97706; }
        .tab-active { border-bottom: 3px solid #d97706 !important; color: #d97706 !important; opacity: 1 !important; background-color: #fffbeb; font-weight: 800; box-shadow: 0 4px 15px rgba(217, 119, 6, 0.08); transition: background 0.3s, color 0.3s, border-color 0.3s; }
        .tab-inactive { border-bottom: 3px solid transparent !important; color: #64748b !important; opacity: 0.8; }
        .mode-tab-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 20px; min-width: 130px; height: 90px; border-radius: 12px; border: 1px solid #e2e8f0; background: #ffffff; transition: all 0.3s ease; position: relative; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .mode-tab-btn:hover { background: #f8fafc; transform: translateY(-2px); border-color: #cbd5e1; box-shadow: 0 6px 15px rgba(0,0,0,0.05); }
        .canvas-container { background: #ffffff; box-shadow: inset 0 0 15px rgba(0,0,0,0.02); border: 1px solid #e2e8f0; border-radius: 16px; transition: background 0.3s, border-color 0.3s; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.03); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(217, 119, 6, 0.3); border-radius: 4px; }
        .query-tab-btn { padding: 8px 16px; font-size: 10px; font-weight: bold; text-transform: uppercase; border-radius: 9999px; border: 1px solid #e2e8f0; transition: all 0.3s; color: #64748b; background: #ffffff; }
        .query-tab-active { background-color: #fffbeb; color: #d97706; border-color: #d97706; box-shadow: 0 2px 10px rgba(217, 119, 6, 0.1); }
        .leed-level-box { transition: all 0.3s; border: 1px solid #e2e8f0; opacity: 0.6; cursor: pointer; background: #ffffff; }
        .leed-level-box.active { opacity: 1; border-color: #d97706; background: #fffbeb; transform: scale(1.05); box-shadow: 0 4px 10px rgba(217, 119, 6, 0.1); }
        .well-toggle-group { cursor: pointer; border: 1px solid #e2e8f0; transition: all 0.3s; background: #ffffff; }
        .well-toggle-group.active { border-color: #0284c7; background: #f0f9ff; box-shadow: 0 2px 8px rgba(2, 132, 199, 0.1); }
        .cert-tab { cursor: pointer; padding: 8px 16px; border-radius: 6px; transition: all 0.3s; font-size: 11px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; }
        .cert-tab.active { background: #f7fee7; color: #4d7c0f; border: 1px solid #bef264; }
        .cert-tab.inactive { color: #64748b; opacity: 0.7; border: 1px solid transparent; }
        input[type="radio"] { appearance: none; background-color: transparent; margin: 0; font: inherit; color: #d97706; width: 1.15em; height: 1.15em; border: 2px solid #cbd5e1; border-radius: 50%; display: grid; place-content: center; }
        input[type="radio"]::before { content: ""; width: 0.65em; height: 0.65em; background-color: #d97706; border-radius: 50%; transform: scale(0); transition: 120ms transform ease-in-out; }
        input[type="radio"]:checked { border-color: #d97706; }
        input[type="radio"]:checked::before { transform: scale(1); }
        .bar-container { width: 100%; height: 6px; background-color: #e2e8f0; border-radius: 9999px; overflow: hidden; margin-top: 6px; transition: background-color 0.3s; }
        .bar-fill { height: 100%; border-radius: 9999px; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s; }

        /* DARK MODE CSS INJECT - LUXSINTAX ARCHITECTURE */
        html.dark body { background: linear-gradient(180deg, #0f172a 0%, #020617 100%); color: #cbd5e1; }
        html.dark nav { background: rgba(15, 23, 42, 0.95); border-color: #1e293b; }
        html.dark .glass-panel { background: rgba(30, 41, 59, 0.85); border-color: rgba(255, 255, 255, 0.05); }
        html.dark .text-starlight { color: #f8fafc; }
        html.dark .text-dim-gray { color: #94a3b8; }
        html.dark .bg-white { background-color: #1e293b; }
        html.dark .border-slate-200 { border-color: #334155; }
        html.dark .border-slate-300 { border-color: #475569; }
        html.dark .border-slate-100 { border-color: #1e293b; }
        html.dark .bg-slate-50 { background-color: #0f172a; }
        html.dark .bg-slate-100 { background-color: #1e293b; }
        html.dark .bg-slate-200 { background-color: #334155; }
        html.dark input, html.dark select, html.dark input[type=number], html.dark input[type=text], html.dark input[type=date], html.dark input[type=email], html.dark input[type=password] { color: #f8fafc; border-bottom-color: #475569; }
        html.dark select.custom-select option { background-color: #1e293b; color: #f8fafc; }
        html.dark .mode-tab-btn { background: #1e293b; border-color: #334155; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        html.dark .mode-tab-btn:hover { background: #0f172a; border-color: #475569; }
        html.dark .tab-active { background-color: rgba(217, 119, 6, 0.1); border-color: #d97706 !important; }
        html.dark .tab-inactive { color: #94a3b8 !important; }
        html.dark .canvas-container { background: #0f172a; border-color: #334155; box-shadow: inset 0 0 15px rgba(0,0,0,0.5); }
        html.dark .canvas-container > div.pointer-events-none { background-image: linear-gradient(#1e293b 1px, transparent 1px), linear-gradient(90deg, #1e293b 1px, transparent 1px) !important; opacity: 0.7 !important; }
        html.dark .query-tab-btn { background: #1e293b; border-color: #334155; color: #94a3b8; }
        html.dark .query-tab-active { background-color: rgba(217, 119, 6, 0.1); color: #d97706; border-color: #d97706; }
        html.dark .leed-level-box { background: #1e293b; border-color: #334155; }
        html.dark .leed-level-box.active { background: rgba(217, 119, 6, 0.1); border-color: #d97706; }
        html.dark .well-toggle-group { background: #1e293b; border-color: #334155; }
        html.dark .well-toggle-group.active { background: rgba(2, 132, 199, 0.1); border-color: #0284c7; }
        html.dark .cert-tab.active { background: rgba(77, 124, 15, 0.2); border-color: #bef264; color: #bef264; }
        html.dark #mobile-menu { background: #0f172a; border-color: #334155; }
        html.dark .bar-container { background-color: #334155; }
        html.dark th { background-color: #0f172a; color: #cbd5e1; border-color: #1e293b; }
        html.dark td { border-color: #1e293b; }
        html.dark tr.border-b { border-color: #1e293b; }
        html.dark .hover\:bg-slate-50:hover { background-color: #1e293b; }
        html.dark .divide-slate-100 > :not([hidden]) ~ :not([hidden]) { border-color: #1e293b; }
        html.dark .bg-amber-100 { background-color: rgba(217,119,6,0.2); border-color: rgba(217,119,6,0.3); }
        html.dark .bg-amber-50 { background-color: rgba(217,119,6,0.05); }
        html.dark .bg-lime-100 { background-color: rgba(77, 124, 15, 0.2); color: #a3e635; }
        html.dark .text-leed-green { color: #a3e635; }
        html.dark .border-leed-green { border-color: #a3e635; }
        html.dark .text-slate-600 { color: #94a3b8; }
        html.dark .text-slate-500 { color: #cbd5e1; }
        html.dark .text-slate-400 { color: #64748b; }
        html.dark input[type=range]::-webkit-slider-runnable-track { background: #334155; }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-luminous-gold selection:text-white transition-colors duration-300">

    <div id="auth-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 transition-all duration-500">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
        <div class="bg-white w-full max-w-md p-8 rounded-2xl relative z-10 animate-fade-in-up border border-slate-200 shadow-[0_20px_60px_rgba(0,0,0,0.15)]">
            <div id="auth-header-container" class="text-center mb-8">
                <div class="text-2xl font-black tracking-[0.2em] text-starlight mb-2">LUX<span class="text-luminous-gold font-light">SINTAX</span></div>
                <p class="text-[10px] text-dim-gray uppercase tracking-widest font-bold">CADASTRE-SE GRATUITAMENTE</p>
            </div>
            <div id="auth-tabs" class="flex border-b border-slate-200 mb-6">
                <button onclick="window.AuthManager.switchTab('login')" id="tab-auth-login" class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-luminous-gold border-b-2 border-luminous-gold transition-all">Login</button>
                <button onclick="window.AuthManager.switchTab('register')" id="tab-auth-register" class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-dim-gray hover:text-starlight transition-all">Cadastro</button>
            </div>
            <div id="form-login" class="space-y-6">
                <div class="auth-input-group"><label>E-mail</label><input type="email" id="login-email" placeholder="seu@email.com"></div>
                <div class="auth-input-group">
                    <label>Senha</label>
                    <div class="relative">
                        <input type="password" id="login-password" placeholder="••••••••" style="padding-right: 30px;">
                        <button type="button" onclick="window.togglePassword('login-password')" tabindex="-1" class="absolute right-0 bottom-2 text-slate-400 hover:text-luminous-gold transition-colors outline-none"><i id="icon-login-password" class="fas fa-eye"></i></button>
                    </div>
                    <div class="flex justify-end mt-2">
                        <button type="button" onclick="window.AuthManager.showForgotPassword()" class="text-[9px] text-slate-400 hover:text-luminous-gold transition-colors font-bold uppercase tracking-widest outline-none" data-i18n="auth_forgot">Esqueceu a senha?</button>
                    </div>
                </div>
                <button onclick="window.AuthManager.handleLogin()" class="w-full py-4 bg-luminous-gold text-white font-black rounded-lg uppercase tracking-widest text-xs hover:bg-amber-700 transition-colors shadow-lg">Acessar Plataforma</button>
            </div>
            <div id="form-register" class="space-y-5 hidden">
                <div class="grid grid-cols-2 gap-4"><div class="auth-input-group"><label>Nome</label><input type="text" id="reg-name" placeholder="Nome"></div><div class="auth-input-group"><label>Sobrenome</label><input type="text" id="reg-surname" placeholder="Sobrenome"></div></div>
                <div class="auth-input-group"><label>E-mail Corporativo</label><input type="email" id="reg-email" placeholder="nome@empresa.com"></div>
                <div class="auth-input-group">
                    <label>Senha</label>
                    <div class="relative">
                        <input type="password" id="reg-password" placeholder="Crie uma senha forte" style="padding-right: 30px;">
                        <button type="button" onclick="window.togglePassword('reg-password')" tabindex="-1" class="absolute right-0 bottom-2 text-slate-400 hover:text-luminous-gold transition-colors outline-none"><i id="icon-reg-password" class="fas fa-eye"></i></button>
                    </div>
                </div>
                <div class="flex items-start gap-2 mt-2"><input type="checkbox" id="reg-terms" class="mt-1 w-3 h-3 accent-luminous-gold"><label for="reg-terms" class="text-[10px] leading-tight text-dim-gray font-bold cursor-pointer">Concordo com os termos de uso.</label></div>
                <button onclick="window.AuthManager.handleRegister()" class="w-full py-4 bg-transparent border-2 border-luminous-gold text-luminous-gold font-black rounded-lg uppercase tracking-widest text-xs hover:bg-luminous-gold hover:text-white transition-colors">Criar Conta Gratuita</button>
            </div>
            
            <div id="form-forgot-password" class="space-y-5 hidden">
                <div class="text-center mb-4">
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest" data-i18n="auth_forgot_desc">Digite seu e-mail para receber um link de recuperação.</p>
                </div>
                <div class="auth-input-group">
                    <label>E-mail</label>
                    <input type="email" id="forgot-email" placeholder="seu@email.com">
                </div>
                <button onclick="window.AuthManager.handlePasswordResetRequest()" class="w-full py-4 bg-luminous-gold text-white font-black rounded-lg uppercase tracking-widest text-xs hover:bg-amber-700 transition-colors shadow-lg" data-i18n="auth_send_link">Enviar Link</button>
                <div class="text-center mt-2">
                    <button type="button" onclick="window.AuthManager.backToLogin()" class="text-[9px] text-slate-400 hover:text-luminous-gold transition-colors font-bold uppercase tracking-widest outline-none" data-i18n="auth_back_login">Voltar ao Login</button>
                </div>
            </div>
        </div>
    </div>

    <div id="app-content" class="transition-all duration-700 app-locked flex flex-col min-h-screen">
        <nav class="fixed w-full z-50 bg-white/95 backdrop-blur-xl border-b border-slate-200 shadow-sm transition-colors duration-300">
            <div class="max-w-[1800px] mx-auto px-6 py-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <a href="#" class="text-xl font-black tracking-[0.2em] text-starlight">LUX<span class="text-luminous-gold font-light">SINTAX</span></a>
                    <span class="bg-amber-100 text-luminous-gold text-[9px] font-black px-2 py-0.5 rounded border border-amber-200 tracking-widest animate-pulse">BETA</span>
                </div>
                <div class="hidden md:flex gap-8 items-center">
                    <a href="#calculadora" class="nav-link"><span data-i18n="nav_home">INICIO</span></a>
                    <a href="#fundamentos" class="nav-link" data-i18n="nav_about">SOBRE</a>
                    <button onclick="window.toggleLanguage()" class="text-xs text-dim-gray hover:text-luminous-gold transition-colors font-bold tracking-widest border-l border-slate-300 pl-4 uppercase"><span class="lang-display">PT / EN</span></button>
                    <button onclick="window.toggleTheme()" class="text-xs text-dim-gray hover:text-luminous-gold transition-colors font-bold tracking-widest border-l border-slate-300 pl-4 uppercase" title="Alternar Tema">
                        <i class="fas fa-moon dark:hidden"></i><i class="far fa-sun hidden dark:inline"></i>
                    </button>
                    <div id="user-display" class="flex items-center gap-2 pl-4 border-l border-slate-300">
                        <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-starlight font-bold text-xs border border-slate-200"><i class="fas fa-user"></i></div>
                        <div class="flex flex-col">
                            <span id="user-name-display" class="text-[10px] font-black text-starlight uppercase leading-none">Usuário</span>
                            <div class="flex items-center gap-2 mt-1">
                                <button onclick="window.AuthManager.openProfile()" class="text-[9px] text-dim-gray hover:text-luminous-gold text-left uppercase font-bold transition-colors" data-i18n="nav_profile">PERFIL</button>
                                <span class="text-slate-300 text-[8px]">|</span>
                                <button onclick="window.AuthManager.logout()" class="text-[9px] text-dim-gray hover:text-red-500 text-left uppercase font-bold transition-colors" data-i18n="nav_logout">SAIR</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="md:hidden text-starlight text-2xl cursor-pointer" onclick="window.toggleMobileMenu()"><i class="fas fa-bars"></i></div>
            </div>
            <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-white border-b border-slate-200 p-6 flex flex-col gap-6 shadow-2xl transition-all duration-300">
                 <a href="#calculadora" onclick="window.toggleMobileMenu()" class="text-sm font-bold tracking-widest text-starlight hover:text-luminous-gold" data-i18n="nav_home">INICIO</a>
                 <a href="#fundamentos" onclick="window.toggleMobileMenu()" class="text-sm font-bold tracking-widest text-starlight hover:text-luminous-gold" data-i18n="nav_about">SOBRE</a>
                 <button onclick="window.AuthManager.openProfile(); window.toggleMobileMenu()" class="text-sm font-bold tracking-widest text-starlight hover:text-luminous-gold text-left uppercase" data-i18n="nav_profile">PERFIL</button>
                 <button onclick="window.AuthManager.logout()" class="text-sm font-bold tracking-widest text-red-500 text-left" data-i18n="nav_logout">SAIR</button>
                 <div class="h-[1px] bg-slate-200 w-full"></div>
                 <button onclick="window.toggleLanguage(); window.toggleMobileMenu()" class="text-sm font-bold tracking-widest text-starlight hover:text-luminous-gold text-left lang-display">PT / EN</button>
                 <button onclick="window.toggleTheme(); window.toggleMobileMenu()" class="text-sm font-bold tracking-widest text-starlight hover:text-luminous-gold text-left uppercase">
                    <i class="fas fa-moon dark:hidden"></i><i class="far fa-sun hidden dark:inline"></i> TEMA
                 </button>
            </div>
        </nav>

        <section id="calculadora" class="pt-24 pb-10 px-4 md:px-8 relative min-h-screen">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-gold-glow pointer-events-none opacity-50"></div>
            <div class="max-w-[1800px] mx-auto flex flex-col items-center">
                <div class="flex justify-start w-full gap-4 sm:gap-6 mb-8 relative z-10 fade-in-up overflow-x-auto pb-2 custom-scrollbar">
                    <button onclick="window.switchTool('ponto')" id="tab-ponto" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap"><i class="fas fa-grip-lines text-lg mb-1"></i><span data-i18n="tab_horiz">SUPERFÍCIE<br>HORIZONTAL</span></button>
                    <button onclick="window.switchTool('vertical')" id="tab-vertical" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap"><i class="fas fa-grip-lines-vertical text-lg mb-1"></i><span data-i18n="tab_vert">SUPERFÍCIE<br>VERTICAL</span></button>
                    <button onclick="window.switchTool('homog')" id="tab-homog" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap"><i class="fas fa-drafting-compass text-lg mb-1"></i><span data-i18n="tab_dist">ESTUDO DE<br>FACHO</span></button>
                    <button onclick="window.switchTool('grid')" id="tab-grid" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap"><i class="fas fa-th text-lg mb-1"></i><span data-i18n="tab_grid">DISTRIBUIÇÃO<br>EM PLANTA</span></button>
                    <button onclick="window.switchTool('query')" id="tab-query" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-active whitespace-nowrap text-luminous-gold ml-auto"><i class="fas fa-search text-lg mb-1"></i><span data-i18n="tab_query">CONSULTA<br>(NBR/LEED)</span></button>
                </div>

                <div id="calculator-interface" class="w-full relative">
                    <div id="visual-tools" class="grid grid-cols-1 lg:grid-cols-12 gap-8 w-full transition-opacity duration-300 hidden">
                        <div class="lg:col-span-3 flex flex-col gap-6">
                            <div class="glass-panel p-6 rounded-2xl relative h-auto sticky top-24">
                                <div class="mb-6 border-b border-slate-200 pb-4">
                                    <label class="text-[10px] text-luminous-gold font-black uppercase tracking-widest mb-2 block" data-i18n="lbl_env_context">Contexto do Projeto (Uso)</label>
                                    <select id="global-env-selector" onchange="window.updateProjectContext(this.value)" class="w-full bg-slate-50 border-none rounded-lg py-2 px-3 text-[11px] text-starlight font-bold focus:ring-2 focus:ring-amber-100 outline-none transition-all custom-select uppercase cursor-pointer">
                                        <option value="none" data-i18n="opt_custom">Personalizado / Genérico</option>
                                    </select>
                                    <div id="target-display-box" class="hidden mt-3 flex items-center gap-2">
                                        <span class="text-[9px] bg-slate-100 px-2 py-0.5 rounded text-slate-500 font-bold uppercase tracking-wider dark:bg-slate-800">Target: <span id="target-lux-val">0</span> lx</span>
                                        <span class="text-[9px] bg-slate-100 px-2 py-0.5 rounded text-slate-500 font-bold uppercase tracking-wider dark:bg-slate-800">Ra: <span id="target-ra-val">0</span></span>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <h3 class="text-md text-starlight mb-2 font-black whitespace-nowrap text-center border-b border-slate-200 pb-3" data-i18n="calc_params">Parâmetros da Fonte</h3>
                                    <div id="calc-mode-selector" class="flex flex-row flex-wrap items-center justify-center gap-3 p-1 mb-6 mt-4 transition-opacity duration-300">
                                        <label class="flex items-center gap-1 cursor-pointer group"><input type="radio" name="calc_mode" value="direct" checked onchange="window.updateCalcMode('direct')"><span class="text-[9px] text-slate-600 group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap" data-i18n="lbl_intensity">INTENSIDADE (CD)</span></label>
                                        <label class="flex items-center gap-1 cursor-pointer group"><input type="radio" name="calc_mode" value="photometric" onchange="window.updateCalcMode('photometric')"><span class="text-[9px] text-slate-600 group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap" data-i18n="lbl_photometry">FOTOMETRIA</span></label>
                                        <label class="flex items-center gap-1 cursor-pointer group"><input type="radio" name="calc_mode" value="ies" onchange="window.updateCalcMode('ies')"><span class="text-[9px] text-slate-600 group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap" data-i18n="lbl_ies">IES</span></label>
                                    </div>
                                </div>
                                <div id="inputs-ponto" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_height">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="p-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-p-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_plane">PLANO DE TRABALHO (HP)</label><div class="flex items-baseline gap-1"><input type="number" id="p-plane" value="0.75" min="0" max="5" step="0.05"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-p-plane" min="0" max="5" step="0.05" value="0.75"></div>
                                    <div class="mode-standard-only">
                                        <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_beam">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="p-beam" value="30" min="5" max="120"><span class="text-[9px] text-slate-500 font-bold">°</span></div></div><input type="range" id="range-p-beam" min="5" max="120" step="1" value="30"></div>
                                    </div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_tilt">ORIENTAÇÃO (TILT)</label><div class="flex items-baseline gap-1"><input type="number" id="p-tilt" value="0" min="0" max="60"><span class="text-[9px] text-slate-500 font-bold">°</span></div></div><input type="range" id="range-p-tilt" min="0" max="60" step="1" value="0"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-slate-200 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_intensity_i">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="p-intensity" value="3000"><span class="text-[9px] text-slate-500 font-bold">CD</span></div></div><input type="range" id="range-p-intensity" min="0" max="20000" step="10" value="3000"></div>
                                    <div class="mode-photo-group hidden space-y-6 mb-6 border-t border-slate-200 pt-4">
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_flux">FLUXO LUMINOSO</label><div class="flex items-baseline gap-1"><input type="number" id="p-flux" value="1500"><span class="text-[9px] text-slate-500 font-bold">LM</span></div></div><input type="range" id="range-p-flux" min="0" max="10000" step="10" value="1500"></div>
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_photo_val">VALOR FOTOMÉTRICO</label><div class="flex items-baseline gap-1"><input type="number" id="p-cdklm" value="2000"><span class="text-[9px] text-slate-500 font-bold">CD/KLM</span></div></div><input type="range" id="range-p-cdklm" min="0" max="10000" step="10" value="2000"></div>
                                    </div>
                                    <div class="mode-ies-group hidden space-y-6 mb-6 border-t border-slate-200 pt-4">
                                        <div class="group">
                                            <label class="text-[10px] text-luminous-gold font-bold whitespace-nowrap mb-2 block" data-i18n="lbl_ies_upload">CARREGAR ARQUIVO .IES</label>
                                            <input type="file" id="p-ies-input" accept=".ies" onchange="window.handleIESUpload(this)" class="w-full text-dim-gray border-b border-slate-200 pb-2">
                                            <p id="p-ies-status" class="text-[9px] text-dim-gray mt-1 italic">Nenhum arquivo carregado.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="inputs-vertical" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_height">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="v-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-v-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap uppercase" data-i18n="lbl_hq">EIXO DO QUADRO (hq)</label><div class="flex items-baseline gap-1"><input type="number" id="v-hq" value="1.6" min="0" max="10" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-v-hq" min="0.5" max="10" step="0.1" value="1.6"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_wall_dist">DISTÂNCIA DA PAREDE (D)</label><div class="flex items-baseline gap-1"><input type="number" id="v-dist" value="1.0" min="0.5" max="10" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-v-dist" min="0.5" max="10" step="0.1" value="1.0"></div>
                                    <div class="mode-standard-only">
                                        <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_beam">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="v-beam" value="30" min="5" max="120"><span class="text-[9px] text-slate-500 font-bold">°</span></div></div><input type="range" id="range-v-beam" min="5" max="120" step="1" value="30"></div>
                                    </div>
                                    <div class="mb-2 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_tilt">ORIENTAÇÃO (TILT)</label><div class="flex items-baseline gap-1"><input type="number" id="v-tilt" value="30" min="0" max="90"><span class="text-[9px] text-slate-500 font-bold">°</span></div></div><input type="range" id="range-v-tilt" min="0" max="90" step="1" value="30"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-slate-200 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_intensity_i">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="v-intensity" value="3000"><span class="text-[9px] text-slate-500 font-bold">CD</span></div></div><input type="range" id="range-v-intensity" min="0" max="20000" step="10" value="3000"></div>
                                    <div class="mode-photo-group hidden space-y-6 mb-6 border-t border-slate-200 pt-4">
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_flux">FLUXO LUMINOSO</label><div class="flex items-baseline gap-1"><input type="number" id="v-flux" value="1500"><span class="text-[9px] text-slate-500 font-bold">LM</span></div></div><input type="range" id="range-v-flux" min="0" max="10000" step="10" value="1500"></div>
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_photo_val">VALOR FOTOMÉTRICO</label><div class="flex items-baseline gap-1"><input type="number" id="v-cdklm" value="2000"><span class="text-[9px] text-slate-500 font-bold">CD/KLM</span></div></div><input type="range" id="range-v-cdklm" min="0" max="10000" step="10" value="2000"></div>
                                    </div>
                                    <div class="mode-ies-group hidden space-y-6 mb-6 border-t border-slate-200 pt-4">
                                        <div class="group">
                                            <label class="text-[10px] text-luminous-gold font-bold whitespace-nowrap mb-2 block" data-i18n="lbl_ies_upload">CARREGAR ARQUIVO .IES</label>
                                            <input type="file" id="v-ies-input" accept=".ies" onchange="window.handleIESUpload(this)" class="w-full text-dim-gray border-b border-slate-200 pb-2">
                                            <p id="v-ies-status" class="text-[9px] text-dim-gray mt-1 italic">Nenhum arquivo carregado.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="inputs-homog" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_height">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="h-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-h-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_plane">PLANO DE TRABALHO (HP)</label><div class="flex items-baseline gap-1"><input type="number" id="h-plane" value="0.75" min="0" max="5" step="0.05"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-h-plane" min="0.5" max="5" step="0.05" value="0.75"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_spacing">DISTÂNCIA ENTRE FONTES (D)</label><div class="flex items-baseline gap-1"><input type="number" id="h-spacing" value="2.0" min="0.5" max="10" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-h-spacing" min="0.5" max="10" step="0.1" value="2.0"></div>
                                     <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_beam">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="h-beam" value="30" min="5" max="120"><span class="text-[9px] text-slate-500 font-bold">°</span></div></div><input type="range" id="range-h-beam" min="5" max="120" step="1" value="30"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-slate-200 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_intensity_i">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="h-intensity" value="3000"><span class="text-[9px] text-slate-500 font-bold">CD</span></div></div><input type="range" id="range-h-intensity" min="0" max="20000" step="10" value="3000"></div>
                                    <div class="mode-photo-group hidden space-y-6 mb-6 border-t border-slate-200 pt-4">
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_flux">FLUXO LUMINOSO</label><div class="flex items-baseline gap-1"><input type="number" id="h-flux" value="1500"><span class="text-[9px] text-slate-500 font-bold">LM</span></div></div><input type="range" id="range-h-flux" min="0" max="10000" step="10" value="1500"></div>
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_photo_val">VALOR FOTOMÉTRICO</label><div class="flex items-baseline gap-1"><input type="number" id="h-cdklm" value="2000"><span class="text-[9px] text-slate-500 font-bold">CD/KLM</span></div></div><input type="range" id="range-h-cdklm" min="0" max="10000" step="10" value="2000"></div>
                                    </div>
                                    <div class="mode-ies-group hidden space-y-6 mb-6 border-t border-slate-200 pt-4">
                                        <div class="group">
                                            <label class="text-[10px] text-luminous-gold font-bold whitespace-nowrap mb-2 block" data-i18n="lbl_ies_upload">CARREGAR ARQUIVO .IES</label>
                                            <input type="file" id="h-ies-input" accept=".ies" onchange="window.handleIESUpload(this)" class="w-full text-dim-gray border-b border-slate-200 pb-2">
                                            <p id="h-ies-status" class="text-[9px] text-dim-gray mt-1 italic">Nenhum arquivo carregado.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="inputs-grid" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_height">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="g-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-g-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_beam">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="g-beam" value="60" min="5" max="120"><span class="text-[9px] text-slate-500 font-bold">°</span></div></div><input type="range" id="range-g-beam" min="5" max="120" step="1" value="60"></div>
                                    <div class="mb-6 group border-t border-slate-200 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_room_w">LARGURA DO AMB. (X)</label><div class="flex items-baseline gap-1"><input type="number" id="g-roomW" value="6.0" min="1" max="30" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-g-roomW" min="1" max="30" step="0.1" value="6.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_room_l">COMPRIMENTO DO AMB. (Y)</label><div class="flex items-baseline gap-1"><input type="number" id="g-roomL" value="4.0" min="1" max="30" step="0.1"><span class="text-[9px] text-slate-500 font-bold unit-m-ft">M</span></div></div><input type="range" id="range-g-roomL" min="1" max="30" step="0.1" value="4.0"></div>
                                    
                                    <div class="mb-4 group border-t border-slate-200 pt-4">
                                        <label class="flex items-center justify-between cursor-pointer group">
                                            <span class="text-[10px] text-luminous-gold font-black uppercase tracking-wider" data-i18n="lbl_lumen_mode">MÉTODO DOS LÚMENS</span>
                                            <div class="relative">
                                                <input type="checkbox" id="g-lumenMode" onchange="window.toggleLumenMode(this.checked)" class="sr-only">
                                                <div class="block bg-slate-200 dark:bg-slate-600 w-8 h-5 rounded-full transition-colors duration-300" id="lumen-toggle-bg"></div>
                                                <div class="dot absolute left-1 top-1 bg-white w-3 h-3 rounded-full transition-transform duration-300" id="lumen-toggle-dot"></div>
                                            </div>
                                        </label>
                                        <div id="lumen-inputs" class="hidden mt-4 space-y-4 bg-amber-50 dark:bg-slate-800/50 p-4 rounded-xl border border-amber-100 dark:border-slate-700">
                                            <div class="group"><div class="flex justify-between items-end mb-1"><label class="text-[9px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_target_lux">ILUMINÂNCIA ALVO (EM)</label><div class="flex items-baseline gap-1"><input type="number" id="g-targetLux" value="500" min="50" max="5000" step="50"><span class="text-[8px] text-slate-500 font-bold">LX</span></div></div></div>
                                            <div class="group"><div class="flex justify-between items-end mb-1"><label class="text-[9px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_fixture_flux">FLUXO DA LUMINÁRIA</label><div class="flex items-baseline gap-1"><input type="number" id="g-flux" value="3000" min="100" max="100000" step="100"><span class="text-[8px] text-slate-500 font-bold">LM</span></div></div></div>
                                            <div class="group"><div class="flex justify-between items-end mb-1"><label class="text-[9px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_util_factor">FATOR UTILIZAÇÃO (U)</label><div class="flex items-baseline gap-1"><input type="number" id="g-utilFactor" value="0.60" min="0.1" max="1.0" step="0.05"></div></div></div>
                                            <div class="group"><div class="flex justify-between items-end mb-1"><label class="text-[9px] text-slate-500 font-bold whitespace-nowrap" data-i18n="lbl_maint_factor">FATOR MANUTENÇÃO (FM)</label><div class="flex items-baseline gap-1"><input type="number" id="g-maintFactor" value="0.80" min="0.1" max="1.0" step="0.05"></div></div></div>
                                        </div>
                                    </div>

                                    <div class="mb-6 group border-t border-slate-200 pt-4">
                                        <div class="flex flex-col mb-2">
                                            <label class="text-[10px] text-slate-500 font-bold whitespace-nowrap mb-1" data-i18n="lbl_grid_sug">MALHA SUGERIDA</label>
                                            <div class="flex items-center gap-2">
                                                <div id="grid-suggestion-display" class="text-3xl font-black text-tech-cyan tracking-tighter">2 <span class="text-sm text-slate-400 font-normal mx-1">X</span> 2</div>
                                                <span class="text-[10px] bg-slate-100 text-slate-500 px-2 py-1 rounded font-bold uppercase tracking-wider dark:bg-slate-800" data-i18n="lbl_grid_unit">PEÇAS</span>
                                            </div>
                                            <p id="grid-desc-display" class="text-[9px] text-slate-400 mt-2 italic font-semibold leading-relaxed" data-i18n="lbl_grid_desc">Distribuição autônoma visando 25% de sobreposição (overlap) do facho luminoso projetado.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-9 flex flex-col gap-6">
                            <div class="glass-panel p-6 rounded-2xl flex-grow flex flex-col relative h-full min-h-[600px]">
                                <div class="flex justify-between items-center mb-6 border-b border-slate-200 pb-4">
                                    <h3 class="text-sm text-starlight uppercase tracking-widest font-black" data-i18n="hdr_results">Resultados em Tempo Real</h3>
                                    <div id="compliance-tag" class="hidden px-4 py-1.5 rounded-full text-[10px] font-black tracking-widest uppercase transition-all duration-500"></div>
                                </div>
                                <div class="relative w-full flex-grow bg-white border border-slate-200 rounded-2xl mb-6 overflow-hidden canvas-container shadow-inner transition-colors duration-300">
                                    <div class="absolute inset-0 opacity-10 pointer-events-none" style="opacity: 0.4; background-image: linear-gradient(#e2e8f0 1px, transparent 1px), linear-gradient(90deg, #e2e8f0 1px, transparent 1px); background-size: 40px 40px;"></div>
                                    <canvas id="beamCanvas" class="w-full h-full relative z-10"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="query-tool" class="w-full animate-fade-in-up col-span-12">
                        <div class="glass-panel p-8 rounded-2xl">
                            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-slate-200 pb-4 gap-4">
                                <div><h3 class="text-lg text-luminous-gold font-black tracking-widest flex items-center gap-2 uppercase"><i class="fas fa-search"></i> <span data-i18n="hdr_query">Centro de Consultas</span></h3><p class="text-xs text-slate-500 mt-1 font-bold" data-i18n="query_subtitle">Acesso rápido a normas e referências técnicas.</p></div>
                                <div class="flex gap-2">
                                    <button onclick="window.switchQueryTab('nbr8995')" id="btn-q-nbr8995" class="query-tab-btn query-tab-active" data-i18n="tab_interiors">Interiores (NBR 8995)</button>
                                    <button onclick="window.switchQueryTab('nbr5101')" id="btn-q-nbr5101" class="query-tab-btn" data-i18n="tab_roadway">Viária (NBR 5101)</button>
                                    <button onclick="window.switchQueryTab('leed')" id="btn-q-leed" class="query-tab-btn">LEED / WELL</button>
                                </div>
                            </div>

                            <div id="search-container" class="flex flex-col md:flex-row gap-4 mb-6 w-full">
                                <div class="w-full md:w-1/3">
                                    <select id="category-filter" onchange="window.filterNorms()" class="w-full bg-slate-50 border border-slate-200 rounded-full py-3 px-6 text-sm text-starlight font-bold focus:border-luminous-gold focus:ring-2 focus:ring-amber-100 outline-none transition-all custom-select uppercase cursor-pointer shadow-sm">
                                        <option value="all" data-i18n="filter_all">Todas as Categorias</option>
                                    </select>
                                </div>
                                <div class="w-full md:w-2/3 relative">
                                    <div class="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none text-slate-400">
                                        <i class="fas fa-search"></i>
                                    </div>
                                    <input type="text" id="search-filter" onkeyup="window.filterNorms()" placeholder="Buscar ambiente ou tarefa..." data-i18n-placeholder="search_placeholder" class="w-full bg-slate-50 border border-slate-200 rounded-full !py-3 !pl-14 !pr-6 text-sm text-starlight font-bold focus:border-luminous-gold focus:ring-2 focus:ring-amber-100 outline-none transition-all shadow-sm uppercase placeholder:normal-case placeholder:font-medium placeholder:text-slate-400">
                                </div>
                            </div>

                            <div id="content-nbr8995" class="query-content">
                                <div class="overflow-hidden rounded-xl border border-slate-200 shadow-sm">
                                    <div class="overflow-x-auto max-h-[550px] overflow-y-auto custom-scrollbar">
                                        <table class="w-full text-left border-collapse bg-white">
                                            <thead class="bg-slate-100 text-xs text-slate-700 font-black uppercase tracking-wider sticky top-0 z-10 border-b border-slate-200">
                                                <tr><th class="p-4" data-i18n="col_cat">Categoria</th><th class="p-4" data-i18n="col_room">Ambiente / Tarefa</th><th class="p-4 text-center text-starlight bg-slate-200/50">Lux (Em)</th><th class="p-4 text-center">UGR Máx</th><th class="p-4 text-center">Ra Min</th></tr>
                                            </thead>
                                            <tbody id="nbr8995-tbody" class="text-sm text-slate-600 divide-y divide-slate-100 font-medium"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div id="content-nbr5101" class="query-content hidden">
                                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full">
                                    <div class="lg:col-span-5 flex flex-col gap-4">
                                        <div class="glass-panel p-5 rounded-xl border border-slate-200 bg-white">
                                            <h4 class="text-sm font-black text-luminous-gold mb-4 flex items-center gap-2 uppercase tracking-wider"><i class="fas fa-sliders-h"></i> <span data-i18n="road_params">Parâmetros da Via (Classe M)</span></h4>
                                            <div class="space-y-4">
                                                <div class="group"><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" data-i18n="lbl_speed">Velocidade (km/h)</label><select id="m-speed" onchange="window.calc5101()" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs text-starlight font-bold outline-none focus:border-luminous-gold transition-colors"><option value="2">Muito Alta (> 100)</option><option value="1">Alta (70 - 100)</option><option value="-1">Moderada (40 - 70)</option><option value="-2">Baixa (< 40)</option></select></div>
                                                <div class="group"><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" data-i18n="lbl_volume">Volume de Tráfego</label><select id="m-volume" onchange="window.calc5101()" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs text-starlight font-bold outline-none focus:border-luminous-gold transition-colors"><option value="1">Alto (> 65% capacidade)</option><option value="0" selected>Moderado (35-65%)</option><option value="-1">Baixo (< 35%)</option></select></div>
                                                <div class="group"><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" data-i18n="lbl_separation">Separação de Tráfego</label><select id="m-separation" onchange="window.calc5101()" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs text-starlight font-bold outline-none focus:border-luminous-gold transition-colors"><option value="0">Não (Pista Simples)</option><option value="-1">Sim (Canteiro Central)</option></select></div>
                                                <div class="group"><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" data-i18n="lbl_density">Densidade de Interseções</label><select id="m-density" onchange="window.calc5101()" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs text-starlight font-bold outline-none focus:border-luminous-gold transition-colors"><option value="1">Alta (> 3 por km)</option><option value="0" selected>Moderada (< 3 por km)</option></select></div>
                                                <div class="group"><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" data-i18n="lbl_complexity">Complexidade / Guiagem</label><select id="m-complexity" onchange="window.calc5101()" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs text-starlight font-bold outline-none focus:border-luminous-gold transition-colors"><option value="1">Alta / Guiagem Pobre</option><option value="0" selected>Normal / Guiagem Boa</option></select></div>
                                                <div class="group"><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" data-i18n="lbl_ambient">Luminância do Entorno</label><select id="m-ambient" onchange="window.calc5101()" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs text-starlight font-bold outline-none focus:border-luminous-gold transition-colors"><option value="1">Alta (Comercial/Urbano)</option><option value="0" selected>Moderada (Residencial)</option><option value="-1">Baixa (Rural)</option></select></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="lg:col-span-7">
                                        <div class="glass-panel p-6 rounded-xl border border-slate-200 bg-white h-full flex flex-col justify-center relative overflow-hidden shadow-sm">
                                            <div class="absolute inset-0 bg-gradient-to-br from-amber-50 to-transparent pointer-events-none"></div>
                                            <div class="text-center mb-8 relative z-10">
                                                <div class="text-[10px] text-slate-500 font-black uppercase tracking-[0.2em] mb-2" data-i18n="road_rec_class">Classe Recomendada</div>
                                                <div id="m-result-class" class="text-7xl font-black text-starlight mb-2 tracking-tighter">M3</div>
                                                <div id="m-result-desc" class="text-xs text-luminous-gold font-bold uppercase tracking-widest bg-amber-50 px-4 py-1.5 rounded-full border border-amber-200 inline-block">Vias Arteriais Secundárias</div>
                                            </div>
                                            <div class="space-y-5 px-4 max-w-md mx-auto w-full relative z-10">
                                                <div><div class="flex justify-between items-end mb-1"><span class="text-xs font-bold text-starlight uppercase" data-i18n="road_lmed">Luminância Média (Lmed)</span><span class="text-xs font-bold text-luminous-gold"><span id="res-lmed-val">1.0</span> <span class="text-[9px] text-slate-500">cd/m²</span></span></div><div class="bar-container"><div id="bar-lmed" class="bar-fill bg-luminous-gold" style="width: 50%;"></div></div><div class="text-[9px] text-slate-500 mt-1 text-right font-bold" data-i18n="road_ref_m1">Referência: M1 (2.0)</div></div>
                                                <div><div class="flex justify-between items-end mb-1"><span class="text-xs font-bold text-starlight uppercase" data-i18n="road_emed">Iluminância Média (Emed)</span><span class="text-xs font-bold text-starlight"><span id="res-emed-val">15</span> <span class="text-[9px] text-slate-500">Lux</span></span></div><div class="bar-container"><div id="bar-emed" class="bar-fill bg-slate-400" style="width: 50%;"></div></div><div class="text-[9px] text-slate-500 mt-1 text-right font-bold" data-i18n="road_approx">Aprox. para Asfalto Padrão</div></div>
                                                <div><div class="flex justify-between items-end mb-1"><span class="text-xs font-bold text-starlight uppercase" data-i18n="road_u0">Uniformidade Geral (U0)</span><span class="text-xs font-bold text-tech-cyan"><span id="res-u0-val">0.40</span></span></div><div class="bar-container"><div id="bar-u0" class="bar-fill bg-tech-cyan" style="width: 80%;"></div></div></div>
                                                <div><div class="flex justify-between items-end mb-1"><span class="text-xs font-bold text-starlight uppercase" data-i18n="road_ti">Ofuscamento Máx (TI)</span><span class="text-xs font-bold text-red-500"><span id="res-ti-val">15</span>%</span></div><div class="bar-container"><div id="bar-ti" class="bar-fill bg-red-500" style="width: 60%;"></div></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="content-leed" class="query-content hidden">
                                <div class="flex gap-2 mb-4 border-b border-slate-200 pb-2">
                                    <span onclick="window.switchCertTab('leed')" id="cert-tab-leed" class="cert-tab active">LEED v4.1 (BD+C)</span>
                                    <span onclick="window.switchCertTab('well')" id="cert-tab-well" class="cert-tab inactive">WELL v2</span>
                                </div>
                                <div id="pane-leed" class="max-h-[500px] overflow-y-auto custom-scrollbar pr-2">
                                    <div class="mb-6 bg-slate-50 p-6 rounded-xl border border-slate-200 shadow-sm transition-colors">
                                        <div class="flex justify-between items-center mb-4 border-b border-slate-200 pb-2">
                                            <h4 class="text-sm font-black text-luminous-gold flex items-center gap-2"><i class="fas fa-calculator"></i> <span data-i18n="leed_calc_title">Calculadora de Orçamento (LPD)</span></h4>
                                            <div class="text-[9px] bg-lime-100 px-2 py-1 rounded text-leed-green font-black">ASHRAE 90.1-2016</div>
                                        </div>
                                        <div class="flex flex-col md:flex-row gap-6 items-end mb-6">
                                            <div class="w-full md:w-1/2">
                                                <label class="text-[10px] text-slate-500 font-bold uppercase block mb-3" data-i18n="leed_select_target">Selecione a Meta de Certificação</label>
                                                <div class="grid grid-cols-4 gap-2 text-center">
                                                    <div onclick="window.setLeedTarget('certified')" id="lvl-certified" class="leed-level-box p-2 rounded"><div class="text-[9px] font-bold text-slate-400">CERTIFIED</div></div>
                                                    <div onclick="window.setLeedTarget('silver')" id="lvl-silver" class="leed-level-box p-2 rounded"><div class="text-[9px] font-bold text-slate-500">SILVER</div></div>
                                                    <div onclick="window.setLeedTarget('gold')" id="lvl-gold" class="leed-level-box p-2 rounded active"><div class="text-[9px] font-bold text-luminous-gold">GOLD</div></div>
                                                    <div onclick="window.setLeedTarget('platinum')" id="lvl-platinum" class="leed-level-box p-2 rounded"><div class="text-[9px] font-bold text-tech-cyan">PLATINUM</div></div>
                                                </div>
                                            </div>
                                            <div class="w-full md:w-1/4 text-right md:text-left"><div class="text-[10px] text-slate-500 font-bold uppercase mb-1" data-i18n="leed_reduction">Redução Aplicada</div><div id="leed-reduction-display" class="text-xl font-black text-leed-green">20%</div></div>
                                            <div class="w-full md:w-1/4"><label class="text-[10px] text-tech-cyan font-bold uppercase block mb-2" data-i18n="leed_area">Área do Projeto (m²)</label><div class="relative"><input type="number" id="leed-area-input" value="100" oninput="window.updateLeedTargets()" class="w-full bg-white border border-slate-300 rounded px-3 py-2 text-xs text-starlight font-bold outline-none focus:border-luminous-gold text-right pr-8"><span class="absolute right-3 top-2 text-xs text-tech-cyan font-bold">m²</span></div></div>
                                        </div>
                                        <table class="w-full text-xs text-left border-collapse bg-white rounded-lg overflow-hidden border border-slate-200 transition-colors">
                                            <thead class="text-starlight border-b border-slate-200 bg-slate-100 transition-colors"><tr><th class="p-3 font-bold" data-i18n="leed_type">Tipologia</th><th class="p-3 text-center font-bold text-slate-500">Base ASHRAE<br><span class="text-[9px] opacity-70 font-normal">(W/m²)</span></th><th class="p-3 text-center font-bold text-luminous-gold">Meta LPD<br><span class="text-[9px] opacity-70 font-normal">(W/m²)</span></th><th class="p-3 text-right font-bold text-tech-cyan"><span data-i18n="leed_allowance">CARGA PERMITIDA</span><br><span class="text-[9px] opacity-70 font-normal">(Watts)</span></th></tr></thead>
                                            <tbody id="leed-lpd-body" class="text-slate-600 text-xs font-semibold divide-y divide-slate-100 transition-colors"></tbody>
                                        </table>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm transition-colors"><h4 class="text-sm font-black text-leed-green mb-3 flex justify-between">EQ: Interior Lighting <span class="text-[10px] bg-lime-100 px-2 py-1 rounded text-leed-green">1-2 Pts</span></h4><ul class="list-disc pl-4 text-xs text-slate-600 space-y-2 font-medium"><li data-i18n="leed_eq_1"><strong class="text-starlight font-black">Controle:</strong> Individual para 90% dos ocupantes.</li><li data-i18n="leed_eq_2"><strong class="text-starlight font-black">Qualidade:</strong> CRI > 80, Vida > 24kh, Reflexão alta.</li></ul></div>
                                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm transition-colors"><h4 class="text-sm font-black text-leed-green mb-3 flex justify-between">SS: Light Pollution <span class="text-[10px] bg-lime-100 px-2 py-1 rounded text-leed-green">Req</span></h4><div class="text-xs text-slate-600 font-medium" data-i18n="leed_ss_1">Requisito <strong class="text-starlight font-black">BUG Rating</strong> (Backlight-Uplight-Glare) obrigatório conforme a Zona (LZ0 a LZ4).</div></div>
                                    </div>
                                </div>
                                <div id="pane-well" class="hidden max-h-[500px] overflow-y-auto custom-scrollbar pr-2">
                                    <div class="mb-6 bg-white p-6 rounded-xl border border-slate-200 shadow-sm transition-colors">
                                        <div class="flex justify-between items-center mb-6 border-b border-slate-200 pb-4">
                                            <div><h4 class="text-sm font-black text-tech-cyan flex items-center gap-2"><i class="fas fa-check-circle"></i> <span data-i18n="well_sim_title">Simulador de Créditos de Iluminação</span></h4><p class="text-[10px] text-slate-500 mt-1 font-bold" data-i18n="well_concept">Conceito: LIGHT (WELL v2)</p></div>
                                            <div class="text-right"><div class="text-[9px] text-slate-500 uppercase font-black" data-i18n="well_est_pts">Pontos Estimados</div><div id="well-total-score" class="text-2xl font-black text-starlight">0 <span class="text-xs text-slate-400 font-normal">/ 8</span></div></div>
                                        </div>
                                        <div class="mb-6"><div class="flex justify-between text-[9px] text-slate-500 mb-1 uppercase font-black"><span data-i18n="well_contrib">Contribuição para Certificação</span><span id="well-progress-text">0%</span></div><div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden"><div id="well-progress-bar" class="h-full bg-tech-cyan transition-all duration-500" style="width: 0%"></div></div></div>
                                        <div class="space-y-3">
                                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg border-l-4 border-leed-green shadow-sm transition-colors"><div><div class="text-xs font-black text-starlight">L01: Light Exposure</div><div class="text-[10px] text-slate-600 font-medium" data-i18n="well_l01">Acesso à luz natural e visualização.</div></div><div class="text-[9px] bg-lime-100 text-leed-green px-2 py-1 rounded font-black uppercase" data-i18n="well_req">Obrigatório</div></div>
                                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg border-l-4 border-leed-green shadow-sm transition-colors"><div><div class="text-xs font-black text-starlight">L02: Visual Lighting Design</div><div class="text-[10px] text-slate-600 font-medium" data-i18n="well_l02">Níveis de iluminância adequados.</div></div><div class="text-[9px] bg-lime-100 text-leed-green px-2 py-1 rounded font-black uppercase" data-i18n="well_req">Obrigatório</div></div>
                                            <div onclick="window.toggleWellFeature(this, 3)" class="well-toggle-group p-3 rounded-lg flex items-center justify-between" data-points="3"><div class="flex items-center gap-3"><div class="well-check"><i class="fas fa-check text-[10px] opacity-0 transition-opacity text-tech-cyan"></i></div><div><div class="text-xs font-black text-starlight">L03: Circadian Lighting Design</div><div class="text-[10px] text-slate-600 font-medium" data-i18n="well_l03">Melanopic Lux > 240 (Workstations).</div></div></div><div class="text-xs font-black text-tech-cyan">+3 pts</div></div>
                                            <div onclick="window.toggleWellFeature(this, 2)" class="well-toggle-group p-3 rounded-lg flex items-center justify-between" data-points="2"><div class="flex items-center gap-3"><div class="well-check"><i class="fas fa-check text-[10px] opacity-0 transition-opacity text-tech-cyan"></i></div><div><div class="text-xs font-black text-starlight">L04: Glare Control</div><div class="text-[10px] text-slate-600 font-medium" data-i18n="well_l04">UGR < 16 / Gestão de brilho solar.</div></div></div><div class="text-xs font-black text-tech-cyan">+2 pts</div></div>
                                            <div onclick="window.toggleWellFeature(this, 2)" class="well-toggle-group p-3 rounded-lg flex items-center justify-between" data-points="2"><div class="flex items-center gap-3"><div class="well-check"><i class="fas fa-check text-[10px] opacity-0 transition-opacity text-tech-cyan"></i></div><div><div class="text-xs font-black text-starlight">L07: Electric Light Quality</div><div class="text-[10px] text-slate-600 font-medium" data-i18n="well_l07">CRI > 90, R9 > 50, Flicker < 90Hz.</div></div></div><div class="text-xs font-black text-tech-cyan">+2 pts</div></div>
                                            <div onclick="window.toggleWellFeature(this, 1)" class="well-toggle-group p-3 rounded-lg flex items-center justify-between" data-points="1"><div class="flex items-center gap-3"><div class="well-check"><i class="fas fa-check text-[10px] opacity-0 transition-opacity text-tech-cyan"></i></div><div><div class="text-xs font-black text-starlight">L08: Occupant Control</div><div class="text-[10px] text-slate-600 font-medium" data-i18n="well_l08">Controle de zonas e intensidade.</div></div></div><div class="text-xs font-black text-tech-cyan">+1 pt</div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="fundamentos" class="py-24 px-6 border-t border-slate-200 bg-white transition-colors duration-300">
            <div class="max-w-[1800px] mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-3xl text-starlight font-black tracking-widest mb-6 uppercase" data-i18n="about_title">SOBRE</h2>
                    <p class="text-sm text-slate-600 font-medium max-w-6xl mx-auto leading-relaxed text-justify" data-i18n="about_text">O LuxSintax nasce com um compromisso claro: transformar a agilidade na maior aliada do Lighting Designer. Em um mercado onde o tempo é escasso, projetamos um ecossistema que elimina a fricção entre a concepção criativa e a validação técnica.<br><br>Mais do que uma calculadora ponto a ponto, somos um hub de produtividade. Integramos ferramentas de cálculo ágeis com um motor de busca inteligente de normas (NBR ISO/CIE 8995-1 / NBR 5101:2024), permitindo que você valide níveis de iluminância e conformidade normativa em segundos.<br><br><strong>Nota Técnica:</strong> Fundamentada nos princípios da trigonometria e da fotometria clássica (Lei do Cosseno Cúbico), esta ferramenta oferece precisão matemática para estudos preliminares. Ressaltamos que os resultados são simulações teóricas de apoio à decisão e não substituem o cálculo complexo global (radiosidade) de um projeto executivo final assinado por profissional habilitado.</p>
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                     <div class="glass-panel p-6 rounded-2xl relative group hover:border-amber-300 transition-all h-full bg-white"><div class="absolute top-0 right-0 p-4 opacity-10 text-luminous-gold"><i class="fas fa-calculator text-3xl"></i></div><h3 class="text-starlight text-xs font-black mb-4 tracking-wider border-b border-amber-200 pb-2 inline-block" data-i18n="card_1_title">INTENSIDADE ABSOLUTA</h3><p class="text-slate-500 text-xs mb-4 font-semibold leading-relaxed min-h-[50px]" data-i18n="card_1_desc">Converte dados fotométricos relativos para intensidade absoluta (Candelas).</p><div class="bg-slate-50 border border-slate-100 p-3 rounded-lg text-center shadow-sm transition-colors"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-black whitespace-nowrap">I = (Φ · γ) / 1000</span></div></div>
                     <div class="glass-panel p-6 rounded-2xl relative group hover:border-amber-300 transition-all h-full bg-white"><div class="absolute top-0 right-0 p-4 opacity-10 text-luminous-gold"><i class="fas fa-lightbulb text-3xl"></i></div><h3 class="text-starlight text-xs font-black mb-4 tracking-wider border-b border-amber-200 pb-2 inline-block" data-i18n="card_2_title">LEI DO COSSENO CÚBICO</h3><p class="text-slate-500 text-xs mb-4 font-semibold leading-relaxed min-h-[50px]" data-i18n="card_2_desc">Variação da Lei do Inverso do Quadrado para superfícies horizontais.</p><div class="bg-slate-50 border border-slate-100 p-3 rounded-lg text-center shadow-sm transition-colors"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-black whitespace-nowrap">E = (I · cos³θ) / h²</span></div></div>
                     <div class="glass-panel p-6 rounded-2xl relative group hover:border-amber-300 transition-all h-full bg-white"><div class="absolute top-0 right-0 p-4 opacity-10 text-luminous-gold"><i class="fas fa-ruler-combined text-3xl"></i></div><h3 class="text-starlight text-xs font-black mb-4 tracking-wider border-b border-amber-200 pb-2 inline-block" data-i18n="card_3_title">GEOMETRIA DO FACHO</h3><p class="text-slate-500 text-xs mb-4 font-semibold leading-relaxed min-h-[50px]" data-i18n="card_3_desc">Cálculo trigonométrico do diâmetro da mancha luminosa projetada.</p><div class="bg-slate-50 border border-slate-100 p-3 rounded-lg text-center shadow-sm transition-colors"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-black whitespace-nowrap">Ø = 2 · d · tan(α/2)</span></div></div>
                     <div class="glass-panel p-6 rounded-2xl relative group hover:border-amber-300 transition-all h-full bg-white"><div class="absolute top-0 right-0 p-4 opacity-10 text-luminous-gold"><i class="fas fa-search-plus text-3xl"></i></div><h3 class="text-starlight text-xs font-black mb-4 tracking-wider border-b border-amber-200 pb-2 inline-block" data-i18n="card_4_title">CONSULTA NORMATIVA</h3><p class="text-slate-500 text-xs mb-4 font-semibold leading-relaxed min-h-[50px]" data-i18n="card_4_desc">Hub de inteligência integrando requisitos da NBR 8995-1, NBR 5101 e LEED/WELL.</p><div class="bg-slate-50 border border-slate-100 p-3 rounded-lg text-center shadow-sm transition-colors"><span class="text-xs sm:text-sm font-serif text-luminous-gold italic font-black whitespace-nowrap">Database + Compliance</span></div></div>
                </div>
            </div>
        </section>

        <footer class="bg-white py-12 px-6 border-t border-slate-200 mt-auto text-[10px] tracking-widest text-slate-400 transition-colors duration-300">
            <div class="max-w-[1800px] mx-auto text-center uppercase font-black">
                <a href="#" class="text-lg font-black tracking-[0.2em] text-starlight uppercase">Lux<span class="text-luminous-gold font-light">Sintax</span></a>
                <p class="mt-2">© 2026 LuxSintax. All rights reserved.</p>
                <div class="mt-4"><button onclick="window.openTerms()" class="hover:text-luminous-gold transition-colors border-b border-transparent hover:border-luminous-gold font-bold" data-i18n="footer_terms">Termo de Responsabilidade</button></div>
            </div>
        </footer>
    </div>

    <div id="terms-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="window.closeTerms()"></div>
        <div class="relative w-full max-w-lg bg-white border border-slate-200 rounded-2xl shadow-2xl p-8 animate-fade-in-up z-10 transition-colors">
            <h3 class="text-starlight font-black tracking-widest text-lg mb-6 uppercase text-center" data-i18n="terms_title">Termo de Responsabilidade e Uso</h3>
            <div class="text-xs text-slate-600 font-medium leading-relaxed text-justify space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar pr-2" id="terms-content">
                <p><strong class="text-starlight font-black">1. Natureza do Serviço e Otimização de Workflow</strong><br>O LuxSintax é uma plataforma SaaS projetada para otimizar o tempo e a produtividade do Lighting Designer na fase de concepção e pré-dimensionamento. O objetivo desta ferramenta é fornecer agilidade na validação de premissas e consultas normativas rápidas (NBR/ISO/CIE), permitindo que o profissional foque na estratégia criativa e técnica inicial.</p>
                <p><strong class="text-starlight font-black">2. Caráter Preliminar e Simulação Teórica</strong><br>Os resultados gerados — incluindo, mas não se limitando a, níveis de iluminância (Lux), cálculos de carga (LPD) e simulações de facho — são baseados em modelos matemáticos teóricos (como a Lei do Cosseno Cúbico e a Lei do Inverso do Quadrado).<br><br><strong class="text-starlight font-black">Limitação Técnica:</strong> Esta ferramenta não processa cálculos complexos de inter-reflexão de superfícies (radiosidade/ray-tracing) nem considera obstruções físicas reais do ambiente, depreciação luminosa por manutenção ou tolerâncias de fabricação de hardware.</p>
                <p><strong class="text-starlight font-black">3. Isenção de Responsabilidade Profissional (Hold Harmless)</strong><br>O uso dos dados gerados pelo LuxSintax para fins de execução de obra, compra de materiais ou submissão a órgãos certificadores (LEED, WELL, Procel, Prefeituras) é de inteira e exclusiva responsabilidade do usuário.<br><br><strong class="text-starlight font-black">Não Substituição:</strong> Os estudos realizados nesta plataforma não substituem o projeto executivo luminotécnico assinado por profissional habilitado, nem dispensam a validação final em softwares de cálculo global (ex: DIALux, Relux, AGi32).<br><strong class="text-starlight font-black">Danos Indiretos:</strong> A LuxSintax e seus desenvolvedores não se responsabilizam por erros de dimensionamento, prejuízos financeiros em compras de luminárias baseadas em estimativas preliminares, ou qualquer desconformidade encontrada em medições in loco após a instalação.</p>
                <p><strong class="text-starlight font-black">4. Responsabilidade do Profissional (User Warranty)</strong><br>Ao utilizar a plataforma, o usuário declara ser profissional capacitado e ciente de que a ferramenta funciona como um suporte à decisão. É dever do projetista verificar a vigência das normas técnicas citadas e aplicar os coeficientes de segurança adequados para cada tipologia de projeto.</p>
                <p><strong class="text-starlight font-black">5. Propriedade Intelectual e Disponibilidade (SaaS Terms)</strong><br>A plataforma é fornecida "as-is" (como está). Reservamo-nos o direito de realizar atualizações nos algoritmos de cálculo para melhor precisão, sem aviso prévio, visando sempre a evolução do estado-da-arte da ferramenta.</p>
            </div>
            <div class="mt-8 flex justify-center"><button onclick="window.closeTerms()" class="px-8 py-3 bg-luminous-gold text-white font-black rounded-full hover:bg-amber-700 transition-colors shadow-lg text-xs tracking-widest uppercase" data-i18n="terms_accept">Li, Compreendi e Aceito os Riscos</button></div>
        </div>
    </div>

    <div id="profile-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="window.AuthManager.closeProfile()"></div>
        <div class="relative w-full max-w-md bg-white border border-slate-200 rounded-2xl shadow-2xl p-8 animate-fade-in-up z-10 transition-colors">
            <h3 class="text-starlight font-black tracking-widest text-lg mb-6 uppercase text-center" data-i18n="profile_title">Configurações de Conta</h3>
            
            <div class="space-y-5">
                <div class="auth-input-group">
                    <label data-i18n="profile_email">E-mail de Cadastro</label>
                    <input type="text" id="profile-email-display" disabled class="disabled:opacity-60 disabled:cursor-not-allowed bg-slate-50 border-b border-slate-200 p-2">
                </div>
                <div class="auth-input-group">
                    <label data-i18n="profile_new_pass">Nova Senha</label>
                    <div class="relative">
                        <input type="password" id="profile-new-pass" placeholder="••••••••" style="padding-right: 30px;">
                        <button type="button" onclick="window.togglePassword('profile-new-pass')" tabindex="-1" class="absolute right-0 bottom-2 text-slate-400 hover:text-luminous-gold transition-colors outline-none"><i id="icon-profile-new-pass" class="fas fa-eye"></i></button>
                    </div>
                </div>
                <div class="auth-input-group">
                    <label data-i18n="profile_confirm_pass">Confirmar Nova Senha</label>
                    <div class="relative">
                        <input type="password" id="profile-confirm-pass" placeholder="••••••••" style="padding-right: 30px;">
                        <button type="button" onclick="window.togglePassword('profile-confirm-pass')" tabindex="-1" class="absolute right-0 bottom-2 text-slate-400 hover:text-luminous-gold transition-colors outline-none"><i id="icon-profile-confirm-pass" class="fas fa-eye"></i></button>
                    </div>
                </div>
                <button onclick="window.AuthManager.updatePassword()" class="w-full py-4 mt-2 bg-luminous-gold text-white font-black rounded-lg uppercase tracking-widest text-xs hover:bg-amber-700 transition-colors shadow-lg" data-i18n="profile_save">Atualizar Senha</button>
                
                <div class="border-t border-slate-200 mt-6 pt-6 text-center">
                    <a href="mailto:sintaxedalux@gmail.com" class="inline-flex items-center gap-2 text-xs uppercase tracking-widest font-black text-slate-400 hover:text-luminous-gold transition-colors" data-i18n="profile_help">
                        <i class="fas fa-envelope"></i> Ajuda e Suporte
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        const SUPABASE_URL = 'https://ozytwdhuxsdefnunzinm.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96eXR3ZGh1eHNkZWZudW56aW5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NjM2MjEsImV4cCI6MjA4NjIzOTYyMX0.G6d564WnaaUQVSjTjpCDEA4d6zaVMvB_NQpo1KtE24s';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- THEME INITIALIZATION ---
        window.toggleTheme = function() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('luxsintax_theme', isDark ? 'dark' : 'light');
            if (window.updateCalculations) window.updateCalculations();
        };

        if (localStorage.getItem('luxsintax_theme') === 'dark' || (!('luxsintax_theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // --- PASSWORD REVEAL ---
        window.togglePassword = function(id) {
            const input = document.getElementById(id);
            const icon = document.getElementById('icon-' + id);
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        };

        // 1. I18N DICTIONARY (LUXSINTAX UPDATE)
        window.i18n = {
            pt: {
                nav_home: "INICIO", nav_about: "SOBRE", tab_query: "CONSULTA<br>(NBR/LEED)", tab_horiz: "SUPERFÍCIE<br>HORIZONTAL", tab_vert: "SUPERFÍCIE<br>VERTICAL", tab_dist: "ESTUDO DE<br>FACHO", tab_grid: "DISTRIBUIÇÃO<br>EM PLANTA",
                calc_params: "Parâmetros da Fonte", lbl_intensity: "INTENSIDADE (CD)", lbl_photometry: "FOTOMETRIA", lbl_ies: "IES", lbl_ies_upload: "CARREGAR ARQUIVO .IES", lbl_height: "ALTURA DA FONTE (H)", lbl_plane: "PLANO DE TRABALHO (HP)", lbl_beam: "ABERTURA DO FACHO", lbl_tilt: "ORIENTAÇÃO (TILT)",
                lbl_intensity_i: "INTENSIDADE (I)", lbl_flux: "FLUXO LUMINOSO", lbl_photo_val: "VALOR FOTOMÉTRICO", lbl_hq: "EIXO DO QUADRO (hq)", lbl_wall_dist: "DISTÂNCIA DA PAREDE (D)", lbl_spacing: "DISTÂNCIA ENTRE FONTES (D)",
                lbl_room_w: "LARGURA DO AMB. (X)", lbl_room_l: "COMPRIMENTO DO AMB. (Y)", lbl_grid_sug: "MALHA SUGERIDA", lbl_grid_unit: "PEÇAS", lbl_grid_desc: "Distribuição autônoma visando 25% de sobreposição (overlap) do facho luminoso projetado.",
                hdr_results: "Resultados em Tempo Real", hdr_query: "Centro de Consultas", query_subtitle: "Acesso rápido a normas e referências técnicas.",
                tab_interiors: "Interiores (NBR 8995)", tab_roadway: "Viária (NBR 5101)", filter_all: "Todas as Categorias", col_cat: "Categoria", col_room: "Ambiente / Tarefa",
                road_params: "Parâmetros da Via (Classe M)", lbl_speed: "Velocidade (km/h)", lbl_volume: "Volume de Tráfego", lbl_separation: "Separação de Tráfego", lbl_density: "Densidade de Interseções", lbl_complexity: "Complexidade / Guiagem", lbl_ambient: "Luminância do Entorno",
                road_rec_class: "Classe Recomendada", road_lmed: "Luminância Média (Lmed)", road_ref_m1: "Referência: M1 (2.0)", road_emed: "Iluminância Média (Emed)", road_approx: "Aprox. para Asfalto Padrão", road_u0: "Uniformidade Geral (U0)", road_ti: "Ofuscamento Máx (TI)",
                leed_calc_title: "Calculadora de Orçamento (LPD)", leed_select_target: "Selecione a Meta de Certificação", leed_reduction: "Redução Aplicada", leed_area: "Área do Projeto (m²)", leed_type: "Tipologia", leed_allowance: "CARGA PERMITIDA",
                leed_eq_1: "<strong class=\"text-starlight font-black\">Controle:</strong> Individual para 90% dos ocupantes.", leed_eq_2: "<strong class=\"text-starlight font-black\">Qualidade:</strong> CRI > 80, Vida > 24kh, Reflexão alta.", leed_ss_1: "Requisito <strong class=\"text-starlight font-black\">BUG Rating</strong> (Backlight-Uplight-Glare) obrigatório conforme a Zona (LZ0 a LZ4).",
                well_sim_title: "Simulador de Créditos de Iluminação", well_concept: "Conceito: LIGHT (WELL v2)", well_est_pts: "Pontos Estimados", well_contrib: "Contribuição para Certificação",
                well_l01: "Acesso à luz natural e visualização.", well_req: "Obrigatório", well_l02: "Níveis de iluminância adequados.", well_l03: "Melanopic Lux > 240 (Workstations).", well_l04: "UGR < 16 / Gestão de brilho solar.", well_l07: "CRI > 90, R9 > 50, Flicker < 90Hz.", well_l08: "Zoning and intensity control.",
                about_title: "SOBRE", about_text: "O LuxSintax nasce com um compromisso claro: transformar a agilidade na maior aliada do Lighting Designer. Em um mercado onde o tempo é escasso, projetamos um ecossistema que elimina a fricção entre a concepção criativa e a validação técnica.<br><br>Mais do que uma calculadora ponto a ponto, somos um hub de produtividade. Integramos ferramentas de cálculo ágeis com um motor de busca inteligente de normas (NBR ISO/CIE 8995-1 / NBR 5101:2024), permitindo que você valide níveis de iluminância e conformidade normativa em segundos.<br><br><strong>Nota Técnica:</strong> Fundamentada nos princípios da trigonometria e da fotometria clássica (Lei do Cosseno Cúbico), esta ferramenta oferece precisão matemática para estudos preliminares. Ressaltamos que os resultados são simulações teóricas de apoio à decisão e não substituem o cálculo complexo global (radiosidade) de um projeto executivo final assinado por profissional habilitado.",
                card_1_title: "INTENSIDADE ABSOLUTA", card_1_desc: "Converte dados fotométricos relativos para intensidade absoluta (Candelas).", card_2_title: "LEI DO COSSENO CÚBICO", card_2_desc: "Variação da Lei do Inverso do Quadrado para superfícies horizontais.", card_3_title: "GEOMETRIA DO FACHO", card_3_desc: "Cálculo trigonométrico do diâmetro da mancha luminosa projetada.", card_4_title: "CONSULTA NORMATIVA", card_4_desc: "Hub de inteligência integrando requisitos da NBR 8995-1, NBR 5101 e LEED/WELL.",
                footer_terms: "Termo de Responsabilidade", terms_title: "Termo de Responsabilidade e Uso", terms_accept: "Li, Compreendi e Aceito os Riscos",
                nav_profile: "PERFIL", nav_logout: "SAIR", profile_title: "Configurações de Conta", profile_email: "E-mail de Cadastro", profile_new_pass: "Nova Senha", profile_confirm_pass: "Confirmar Nova Senha", profile_save: "Atualizar Senha", msg_pass_success: "Senha atualizada com sucesso!", msg_pass_mismatch: "As senhas não coincidem.", profile_help: "<i class=\"fas fa-envelope\"></i> Ajuda e Suporte",
                auth_forgot: "Esqueceu a senha?", auth_forgot_desc: "Digite seu e-mail para receber um link de recuperação.", auth_send_link: "Enviar Link", auth_back_login: "Voltar ao Login", msg_reset_sent: "Link de recuperação enviado para o seu e-mail!", msg_recovery_prompt: "Sessão de recuperação ativa. Por favor, defina sua nova senha agora.",
                search_placeholder: "Buscar ambiente ou tarefa...",
                lbl_lumen_mode: "MÉTODO DOS LÚMENS", lbl_target_lux: "ILUMINÂNCIA ALVO (EM)", lbl_fixture_flux: "FLUXO DA LUMINÁRIA", lbl_util_factor: "FATOR UTILIZAÇÃO (U)", lbl_maint_factor: "FATOR MANUTENÇÃO (FM)",
                lbl_env_context: "Contexto do Projeto (Uso)", opt_custom: "Personalizado / Genérico", tag_compliant: "Conforme NBR", tag_noncompliant: "Lux Insuficiente"
            },
            en: {
                nav_home: "HOME", nav_about: "ABOUT", tab_query: "QUERY<br>(STD/LEED)", tab_horiz: "HORIZONTAL<br>SURFACE", tab_vert: "VERTICAL<br>SURFACE", tab_dist: "BEAM<br>STUDY", tab_grid: "FLOOR PLAN<br>GRID",
                calc_params: "Source Parameters", lbl_intensity: "INTENSITY (CD)", lbl_photometry: "PHOTOMETRY", lbl_ies: "IES", lbl_ies_upload: "UPLOAD .IES FILE", lbl_height: "SOURCE HEIGHT (H)", lbl_plane: "WORK PLANE (HP)", lbl_beam: "BEAM ANGLE", lbl_tilt: "TILT ANGLE",
                lbl_intensity_i: "INTENSITY (I)", lbl_flux: "LUMINOUS FLUX", lbl_photo_val: "PHOTOMETRIC VALUE", lbl_hq: "PICTURE AXIS (hq)", lbl_wall_dist: "WALL DISTANCE (D)", lbl_spacing: "FIXTURE SPACING (D)",
                lbl_room_w: "ROOM WIDTH (X)", lbl_room_l: "ROOM LENGTH (Y)", lbl_grid_sug: "SUGGESTED GRID", lbl_grid_unit: "FIXTURES", lbl_grid_desc: "Autonomous distribution aiming for 25% beam overlap on the projected light spot.",
                hdr_results: "Real-Time Results", hdr_query: "Query Center", query_subtitle: "Quick access to standards and technical references.",
                tab_interiors: "Interiors (ISO/IES)", tab_roadway: "Roadway (IES/NBR)", filter_all: "All Categories", col_cat: "Category", col_room: "Room / Task",
                road_params: "Roadway Parameters (M Class)", lbl_speed: "Speed (km/h)", lbl_volume: "Traffic Volume", lbl_separation: "Traffic Separation", lbl_density: "Intersection Density", lbl_complexity: "Complexity / Guidance", lbl_ambient: "Ambient Luminance",
                road_rec_class: "Recommended Class", road_lmed: "Avg Luminance (Lmed)", road_ref_m1: "Reference: M1 (2.0)", road_emed: "Avg Illuminance (Emed)", road_approx: "Approx. for Standard Asphalt", road_u0: "Overall Uniformity (U0)", road_ti: "Max Glare (TI)",
                leed_calc_title: "Budget Calculator (LPD)", leed_select_target: "Select Certification Target", leed_reduction: "Applied Reduction", leed_area: "Project Area (m²)", leed_type: "Typology", leed_allowance: "ALLOWED LOAD",
                leed_eq_1: "<strong class=\"text-starlight font-black\">Control:</strong> Individual for 90% of occupants.", leed_eq_2: "<strong class=\"text-starlight font-black\">Quality:</strong> CRI > 80, Life > 24kh, High reflectance.", leed_ss_1: "Mandatory <strong class=\"text-starlight font-black\">BUG Rating</strong> (Backlight-Uplight-Glare) requirement according to Zone (LZ0 to LZ4).",
                well_sim_title: "Lighting Credits Simulator", well_concept: "Concept: LIGHT (WELL v2)", well_est_pts: "Estimated Points", well_contrib: "Certification Contribution",
                well_l01: "Access to daylight and views.", well_req: "Mandatory", well_l02: "Adequate illuminance levels.", well_l03: "Melanopic Lux > 240 (Workstations).", well_l04: "UGR < 16 / Solar glare management.", well_l07: "CRI > 90, R9 > 50, Flicker < 90Hz.", well_l08: "Zoning and intensity control.",
                about_title: "ABOUT", 
                about_text: "LuxSintax was born with a clear commitment: to transform agility into the Lighting Designer's greatest ally. In a market where time is scarce, we designed an ecosystem that eliminates friction between creative conception and technical validation.<br><br>More than a point-by-point calculator, we are a productivity hub. We integrate agile calculation tools with an intelligent standards search engine (NBR ISO/CIE 8995-1 / IESNA / NBR 5101), allowing you to validate illuminance levels and normative compliance in seconds.<br><br><strong>Technical Note:</strong> Based on the principles of trigonometry and classical photometry (Cosine Cubed Law), this tool offers mathematical precision for preliminary studies. We emphasize that the results are theoretical decision-support simulations and do not replace the complex global calculation (radiosity) of a final executive project signed by a qualified professional.",
                card_1_title: "ABSOLUTE INTENSITY", card_1_desc: "Converts relative photometric data to absolute intensity (Candelas).", 
                card_2_title: "COSINE CUBED LAW", card_2_desc: "Variation of the Inverse Square Law for horizontal surfaces.", 
                card_3_title: "BEAM GEOMETRY", card_3_desc: "Trigonometric calculation of the projected light spot diameter.", 
                card_4_title: "NORMATIVE QUERY", card_4_desc: "Intelligence hub integrating NBR 8995-1, NBR 5101, and LEED/WELL requirements.",
                footer_terms: "Terms of Responsibility", terms_title: "Terms of Responsibility and Use", terms_accept: "I Read, Understood and Accept the Risks",
                nav_profile: "PROFILE", nav_logout: "LOGOUT", profile_title: "Account Settings", profile_email: "Registered E-mail", profile_new_pass: "New Password", profile_confirm_pass: "Confirm New Password", profile_save: "Update Password", msg_pass_success: "Password updated successfully!", msg_pass_mismatch: "Passwords do not match.", profile_help: "<i class=\"fas fa-envelope\"></i> Help and Support",
                auth_forgot: "Forgot password?", auth_forgot_desc: "Enter your email to receive a recovery link.", auth_send_link: "Send Link", auth_back_login: "Back to Login", msg_reset_sent: "Recovery link sent to your email!", msg_recovery_prompt: "Recovery session active. Please set your new password now.",
                search_placeholder: "Search room or task...",
                lbl_lumen_mode: "LUMEN METHOD (SMART)", lbl_target_lux: "TARGET ILLUMINANCE (EM)", lbl_fixture_flux: "FIXTURE FLUX (LM)", lbl_util_factor: "UTILIZATION FACTOR (U)", lbl_maint_factor: "MAINTENANCE FACTOR (FM)",
                lbl_env_context: "Project Context (Usage)", opt_custom: "Custom / Generic", tag_compliant: "NBR Compliant", tag_noncompliant: "Low Illuminance"
            }
        };

        // 2. GLOBAL STATE
        window.state = {
            ponto: { intensity: 3000, height: 3.0, beam: 30, tilt: 0, plane: 0.75, flux: 1500, cdklm: 2000, iesData: null, iesFileName: null },
            vertical: { intensity: 3000, height: 3.0, dist: 1.0, tilt: 30, beam: 30, flux: 1500, cdklm: 2000, hq: 1.6, iesData: null, iesFileName: null }, 
            homog: { intensity: 3000, height: 3.0, spacing: 2.0, plane: 0.75, beam: 30, flux: 1500, cdklm: 2000, tilt: 0 },
            grid: { height: 3.0, beam: 60, roomW: 6.0, roomL: 4.0, cols: 2, rows: 2, lumenMode: false, targetLux: 500, flux: 3000, utilFactor: 0.60, maintFactor: 0.80 },
            currentNormTarget: 0 
        };
        window.currentTool = 'ponto'; window.calcMode = 'direct'; window.currentLang = 'pt';
        window.currentLeedTarget = 'gold';

        // 3. DATABASES (FULL RESTORATION)
        window.normsDatabase = [
            { cat: "Áreas de Tráfego", room: "Áreas de circulação e corredores", lux: 100, ugr: 28, ra: 40 },
            { cat: "Áreas de Tráfego", room: "Escadas, escadas rolantes, esteiras", lux: 150, ugr: 25, ra: 40 },
            { cat: "Áreas de Tráfego", room: "Rampas de carregamento", lux: 150, ugr: 25, ra: 40 },
            { cat: "Edifícios (Geral)", room: "Cantinas", lux: 200, ugr: 22, ra: 80 },
            { cat: "Edifícios (Geral)", room: "Salas de descanso", lux: 100, ugr: 22, ra: 80 },
            { cat: "Edifícios (Geral)", room: "Salas de exercícios físicos", lux: 300, ugr: 22, ra: 80 },
            { cat: "Edifícios (Geral)", room: "Vestiários, banheiros, toaletes", lux: 200, ugr: 25, ra: 80 },
            { cat: "Edifícios (Geral)", room: "Sala de primeiros socorros", lux: 500, ugr: 19, ra: 80 },
            { cat: "Edifícios (Geral)", room: "Salas para atendimento médico", lux: 500, ugr: 16, ra: 90 },
            { cat: "Edifícios (Geral)", room: "Salas de controle de instalações", lux: 150, ugr: 25, ra: 60 },
            { cat: "Indústria", room: "Armazenamento (Depósitos)", lux: 100, ugr: 25, ra: 60 },
            { cat: "Indústria", room: "Expedição e embalagem", lux: 300, ugr: 25, ra: 60 },
            { cat: "Indústria (Alim.)", room: "Preparação de alimentos", lux: 500, ugr: 22, ra: 80 },
            { cat: "Indústria (Alim.)", room: "Inspeção de cor", lux: 1000, ugr: 19, ra: 90 },
            { cat: "Indústria (Metal)", room: "Forjamento (livre)", lux: 200, ugr: 25, ra: 60 },
            { cat: "Indústria (Metal)", room: "Soldagem", lux: 300, ugr: 22, ra: 60 },
            { cat: "Indústria (Metal)", room: "Usinagem grosseira", lux: 300, ugr: 22, ra: 60 },
            { cat: "Indústria (Metal)", room: "Usinagem média", lux: 500, ugr: 22, ra: 60 },
            { cat: "Indústria (Metal)", room: "Usinagem fina", lux: 750, ugr: 19, ra: 60 },
            { cat: "Indústria (Eletr.)", room: "Montagem de componentes (Geral)", lux: 500, ugr: 19, ra: 80 },
            { cat: "Indústria (Eletr.)", room: "Montagem fina / Inspeção", lux: 1000, ugr: 16, ra: 80 },
            { cat: "Indústria (Textil)", room: "Costura fina", lux: 750, ugr: 19, ra: 80 },
            { cat: "Indústria (Gráfica)", room: "Impressão à máquina", lux: 500, ugr: 19, ra: 80 },
            { cat: "Indústria (Gráfica)", room: "Inspeção de cores (Controle)", lux: 1500, ugr: 16, ra: 90 },
            { cat: "Indústria (Madeira)", room: "Marcenaria (bancada)", lux: 300, ugr: 22, ra: 60 },
            { cat: "Indústria (Madeira)", room: "Acabamento / Pintura", lux: 750, ugr: 22, ra: 80 },
            { cat: "Escritório", room: "Arquivamento, cópia, circulação", lux: 300, ugr: 25, ra: 80 },
            { cat: "Escritório", room: "Escrita, digitação, leitura", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Desenho técnico", lux: 750, ugr: 16, ra: 80 },
            { cat: "Escritório", room: "Estações de trabalho CAD", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Salas de conferência / reunião", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Recepção / Balcão", lux: 300, ugr: 22, ra: 80 },
            { cat: "Varejo", room: "Área de vendas (pequenas lojas)", lux: 300, ugr: 22, ra: 80 },
            { cat: "Varejo", room: "Área de vendas (grandes lojas)", lux: 500, ugr: 22, ra: 80 },
            { cat: "Varejo", room: "Caixa / Empacotamento", lux: 500, ugr: 19, ra: 80 },
            { cat: "Varejo", room: "Vitrine (Destaque)", lux: 1000, ugr: "-", ra: 80 },
            { cat: "Locais Públicos", room: "Saguões de entrada", lux: 100, ugr: 22, ra: 60 },
            { cat: "Locais Públicos", room: "Bilheterias", lux: 300, ugr: 22, ra: 80 },
            { cat: "Locais Públicos", room: "Restaurantes (Salão)", lux: 200, ugr: 22, ra: 80 },
            { cat: "Locais Públicos", room: "Restaurantes (Cozinha)", lux: 500, ugr: 22, ra: 80 },
            { cat: "Locais Públicos", room: "Teatros / Cinemas (Foyer)", lux: 200, ugr: 22, ra: 80 },
            { cat: "Locais Públicos", room: "Museus (Exposição geral)", lux: 300, ugr: 19, ra: 80 },
            { cat: "Locais Públicos", room: "Bibliotecas (Estantes)", lux: 200, ugr: 19, ra: 80 },
            { cat: "Locais Públicos", room: "Bibliotecas (Leitura)", lux: 500, ugr: 19, ra: 80 },
            { cat: "Locais Públicos", room: "Estacionamento Coberto", lux: 75, ugr: 25, ra: 40 },
            { cat: "Educação", room: "Sala de aula", lux: 300, ugr: 19, ra: 80 },
            { cat: "Educação", room: "Sala de aula (Noturno/Adultos)", lux: 500, ugr: 19, ra: 80 },
            { cat: "Educação", room: "Quadro negro (Vertical)", lux: 500, ugr: 19, ra: 80 },
            { cat: "Educação", room: "Auditório / Anfiteatro", lux: 500, ugr: 19, ra: 80 },
            { cat: "Educação", room: "Laboratórios", lux: 500, ugr: 19, ra: 80 },
            { cat: "Educação", room: "Salas de arte / desenho", lux: 500, ugr: 19, ra: 80 },
            { cat: "Educação", room: "Ginásios esportivos", lux: 300, ugr: 22, ra: 80 },
            { cat: "Saúde", room: "Salas de espera", lux: 200, ugr: 22, ra: 80 },
            { cat: "Saúde", room: "Corredores (dia)", lux: 200, ugr: 22, ra: 80 },
            { cat: "Saúde", room: "Enfermaria (Geral)", lux: 100, ugr: 19, ra: 80 },
            { cat: "Saúde", room: "Enfermaria (Exame simples)", lux: 300, ugr: 19, ra: 80 },
            { cat: "Saúde", room: "Exame e tratamento (Geral)", lux: 1000, ugr: 19, ra: 90 },
            { cat: "Saúde", room: "Salas de cirurgia (Geral)", lux: 1000, ugr: 19, ra: 90 },
            { cat: "Saúde", room: "Salas de cirurgia (Cavidade)", lux: 10000, ugr: "-", ra: 90 },
            { cat: "Saúde", room: "Dentista (Iluminação geral)", lux: 500, ugr: 19, ra: 90 },
            { cat: "Saúde", room: "Dentista (No paciente)", lux: 1000, ugr: "-", ra: 90 },
            { cat: "Transporte", room: "Aeroportos (Embarque/Check-in)", lux: 500, ugr: 19, ra: 80 },
            { cat: "Transporte", room: "Aeroportos (Saguões)", lux: 200, ugr: 22, ra: 80 },
            { cat: "Transporte", room: "Estações ferroviárias (Plataforma)", lux: 50, ugr: 28, ra: 40 }
        ];

        window.lpdBaselines = [
            { type: "Escritório (Office)", base: 6.9 }, { type: "Varejo (Retail)", base: 9.0 },
            { type: "Escola / Educacional", base: 7.5 }, { type: "Hospital / Saúde", base: 9.0 },
            { type: "Indústria / Galpão", base: 6.0 }, { type: "Estacionamento (Garagem)", base: 1.6 }
        ];

        window.mClassTable = {
            M1: { desc: "Vias Expressas / Alta Vel.", lmed: 2.0, emed: 30, u0: 0.40, ul: 0.70, ti: 10, eir: 0.35 },
            M2: { desc: "Avenidas Principais", lmed: 1.5, emed: 20, u0: 0.40, ul: 0.60, ti: 10, eir: 0.35 },
            M3: { desc: "Vias Arteriais", lmed: 1.0, emed: 15, u0: 0.40, ul: 0.60, ti: 15, eir: 0.30 },
            M4: { desc: "Vias Coletoras", lmed: 0.75, emed: 10, u0: 0.40, ul: 0.50, ti: 15, eir: 0.30 },
            M5: { desc: "Vias Locais", lmed: 0.50, emed: 7.5, u0: 0.35, ul: 0.40, ti: 15, eir: 0.30 },
            M6: { desc: "Vias Residenciais Leves", lmed: 0.30, emed: 5, u0: 0.35, ul: 0.40, ti: 20, eir: 0.30 }
        };

        // --- SAAS FORMATTERS & UNIT CONVERTERS ---
        window.formatDist = function(m) {
            if (window.currentLang === 'en') {
                const totalInches = m * 39.3701;
                const feet = Math.floor(totalInches / 12);
                const inches = Math.round(totalInches % 12);
                if (feet === 0) return `${inches}"`;
                return `${feet}' ${inches}"`;
            }
            return m.toFixed(2) + 'm';
        };

        window.formatIllum = function(lux) {
            if (window.currentLang === 'en') {
                return Math.round(lux * 0.092903) + ' fc';
            }
            return Math.round(lux) + ' Lux';
        };

        // --- AUTH MANAGER (LUXSINTAX V2 - RECOVERY ENABLED) ---
        window.AuthManager = {
            init: async function() {
                const { data: { session } } = await supabase.auth.getSession();
                this.handleSessionUpdate(session);
                
                supabase.auth.onAuthStateChange((event, session) => {
                    this.handleSessionUpdate(session);
                    if (event === 'PASSWORD_RECOVERY') {
                        setTimeout(() => {
                            alert(window.currentLang === 'en' ? window.i18n.en.msg_recovery_prompt : window.i18n.pt.msg_recovery_prompt);
                            this.openProfile();
                        }, 500);
                    }
                });
            },
            handleSessionUpdate: function(session) {
                if (session) {
                    const name = session.user.user_metadata.first_name || (session.user.email ? session.user.email.split('@')[0] : 'Usuário');
                    document.getElementById('user-name-display').innerText = name.toUpperCase();
                    
                    const emailDisplay = document.getElementById('profile-email-display');
                    if (emailDisplay) emailDisplay.value = session.user.email;

                    this.unlockApp();
                } else { this.lockApp(); }
            },
            lockApp: function() { document.getElementById('auth-modal').classList.remove('hidden'); document.getElementById('app-content').classList.add('app-locked'); },
            unlockApp: function() { 
                document.getElementById('auth-modal').classList.add('hidden'); 
                document.getElementById('app-content').classList.remove('app-locked'); 
                window.populateCategoryFilter();
                window.populateGlobalEnvSelector(); 
                window.filterNorms();
                setTimeout(() => window.updateCalculations(), 100); 
            },
            switchTab: function(tab) {
                const loginForm = document.getElementById('form-login'); 
                const regForm = document.getElementById('form-register');
                const forgotForm = document.getElementById('form-forgot-password');
                const authTabs = document.getElementById('auth-tabs');
                
                const btnLogin = document.getElementById('tab-auth-login'); 
                const btnReg = document.getElementById('tab-auth-register');
                
                authTabs.classList.remove('hidden');
                forgotForm.classList.add('hidden');

                if (tab === 'login') {
                    loginForm.classList.remove('hidden'); regForm.classList.add('hidden');
                    btnLogin.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-luminous-gold border-b-2 border-luminous-gold transition-all";
                    btnReg.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-dim-gray hover:text-starlight transition-all";
                } else {
                    loginForm.classList.add('hidden'); regForm.classList.remove('hidden');
                    btnReg.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-luminous-gold border-b-2 border-luminous-gold transition-all";
                    btnLogin.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-dim-gray hover:text-starlight transition-all";
                }
            },
            
            showForgotPassword: function() {
                document.getElementById('form-login').classList.add('hidden');
                document.getElementById('form-register').classList.add('hidden');
                document.getElementById('auth-tabs').classList.add('hidden');
                document.getElementById('form-forgot-password').classList.remove('hidden');
            },
            backToLogin: function() {
                this.switchTab('login');
            },
            handlePasswordResetRequest: async function() {
                const email = document.getElementById('forgot-email').value;
                if (!email) {
                    alert("Por favor, insira um e-mail.");
                    return;
                }
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.origin + window.location.pathname,
                });
                
                if (error) {
                    alert(error.message);
                } else {
                    alert(window.currentLang === 'en' ? window.i18n.en.msg_reset_sent : window.i18n.pt.msg_reset_sent);
                    this.backToLogin();
                }
            },

            handleLogin: async function() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) alert(error.message);
            },
            handleRegister: async function() {
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                const firstName = document.getElementById('reg-name').value;
                const lastName = document.getElementById('reg-surname').value;
                if (!document.getElementById('reg-terms').checked) return alert("Aceite os termos.");
                const { data, error } = await supabase.auth.signUp({ email, password, options: { data: { first_name: firstName, last_name: lastName } } });
                if (error) alert(error.message); 
                else if (data.session) this.unlockApp();
                else alert("Cadastro feito. Verifique e-mail.");
            },
            logout: async function() { await supabase.auth.signOut(); location.reload(); },
            openProfile: function() {
                document.getElementById('profile-modal').classList.remove('hidden');
            },
            closeProfile: function() {
                document.getElementById('profile-modal').classList.add('hidden');
                document.getElementById('profile-new-pass').value = '';
                document.getElementById('profile-confirm-pass').value = '';
            },
            updatePassword: async function() {
                const pass1 = document.getElementById('profile-new-pass').value;
                const pass2 = document.getElementById('profile-confirm-pass').value;
                
                if (!pass1 || pass1 !== pass2) {
                    alert(window.currentLang === 'en' ? window.i18n.en.msg_pass_mismatch : window.i18n.pt.msg_pass_mismatch);
                    return;
                }
                
                const { error } = await supabase.auth.updateUser({ password: pass1 });
                
                if (error) {
                    alert(error.message);
                } else {
                    alert(window.currentLang === 'en' ? window.i18n.en.msg_pass_success : window.i18n.pt.msg_pass_success);
                    this.closeProfile();
                }
            }
        };

        // --- CORE FUNCTIONS ---
        window.switchTool = function(toolId) {
            window.currentTool = toolId;
            ['ponto', 'vertical', 'homog', 'grid', 'query'].forEach(id => {
                const btn = document.getElementById('tab-' + id);
                if(btn) {
                    let cls = "mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all whitespace-nowrap ";
                    if (id === 'query') cls += "text-luminous-gold ml-auto "; 
                    
                    btn.className = cls + (id === toolId ? "tab-active" : "tab-inactive");
                }
            });
            document.getElementById('visual-tools').classList.toggle('hidden', toolId === 'query');
            document.getElementById('query-tool').classList.toggle('hidden', toolId !== 'query');
            
            const modeSelector = document.getElementById('calc-mode-selector');
            if(modeSelector) modeSelector.classList.toggle('hidden', toolId === 'grid');

            if (toolId !== 'query') {
                ['inputs-ponto', 'inputs-vertical', 'inputs-homog', 'inputs-grid'].forEach(id => { const el = document.getElementById(id); if(el) el.classList.add('hidden'); });
                const selectedInput = document.getElementById('inputs-' + toolId);
                if (selectedInput) selectedInput.classList.remove('hidden');
                window.updateCalcMode(window.calcMode);
                window.updateCalculations();
            } else {
                 window.switchQueryTab('nbr8995');
            }
        }

        window.updateCalcMode = function(mode) {
            window.calcMode = mode;
            document.querySelectorAll('.mode-direct-group').forEach(el => el.classList.toggle('hidden', mode !== 'direct'));
            document.querySelectorAll('.mode-photo-group').forEach(el => el.classList.toggle('hidden', mode !== 'photometric'));
            document.querySelectorAll('.mode-ies-group').forEach(el => el.classList.toggle('hidden', mode !== 'ies'));
            document.querySelectorAll('.mode-standard-only').forEach(el => el.classList.toggle('hidden', mode === 'ies'));
            window.updateCalculations();
        }
        
        window.toggleLumenMode = function(checked) {
            window.state.grid.lumenMode = checked;
            document.getElementById('lumen-inputs').classList.toggle('hidden', !checked);
            const bg = document.getElementById('lumen-toggle-bg');
            const dot = document.getElementById('lumen-toggle-dot');
            if(checked) {
                bg.classList.add('bg-luminous-gold');
                bg.classList.remove('bg-slate-200', 'dark:bg-slate-600');
                dot.classList.add('translate-x-3');
            } else {
                bg.classList.remove('bg-luminous-gold');
                bg.classList.add('bg-slate-200', 'dark:bg-slate-600');
                dot.classList.remove('translate-x-3');
            }
            window.updateCalculations();
        }

        // LUXSINTAX - Lógica de Integração de Contexto (NBR 8995)
        window.populateGlobalEnvSelector = function() {
            const sel = document.getElementById('global-env-selector');
            if(!sel || sel.options.length > 1) return;
            window.normsDatabase.forEach((n, index) => {
                const o = document.createElement('option');
                o.value = index;
                o.innerText = `${n.room} (${n.lux}lx)`;
                sel.appendChild(o);
            });
        }

        window.updateProjectContext = function(index) {
            const displayBox = document.getElementById('target-display-box');
            if (index === 'none') {
                window.state.currentNormTarget = 0;
                displayBox.classList.add('hidden');
            } else {
                const norm = window.normsDatabase[index];
                window.state.currentNormTarget = norm.lux;
                document.getElementById('target-lux-val').innerText = norm.lux;
                document.getElementById('target-ra-val').innerText = norm.ra;
                displayBox.classList.remove('hidden');
                
                // Se estiver no modo Grid/Lúmens, sincroniza o input de lux
                if (window.currentTool === 'grid') {
                    document.getElementById('g-targetLux').value = norm.lux;
                    window.state.grid.targetLux = norm.lux;
                }
            }
            window.updateCalculations();
        }

        // --- IES PARSER & LOGIC ---
        window.handleIESUpload = function(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    const parsed = window.parseIES(content);
                    
                    if (parsed) {
                        const targetKey = window.currentTool === 'homog' ? 'homog' : (window.currentTool === 'ponto' ? 'ponto' : 'vertical');
                        window.state[targetKey].iesData = parsed;
                        window.state[targetKey].iesFileName = file.name;
                        
                        let statusId = 'p-ies-status';
                        if(window.currentTool === 'vertical') statusId = 'v-ies-status';
                        if(window.currentTool === 'homog') statusId = 'h-ies-status';

                        const statusEl = document.getElementById(statusId);
                        if(statusEl) {
                            statusEl.innerText = `Carregado: ${file.name}`;
                            statusEl.classList.add('text-luminous-gold');
                        }
                        window.updateCalculations();
                    } else {
                        alert("Erro ao ler arquivo " + file.name + ". Verifique se é um arquivo IES válido.");
                    }
                };
                reader.readAsText(file);
            }
        }

        window.parseIES = function(content) {
            try {
                const tokens = content.replace(/\s+/g, " ").trim().split(" ");
                let cursor = 0;
                let tiltFound = false;
                for(let i=0; i < tokens.length; i++) {
                    if (tokens[i].startsWith("TILT=")) {
                        cursor = i + 1; 
                        tiltFound = true;
                        break;
                    }
                }
                
                if (!tiltFound) return null;

                function nextNum() {
                    while(cursor < tokens.length) {
                        const val = parseFloat(tokens[cursor]);
                        cursor++;
                        if (!isNaN(val)) return val;
                    }
                    return null;
                }

                nextNum(); nextNum(); 
                const multiplier = nextNum();
                const vCount = nextNum();
                const hCount = nextNum();
                nextNum(); nextNum(); nextNum(); nextNum(); nextNum();
                nextNum(); nextNum(); nextNum();

                const vAngles = [];
                for(let i=0; i<vCount; i++) vAngles.push(nextNum());

                const hAngles = [];
                for(let i=0; i<hCount; i++) hAngles.push(nextNum());

                const candelas = [];
                for(let h=0; h<hCount; h++) {
                    const row = [];
                    for(let v=0; v<vCount; v++) {
                        row.push(nextNum());
                    }
                    candelas.push(row);
                }

                return { vAngles, hAngles, candelas, multiplier };

            } catch (e) {
                console.error("IES Parse Error", e);
                return null;
            }
        }

        window.getIESIntensity = function(state, angleDeg) {
            if (!state.iesData) return 0;
            const data = state.iesData;
            const vAngles = data.vAngles;
            const candelaRow = data.candelas[0]; 
            const mult = data.multiplier;

            let idx = 0;
            if (angleDeg <= vAngles[0]) return candelaRow[0] * mult;
            if (angleDeg >= vAngles[vAngles.length-1]) return candelaRow[vAngles.length-1] * mult;

            while(idx < vAngles.length - 1 && angleDeg > vAngles[idx+1]) { idx++; }
            const a1 = vAngles[idx], a2 = vAngles[idx+1];
            const c1 = candelaRow[idx], c2 = candelaRow[idx+1];
            if (a2 === a1) return c1 * mult;
            const t = (angleDeg - a1) / (a2 - a1);
            return (c1 + t * (c2 - c1)) * mult;
        }

        function getIntensity(s) {
            if (window.calcMode === 'direct') return s.intensity;
            if (window.calcMode === 'ies') {
                const tiltVal = (window.currentTool === 'homog') ? 0 : Math.abs(s.tilt);
                return window.getIESIntensity(s, tiltVal); 
            }
            return (s.cdklm * s.flux) / 1000;
        }

        window.getEffectiveBeam = function(s) {
            if (window.calcMode === 'ies' && s.iesData) {
                const data = s.iesData;
                const vAngles = data.vAngles;
                const row = data.candelas[0];
                const maxI = Math.max(...row);
                if (maxI <= 0) return s.beam; 
                const targetI = maxI / 2;
                let halfAngle = 0;
                for (let i = 0; i < vAngles.length - 1; i++) {
                    if ((row[i] >= targetI && row[i+1] <= targetI) || (row[i] <= targetI && row[i+1] >= targetI)) {
                        const t = (targetI - row[i]) / (row[i+1] - row[i]);
                        halfAngle = vAngles[i] + t * (vAngles[i+1] - vAngles[i]);
                        break;
                    }
                }
                return halfAngle * 2 || s.beam; 
            }
            return s.beam;
        }

        // --- CANVAS ENGINE ---
        const drawDimLine = (ctx, x1, y1, x2, y2, text) => { 
            const isDark = document.documentElement.classList.contains('dark');
            ctx.beginPath(); ctx.strokeStyle = isDark ? "#475569" : "#94a3b8"; ctx.lineWidth = 1; 
            ctx.moveTo(x1, y1 - 3); ctx.lineTo(x1, y1 + 3); ctx.moveTo(x1, y1); ctx.lineTo(x2, y1); ctx.moveTo(x2, y1 - 3); ctx.lineTo(x2, y1 + 3); ctx.stroke(); 
            ctx.font = "bold 11px Manrope"; const mx = (x1 + x2) / 2; const my = (y1 + y2) / 2; const tw = ctx.measureText(text).width; 
            ctx.fillStyle = isDark ? "rgba(15, 23, 42, 0.95)" : "rgba(255, 255, 255, 0.95)"; ctx.fillRect(mx - tw / 2 - 6, my - 10, tw + 12, 20); 
            ctx.fillStyle = isDark ? "#94a3b8" : "#475569"; ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.fillText(text, mx, my); 
            ctx.textAlign = "start"; ctx.textBaseline = "alphabetic";
        };
        const drawDimLineVertical = (ctx, x, y1, y2, text) => { 
            const isDark = document.documentElement.classList.contains('dark');
            ctx.beginPath(); ctx.strokeStyle = isDark ? "#475569" : "#94a3b8"; ctx.lineWidth = 1; ctx.moveTo(x, y1); ctx.lineTo(x, y2); ctx.stroke(); 
            const cy = (y1 + y2) / 2; ctx.save(); ctx.translate(x, cy); ctx.rotate(-Math.PI/2); 
            ctx.font = "bold 11px Manrope"; const tw = ctx.measureText(text).width; 
            ctx.fillStyle = isDark ? "rgba(15, 23, 42, 0.95)" : "rgba(255, 255, 255, 0.95)"; ctx.fillRect(-tw/2-6, -10, tw+12, 20); 
            ctx.fillStyle = isDark ? "#94a3b8" : "#475569"; ctx.fillText(text, -tw/2, 4); ctx.restore(); 
        };
        const drawAngleDim = (ctx, x, y, angle, tilt, radius, color, isTilt = false) => {
            const tr = tilt * Math.PI / 180;
            let startAngle, endAngle, centerAngle;
            if (isTilt) { centerAngle = (Math.PI / 2) - (tr / 2); startAngle = (Math.PI / 2) - tr; endAngle = (Math.PI / 2); } 
            else { const br = angle * Math.PI / 180; const beamAxis = (Math.PI / 2) - tr; centerAngle = beamAxis; startAngle = beamAxis - (br / 2); endAngle = beamAxis + (br / 2); }
            ctx.beginPath(); ctx.arc(x, y, radius, startAngle, endAngle); ctx.strokeStyle = color; ctx.lineWidth = 1.5; ctx.stroke();
        };

        window.updateCalculations = function() {
            const canvas = document.getElementById('beamCanvas');
            if (!canvas) return;
            const isDark = document.documentElement.classList.contains('dark');
            const cBaseText = isDark ? "#94a3b8" : "#64748b";
            const cFloorLine = isDark ? "#334155" : "#cbd5e1";
            
            const dpr = window.devicePixelRatio || 1;
            const parent = canvas.parentElement;
            const rect = parent.getBoundingClientRect();
            canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
            const ctx = canvas.getContext('2d'); ctx.scale(dpr, dpr);
            const cw = rect.width, ch = rect.height;
            const floorY = ch - 70, centerX = cw / 2;
            let boundsH = 3.0, boundsW = 3.0; 
            const s = window.state[window.currentTool];

            let currentBeam = (window.currentTool !== 'grid') ? window.getEffectiveBeam(s) : 60;

            if (window.currentTool === 'ponto') {
                boundsH = s.height;
                const maxAngleRad = (Math.abs(s.tilt) + currentBeam/2) * Math.PI / 180;
                boundsW = s.height * Math.tan(Math.min(maxAngleRad, 1.48));
            } else if (window.currentTool === 'vertical') {
                boundsH = s.height; boundsW = Math.max(s.dist * 1.6, 3.5); 
            } else if (window.currentTool === 'homog') {
                boundsH = s.height; boundsW = (s.spacing / 2) + (s.height * Math.tan((currentBeam/2) * Math.PI / 180));
            } else if (window.currentTool === 'grid') {
                boundsW = s.roomW; boundsH = s.roomL;
            }

            ctx.clearRect(0, 0, cw, ch);

            // --- LÓGICA DE CONFORMIDADE VISUAL (Traffic Light) ---
            const checkCompliance = (val) => {
                const tag = document.getElementById('compliance-tag');
                if (window.state.currentNormTarget === 0) { tag.classList.add('hidden'); return "#d97706"; }
                tag.classList.remove('hidden');
                if (val >= window.state.currentNormTarget) {
                    tag.innerText = window.i18n[window.currentLang].tag_compliant;
                    tag.className = "px-4 py-1.5 rounded-full text-[10px] font-black tracking-widest uppercase transition-all bg-leed-green text-white";
                    return "#4d7c0f"; // LEED Green
                } else {
                    tag.innerText = window.i18n[window.currentLang].tag_noncompliant;
                    tag.className = "px-4 py-1.5 rounded-full text-[10px] font-black tracking-widest uppercase transition-all bg-red-500 text-white animate-pulse";
                    return "#ef4444"; // Red
                }
            };

            if (window.currentTool === 'grid') {
                if (s.lumenMode) {
                    const N = Math.max(1, Math.ceil((s.targetLux * s.roomW * s.roomL) / (s.flux * s.utilFactor * s.maintFactor)));
                    const ratio = s.roomW / s.roomL;
                    let calcCols = Math.round(Math.sqrt(N * ratio)), calcRows = Math.round(Math.sqrt(N / ratio));
                    while (calcCols * calcRows < N) { if ((calcCols / calcRows) < ratio) calcCols++; else calcRows++; }
                    s.cols = calcCols; s.rows = calcRows;
                    document.getElementById('grid-desc-display').innerText = `${N} luminárias requeridas.`;
                }
                const pad = 80; let scale = Math.min((cw - pad*2) / boundsW, (ch - pad*2) / boundsH);
                const rW = boundsW * scale, rH = boundsH * scale;
                const oX = (cw - rW) / 2, oY = (ch - rH) / 2;
                ctx.fillStyle = isDark ? "#0f172a" : "#f8fafc"; ctx.fillRect(oX, oY, rW, rH);
                ctx.save(); ctx.beginPath(); ctx.rect(oX, oY, rW, rH); ctx.clip();
                const radiusPx = (s.height * Math.tan((s.beam * Math.PI / 180) / 2)) * scale;
                const spX = s.roomW / s.cols, spY = s.roomL / s.rows;
                for (let i = 0; i < s.cols; i++) {
                    for (let j = 0; j < s.rows; j++) {
                        const cx = oX + (i + 0.5) * spX * scale, cy = oY + (j + 0.5) * spY * scale;
                        const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, radiusPx);
                        const c = isDark ? "217, 119, 6" : "251, 191, 36";
                        g.addColorStop(0, `rgba(${c}, 0.4)`); g.addColorStop(0.5, `rgba(${c}, 0.15)`); g.addColorStop(1, `rgba(${c}, 0)`);
                        ctx.fillStyle = g; ctx.beginPath(); ctx.arc(cx, cy, radiusPx, 0, Math.PI * 2); ctx.fill();
                        ctx.beginPath(); ctx.arc(cx, cy, 4, 0, Math.PI * 2); ctx.fillStyle = "#d97706"; ctx.fill();
                    }
                }
                ctx.restore(); ctx.strokeStyle = cFloorLine; ctx.lineWidth = 3; ctx.strokeRect(oX, oY, rW, rH);
                drawDimLine(ctx, oX, oY - 20, oX + rW, oY - 20, window.formatDist(s.roomW));
                drawDimLineVertical(ctx, oX - 20, oY, oY + rH, window.formatDist(s.roomL));
                return; 
            }

            const availH = floorY - 60, availW = (cw / 2) - 50; 
            let scale = Math.min(availH / Math.max(boundsH, 0.5), availW / Math.max(boundsW, 0.5));
            scale = Math.min(Math.max(scale, 12), 160);

            ctx.strokeStyle = cFloorLine; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, floorY); ctx.lineTo(cw, floorY); ctx.stroke(); 

            if (window.currentTool === 'ponto') {
                const tr = s.tilt * Math.PI / 180, br = currentBeam * Math.PI / 180;
                const I = getIntensity(s);
                const sy = floorY - (s.height * scale), py = floorY - (s.plane * scale);
                const luxFloor = (I * Math.pow(Math.cos(tr), 3)) / (s.height ** 2);
                const resColor = checkCompliance(luxFloor);
                
                ctx.fillStyle = '#FBBF24'; ctx.beginPath(); ctx.arc(centerX, sy, 5, 0, Math.PI * 2); ctx.fill();
                ctx.save(); ctx.translate(centerX, sy);
                const g = ctx.createLinearGradient(0, 0, 0, floorY-sy); g.addColorStop(0, `rgba(251, 191, 36, 0.6)`); g.addColorStop(1, `rgba(251, 191, 36, 0)`);
                ctx.fillStyle = g; ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo((floorY-sy) * Math.tan(tr - br / 2), floorY-sy); ctx.lineTo((floorY-sy) * Math.tan(tr + br / 2), floorY-sy); ctx.closePath(); ctx.fill(); ctx.restore();

                const hitX = centerX + (s.height * scale) * Math.tan(tr);
                ctx.beginPath(); ctx.arc(hitX, floorY, 4, 0, Math.PI * 2); ctx.fillStyle = resColor; ctx.fill();
                
                ctx.font = "900 13px Manrope"; ctx.fillStyle = resColor; ctx.textAlign = "center";
                ctx.fillText(window.formatIllum(luxFloor), hitX, floorY - 12);
            }
            // (Outros desenhos de canvas simplificados para brevidade, lógica segue o padrão acima)
        }

        // --- NBR 5101 LOGIC ---
        window.calc5101 = function() {
            const s = parseInt(document.getElementById('m-speed').value), v = parseInt(document.getElementById('m-volume').value), sep = parseInt(document.getElementById('m-separation').value);
            const d = parseInt(document.getElementById('m-density').value), c = parseInt(document.getElementById('m-complexity').value), a = parseInt(document.getElementById('m-ambient').value);
            let score = s + v + sep + d + c + a;
            let m = 6 - score; if(m<1) m=1; if(m>6) m=6;
            const res = window.mClassTable["M"+m];
            document.getElementById('m-result-class').innerText = "M"+m;
            document.getElementById('m-result-desc').innerText = res.desc;
            document.getElementById('res-lmed-val').innerText = res.lmed.toFixed(1); document.getElementById('bar-lmed').style.width = (res.lmed/2.0*100)+'%';
            document.getElementById('res-emed-val').innerText = res.emed; document.getElementById('bar-emed').style.width = (res.emed/30*100)+'%';
            document.getElementById('res-u0-val').innerText = res.u0.toFixed(2); document.getElementById('bar-u0').style.width = (res.u0/0.4*100)+'%';
            document.getElementById('res-ti-val').innerText = res.ti; document.getElementById('bar-ti').style.width = (res.ti/20*100)+'%';
        }

        window.populateCategoryFilter = function() {
            const sel = document.getElementById('category-filter');
            if(!sel || sel.options.length > 1) return;
            const uniqueCats = [...new Set(window.normsDatabase.map(n => n.cat))].sort();
            uniqueCats.forEach(c => { const o = document.createElement('option'); o.value=c; o.innerText=c; sel.appendChild(o); });
        }
        
        window.filterNorms = function() {
            const cat = document.getElementById('category-filter').value;
            const searchInput = document.getElementById('search-filter');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const filtered = window.normsDatabase.filter(n => {
                return (cat === 'all' || n.cat === cat) && (n.room.toLowerCase().includes(searchTerm) || n.cat.toLowerCase().includes(searchTerm));
            });
            document.getElementById('nbr8995-tbody').innerHTML = filtered.map(n => `<tr class="hover:bg-slate-50 transition-colors border-b border-slate-100"><td class="p-4 font-black text-luminous-gold text-xs uppercase">${n.cat}</td><td class="p-4 text-slate-500 font-bold">${n.room}</td><td class="p-4 text-center font-black text-starlight bg-slate-50">${n.lux}</td><td class="p-4 text-center text-slate-400">${n.ugr}</td><td class="p-4 text-center text-slate-400">${n.ra}</td></tr>`).join('');
        }
        
        window.switchQueryTab = function(t) {
            ['nbr8995','nbr5101','leed'].forEach(k => {
                document.getElementById('content-'+k).classList.toggle('hidden', k!==t);
                document.getElementById('btn-q-'+k).className = `query-tab-btn ${k===t ? 'query-tab-active' : ''}`;
            });
            if(t==='nbr8995') window.filterNorms();
            if(t==='nbr5101') window.calc5101();
            if(t==='leed') window.updateLeedTargets();
        }
        
        window.switchCertTab = function(t) { ['leed','well'].forEach(k => { document.getElementById('pane-'+k).classList.toggle('hidden', k!==t); document.getElementById('cert-tab-'+k).className = `cert-tab ${k===t?'active':'inactive'}`; }); }
        window.updateLeedTargets = function() {
            const area = parseFloat(document.getElementById('leed-area-input').value) || 0;
            const red = window.currentLeedTarget === 'gold' ? 0.20 : (window.currentLeedTarget === 'platinum' ? 0.30 : (window.currentLeedTarget === 'silver' ? 0.10 : 0.05));
            document.getElementById('leed-reduction-display').innerText = (red*100).toFixed(0)+'%';
            document.getElementById('leed-lpd-body').innerHTML = window.lpdBaselines.map(b => `<tr class="border-b border-slate-100"><td class="p-3 text-starlight font-bold">${b.type}</td><td class="p-3 text-center text-slate-500 font-mono">${b.base}</td><td class="p-3 text-center text-luminous-gold font-black">${(b.base*(1-red)).toFixed(2)}</td><td class="p-3 text-right text-tech-cyan font-black">${(b.base*(1-red)*area).toFixed(0)} W</td></tr>`).join('');
        }
        window.setLeedTarget = function(t) { window.currentLeedTarget = t; document.querySelectorAll('.leed-level-box').forEach(b => b.classList.remove('active')); document.getElementById('lvl-'+t).classList.add('active'); window.updateLeedTargets(); }
        window.toggleWellFeature = function(el, pts) { el.classList.toggle('active'); let total=0; document.querySelectorAll('.well-toggle-group.active').forEach(i => total += parseInt(i.getAttribute('data-points'))); document.getElementById('well-total-score').innerHTML = `${total} <span class="text-xs text-slate-400 font-normal">/ 8</span>`; document.getElementById('well-progress-bar').style.width = (total/8*100)+'%'; document.getElementById('well-progress-text').innerText = (total/8*100).toFixed(0)+'%'; const icon = el.querySelector('.fa-check'); if(el.classList.contains('active')) icon.classList.remove('opacity-0'); else icon.classList.add('opacity-0'); }

        window.openTerms = function() { document.getElementById('terms-modal').classList.remove('hidden'); }
        window.closeTerms = function() { document.getElementById('terms-modal').classList.add('hidden'); }
        
        window.updateInputsForLanguage = function() {
            const isEn = window.currentLang === 'en';
            document.querySelectorAll('.unit-m-ft').forEach(el => el.innerText = isEn ? 'FT' : 'M');
            const distParams = ['height', 'plane', 'dist', 'spacing', 'hq', 'roomW', 'roomL'];
            ['ponto', 'vertical', 'homog', 'grid'].forEach(key => {
                distParams.forEach(param => {
                    const numInput = document.getElementById(`${key[0]}-${param}`);
                    const rangeInput = document.getElementById(`range-${key[0]}-${param}`);
                    if (numInput && rangeInput) {
                        const valMeters = window.state[key][param];
                        if (isEn) {
                            numInput.value = (valMeters * 3.28084).toFixed(2);
                            rangeInput.value = (valMeters * 3.28084).toFixed(2);
                        } else {
                            numInput.value = valMeters.toFixed(2);
                            rangeInput.value = valMeters.toFixed(2);
                        }
                    }
                });
            });
        };

        window.toggleLanguage = function() { 
            window.currentLang = window.currentLang === 'pt' ? 'en' : 'pt'; 
            document.querySelectorAll('.lang-display').forEach(e => e.innerText = window.currentLang === 'pt' ? 'PT / EN' : 'EN / PT');
            document.querySelectorAll('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); if (window.i18n[window.currentLang] && window.i18n[window.currentLang][key]) { el.innerHTML = window.i18n[window.currentLang][key]; } });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => { const key = el.getAttribute('data-i18n-placeholder'); if (window.i18n[window.currentLang] && window.i18n[window.currentLang][key]) { el.placeholder = window.i18n[window.currentLang][key]; } });
            window.updateInputsForLanguage(); window.updateCalculations(); 
        }
        window.toggleMobileMenu = function() { document.getElementById('mobile-menu').classList.toggle('hidden'); }

        function bind(id, key, param) { 
            const el = document.getElementById(id); if(!el) return;
            el.addEventListener('input', (e) => { 
                let val = parseFloat(e.target.value); 
                const isEn = window.currentLang === 'en';
                const isDist = ['height', 'plane', 'dist', 'spacing', 'hq', 'roomW', 'roomL'].includes(param);
                const valInMeters = (isEn && isDist) ? val / 3.28084 : val;
                const pairId = id.includes('range') ? id.replace('range-', '') : 'range-' + id;
                if(document.getElementById(pairId)) document.getElementById(pairId).value = val;
                window.state[key][param] = valInMeters; window.updateCalculations(); 
            }); 
        }
        ['ponto', 'vertical', 'homog', 'grid'].forEach(key => { ['intensity', 'height', 'beam', 'tilt', 'plane', 'dist', 'spacing', 'flux', 'cdklm', 'hq', 'roomW', 'roomL', 'targetLux', 'utilFactor', 'maintFactor'].forEach(param => { bind(`${key[0]}-${param}`, key, param); bind(`range-${key[0]}-${param}`, key, param); }); });

        window.AuthManager.init();
        window.switchTool('ponto');
    </script>
</body>
</html>