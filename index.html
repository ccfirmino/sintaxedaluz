<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxSintax | Lighting Design SaaS (BETA)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'midnight': '#020617',
                        'twilight': '#0f172a',
                        'glass': 'rgba(15, 23, 42, 0.6)',
                        'luminous-gold': '#FBBF24',
                        'tech-cyan': '#22d3ee',
                        'dim-gray': '#94a3b8',
                        'dim-line': '#cbd5e1',
                        'starlight': '#f8fafc',
                        'leed-green': '#84cc16'
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                    },
                    backgroundImage: {
                        'blue-hour-gradient': 'linear-gradient(to bottom, #020617, #0f172a)',
                        'gold-glow': 'radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, rgba(2, 6, 23, 0) 70%)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Manrope', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            background: linear-gradient(180deg, #020617 0%, #0f172a 100%);
            letter-spacing: 0.5px;
            min-height: 100vh;
        }

        h1, h2, h3, h4, .nav-link, button, input, label, select { text-transform: uppercase !important; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        /* Input Range Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: #FBBF24; cursor: pointer; margin-top: -5px; box-shadow: 0 0 10px rgba(251, 191, 36, 0.8); border: 2px solid #0f172a; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #1e293b; border-radius: 2px; }

        input[type=number], select, input[type=text], input[type=date], input[type=email], input[type=password] { background-color: transparent; color: #f8fafc; border: none; border-bottom: 1px solid #334155; text-align: left; width: 100%; font-family: 'Manrope', sans-serif; font-weight: 300; -moz-appearance: textfield; padding: 8px 0; }
        input[type=number]:focus, select:focus, input[type=text]:focus, input[type=email]:focus, input[type=password]:focus { outline: none; border-bottom: 1px solid #FBBF24; color: #FBBF24; }
        
        .calc-input { text-align: right !important; width: 65px !important; }

        select.custom-select option { background-color: #0f172a; color: #f8fafc; }

        .nav-link { position: relative; font-size: 0.85rem; letter-spacing: 2px; color: #94a3b8; transition: color 0.3s; }
        .nav-link:hover { color: #FBBF24; text-shadow: 0 0 8px rgba(251, 191, 36, 0.4); }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 1px; bottom: -4px; left: 0; background-color: #FBBF24; transition: width 0.3s; }
        .nav-link:hover::after { width: 100%; }

        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        .canvas-container { background: linear-gradient(135deg, #0B1221 0%, #1e293b 100%); box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        
        .tab-active { border-bottom: 2px solid #FBBF24 !important; color: #FBBF24 !important; opacity: 1 !important; }
        .tab-inactive { border-bottom: 2px solid transparent !important; color: #94a3b8 !important; opacity: 0.6; }
        .tab-inactive:hover { opacity: 1; color: #f8fafc !important; }
        
        input[type="radio"] { appearance: none; background-color: transparent; margin: 0; font: inherit; color: #FBBF24; width: 1.15em; height: 1.15em; border: 1px solid #FBBF24; border-radius: 50%; display: grid; place-content: center; }
        input[type="radio"]::before { content: ""; width: 0.65em; height: 0.65em; background-color: #FBBF24; border-radius: 50%; transform: scale(0); transition: 120ms transform ease-in-out; }
        input[type="radio"]:checked::before { transform: scale(1); }

        .mode-tab-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
            padding: 16px 20px; min-width: 130px; height: 90px; border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05); background: rgba(255, 255, 255, 0.02);
            transition: all 0.3s ease; backdrop-filter: blur(5px); position: relative;
        }
        .mode-tab-btn:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); border-color: rgba(255, 255, 255, 0.2); }
        .mode-tab-btn i.fa-lock { font-size: 0.75rem; }
        .mode-tab-btn i:not(.fa-lock) { font-size: 1.5rem; margin-bottom: 4px; }
        .mode-tab-btn span { font-size: 0.65rem; font-weight: 800; letter-spacing: 0.1em; line-height: 1.2; text-align: center; }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(251, 191, 36, 0.3); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(251, 191, 36, 0.6); }

        .query-tab-btn { padding: 8px 16px; font-size: 10px; font-weight: bold; text-transform: uppercase; border-radius: 9999px; border: 1px solid transparent; transition: all 0.3s; color: #94a3b8; }
        .query-tab-active { background-color: rgba(251, 191, 36, 0.1); color: #FBBF24; border-color: #FBBF24; }

        .cert-tab { cursor: pointer; padding: 8px 16px; border-radius: 6px; transition: all 0.3s; font-size: 11px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; }
        .cert-tab.active { background: rgba(132, 204, 22, 0.15); color: #84cc16; border: 1px solid rgba(132, 204, 22, 0.3); }
        .cert-tab.inactive { color: #94a3b8; opacity: 0.6; }
        .cert-tab.inactive:hover { opacity: 1; color: white; }

        label { color: #94a3b8 !important; }
        
        .leed-level-box { transition: all 0.3s; border: 1px solid transparent; opacity: 0.5; cursor: pointer; }
        .leed-level-box:hover { opacity: 0.8; background: rgba(255,255,255,0.05); }
        .leed-level-box.active { opacity: 1; border-color: #FBBF24; background: rgba(251, 191, 36, 0.1); transform: scale(1.05); box-shadow: 0 0 15px rgba(251,191,36,0.1); }
        
        .well-toggle-group { cursor: pointer; border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s; }
        .well-toggle-group:hover { border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.02); }
        .well-toggle-group.active { border-color: #22d3ee; background: rgba(34, 211, 238, 0.05); }
        .well-check { width: 16px; height: 16px; border-radius: 4px; border: 1px solid #94a3b8; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .well-toggle-group.active .well-check { background: #22d3ee; border-color: #22d3ee; color: #020617; }

        .bar-container { width: 100%; background: rgba(255,255,255,0.1); height: 6px; border-radius: 99px; overflow: hidden; margin-top: 4px; }
        .bar-fill { height: 100%; border-radius: 99px; transition: width 1s ease-out; }

        .app-locked {
            filter: blur(8px) grayscale(0.5);
            pointer-events: none;
            user-select: none;
            overflow: hidden;
            height: 100vh;
        }

        .auth-input-group label {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #FBBF24 !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-luminous-gold selection:text-midnight">

    <div id="auth-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 transition-all duration-500">
        <div class="absolute inset-0 bg-midnight/80 backdrop-blur-sm"></div>
        
        <div class="glass-panel w-full max-w-md p-8 rounded-2xl relative z-10 animate-fade-in-up border border-luminous-gold/20 shadow-[0_0_50px_rgba(251,191,36,0.1)]">
            <div class="text-center mb-8">
                <div class="text-2xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)] mb-2">
                    LUX<span class="text-white font-light opacity-60">SINTAX</span>
                </div>
                <p class="text-[10px] text-dim-gray uppercase tracking-widest">SaaS de Inteligência em Iluminação</p>
            </div>

            <div class="flex border-b border-white/10 mb-6">
                <button onclick="AuthManager.switchTab('login')" id="tab-auth-login" class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-luminous-gold border-b-2 border-luminous-gold transition-all">Login</button>
                <button onclick="AuthManager.switchTab('register')" id="tab-auth-register" class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-dim-gray hover:text-white transition-all">Cadastro</button>
            </div>

            <div id="form-login" class="space-y-6">
                <div class="auth-input-group">
                    <label>E-mail</label>
                    <input type="email" id="login-email" placeholder="seu@email.com">
                </div>
                <div class="auth-input-group">
                    <label>Senha</label>
                    <input type="password" id="login-password" placeholder="••••••••">
                </div>
                <button onclick="AuthManager.handleLogin()" class="w-full py-4 bg-luminous-gold text-midnight font-bold rounded-lg uppercase tracking-widest text-xs hover:bg-white transition-colors shadow-[0_0_20px_rgba(251,191,36,0.3)]">
                    Acessar Plataforma
                </button>
                <p class="text-center text-[9px] text-dim-gray mt-4 cursor-pointer hover:text-luminous-gold">Esqueci minha senha</p>
            </div>

            <div id="form-register" class="space-y-5 hidden">
                <div class="grid grid-cols-2 gap-4">
                    <div class="auth-input-group">
                        <label>Nome</label>
                        <input type="text" id="reg-name" placeholder="Nome">
                    </div>
                    <div class="auth-input-group">
                        <label>Sobrenome</label>
                        <input type="text" id="reg-surname" placeholder="Sobrenome">
                    </div>
                </div>
                <div class="auth-input-group">
                    <label>E-mail Corporativo</label>
                    <input type="email" id="reg-email" placeholder="nome@empresa.com">
                </div>
                 <div class="auth-input-group">
                    <label>Senha</label>
                    <input type="password" id="reg-password" placeholder="Crie uma senha forte">
                </div>
                <div class="flex items-start gap-2 mt-2">
                    <input type="checkbox" id="reg-terms" class="mt-1 w-3 h-3 accent-luminous-gold">
                    <label for="reg-terms" class="text-[9px] leading-tight text-dim-gray cursor-pointer">Concordo com a coleta de dados para fins de análise e aprimoramento da plataforma LuxSintax.</label>
                </div>
                <button onclick="AuthManager.handleRegister()" class="w-full py-4 bg-transparent border border-luminous-gold text-luminous-gold font-bold rounded-lg uppercase tracking-widest text-xs hover:bg-luminous-gold hover:text-midnight transition-colors">
                    Criar Conta Gratuita
                </button>
            </div>
        </div>
    </div>

    <div id="app-content" class="transition-all duration-700 app-locked">

        <nav class="fixed w-full z-50 bg-midnight/90 backdrop-blur-xl border-b border-white/5">
            <div class="max-w-[1800px] mx-auto px-6 py-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <a href="#" class="text-xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)]">
                        LUX<span class="text-white font-light opacity-60">SINTAX</span>
                    </a>
                    <span class="bg-luminous-gold/20 text-luminous-gold text-[9px] font-black px-2 py-0.5 rounded border border-luminous-gold/30 tracking-widest animate-pulse">BETA</span>
                </div>
                
                <div class="hidden md:flex gap-8 items-center">
                    <a href="#calculadora" class="nav-link"><span data-i18n="nav_home">INICIO</span></a>
                    <a href="#fundamentos" class="nav-link" data-i18n="nav_about">SOBRE</a>
                    
                    <button onclick="toggleLanguage()" class="text-xs text-muted-blue hover:text-luminous-gold transition-colors font-bold tracking-widest border-l border-white/10 pl-4 uppercase">
                        <span class="lang-display">PT / EN</span>
                    </button>
                    
                    <div id="user-display" class="flex items-center gap-2 pl-4 border-l border-white/10">
                        <div class="w-8 h-8 rounded-full bg-luminous-gold/20 flex items-center justify-center text-luminous-gold font-bold text-xs border border-luminous-gold/30">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="flex flex-col">
                            <span id="user-name-display" class="text-[10px] font-bold text-white uppercase leading-none">Usuário</span>
                            <button onclick="AuthManager.logout()" class="text-[9px] text-dim-gray hover:text-red-400 text-left uppercase font-bold">Sair</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <section id="calculadora" class="pt-24 pb-10 px-4 md:px-8 relative min-h-screen">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-gold-glow pointer-events-none opacity-30"></div>
            <div class="max-w-[1800px] mx-auto flex flex-col items-center">
                
                <div class="flex justify-start w-full gap-4 sm:gap-6 mb-8 relative z-10 fade-in-up overflow-x-auto pb-2 custom-scrollbar">
                    <button onclick="switchTool('query')" id="tab-query" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-active whitespace-nowrap text-luminous-gold">
                        <i class="fas fa-search"></i>
                        <span data-i18n="tab_query">CONSULTA<br>(NBR/LEED)</span>
                    </button>
                    <button onclick="switchTool('ponto')" id="tab-ponto" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                        <i class="fas fa-grip-lines"></i>
                        <span data-i18n="tab_horiz">SUPERFÍCIE<br>HORIZONTAL</span>
                    </button>
                    <button onclick="switchTool('vertical')" id="tab-vertical" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                        <i class="fas fa-grip-lines-vertical"></i>
                        <span data-i18n="tab_vert">SUPERFÍCIE<br>VERTICAL</span>
                    </button>
                    <button onclick="switchTool('homog')" id="tab-homog" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap">
                        <i class="fas fa-border-all"></i>
                        <span data-i18n="tab_dist">DISTRIBUIÇÃO<br>& DESENHO</span>
                    </button>
                </div>

                <div id="calculator-interface" class="w-full relative">
                    <div id="visual-tools" class="grid grid-cols-1 lg:grid-cols-12 gap-8 w-full transition-opacity duration-300 hidden">
                        <div class="lg:col-span-3 flex flex-col gap-6">
                            <div class="glass-panel p-6 rounded-2xl relative h-auto sticky top-24">
                                <div class="mb-4 text-center">
                                    <h3 class="text-md text-white mb-2 font-bold uppercase border-b border-white/10 pb-3" data-i18n="calc_params">Parâmetros da Fonte</h3>
                                    <div class="flex flex-col sm:flex-row gap-4 p-1 mb-6 justify-center">
                                        <label class="flex items-center gap-2 cursor-pointer group">
                                            <input type="radio" name="calc_mode" value="direct" checked onchange="updateCalcMode('direct')">
                                            <span class="text-[10px] text-muted-blue group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap" data-i18n="lbl_intensity">INTENSIDADE (CD)</span>
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer group">
                                            <input type="radio" name="calc_mode" value="photometric" onchange="updateCalcMode('photometric')">
                                            <span class="text-[10px] text-muted-blue group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap" data-i18n="lbl_photometry">FOTOMETRIA</span>
                                        </label>
                                    </div>
                                </div>

                                <div id="inputs-ponto" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_height">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="p-height" value="3.0" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-p-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_plane">PLANO DE TRABALHO (HP)</label><div class="flex items-baseline gap-1"><input type="number" id="p-plane" value="0.75" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-p-plane" min="0" max="5" step="0.05" value="0.75"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_beam">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="p-beam" value="30" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-p-beam" min="5" max="120" step="1" value="30"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_tilt">ORIENTAÇÃO (TILT)</label><div class="flex items-baseline gap-1"><input type="number" id="p-tilt" value="0" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-p-tilt" min="0" max="60" step="1" value="0"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-white/5 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_intensity_i">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="p-intensity" value="3000" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">CD</span></div></div><input type="range" id="range-p-intensity" min="0" max="20000" step="10" value="3000"></div>
                                    <div class="mode-photo-group hidden space-y-6 mb-6 border-t border-white/5 pt-4">
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_flux">FLUXO LUMINOSO</label><div class="flex items-baseline gap-1"><input type="number" id="p-flux" value="1500" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">LM</span></div></div><input type="range" id="range-p-flux" min="0" max="10000" step="10" value="1500"></div>
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_photo_val">VALOR FOTOMÉTRICO</label><div class="flex items-baseline gap-1"><input type="number" id="p-cdklm" value="2000" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">CD/KLM</span></div></div><input type="range" id="range-p-cdklm" min="0" max="10000" step="10" value="2000"></div>
                                    </div>
                                </div>

                                <div id="inputs-vertical" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_height">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="v-height" value="3.0" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-v-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap uppercase" data-i18n="lbl_hq">EIXO DO QUADRO (hq)</label><div class="flex items-baseline gap-1"><input type="number" id="v-hq" value="1.6" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-v-hq" min="0" max="10" step="0.1" value="1.6"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_wall_dist">DISTÂNCIA DA PAREDE (D)</label><div class="flex items-baseline gap-1"><input type="number" id="v-dist" value="1.0" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-v-dist" min="0.5" max="10" step="0.1" value="1.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_beam">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="v-beam" value="30" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-v-beam" min="5" max="120" step="1" value="30"></div>
                                    <div class="mb-2 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_tilt">ORIENTAÇÃO (TILT)</label><div class="flex items-baseline gap-1"><input type="number" id="v-tilt" value="30" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-v-tilt" min="0" max="90" step="1" value="30"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-white/5 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_intensity_i">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="v-intensity" value="3000" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">CD</span></div></div><input type="range" id="range-v-intensity" min="0" max="20000" step="10" value="3000"></div>
                                    <div class="mode-photo-group hidden space-y-6 mb-6 border-t border-white/5 pt-4">
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_flux">FLUXO LUMINOSO</label><div class="flex items-baseline gap-1"><input type="number" id="v-flux" value="1500" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">LM</span></div></div><input type="range" id="range-v-flux" min="0" max="10000" step="10" value="1500"></div>
                                        <div class="group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_photo_val">VALOR FOTOMÉTRICO</label><div class="flex items-baseline gap-1"><input type="number" id="v-cdklm" value="2000" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">CD/KLM</span></div></div><input type="range" id="range-v-cdklm" min="0" max="10000" step="10" value="2000"></div>
                                    </div>
                                </div>

                                <div id="inputs-homog" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_height">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="h-height" value="3.0" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-h-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_spacing">DISTÂNCIA ENTRE FONTES (D)</label><div class="flex items-baseline gap-1"><input type="number" id="h-spacing" value="2.0" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-h-spacing" min="0.5" max="10" step="0.1" value="2.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_beam">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="h-beam" value="30" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-h-beam" min="5" max="120" step="1" value="30"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-white/5 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap" data-i18n="lbl_intensity_i">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="h-intensity" value="3000" class="calc-input"><span class="text-[9px] text-muted-blue font-bold">CD</span></div></div><input type="range" id="range-h-intensity" min="0" max="20000" step="10" value="3000"></div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-9 flex flex-col gap-6">
                            <div class="glass-panel p-6 rounded-2xl flex-grow flex flex-col relative h-full min-h-[600px]">
                                <h3 class="text-sm text-white mb-6 border-b border-white/10 pb-4 drop-shadow-md uppercase tracking-widest font-bold" data-i18n="hdr_results">Resultados em Tempo Real</h3>
                                <div class="relative w-full flex-grow bg-twilight/50 border border-white/10 rounded-2xl mb-6 overflow-hidden canvas-container shadow-inner">
                                    <canvas id="beamCanvas" class="w-full h-full relative z-10"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="query-tool" class="w-full animate-fade-in-up col-span-12">
                        <div class="glass-panel p-6 rounded-2xl">
                            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-white/10 pb-4 gap-4">
                                <div>
                                    <h3 class="text-lg text-luminous-gold font-bold tracking-widest flex items-center gap-2 uppercase">
                                        <i class="fas fa-search"></i> <span data-i18n="hdr_query">Centro de Consultas</span>
                                    </h3>
                                    <p class="text-xs text-muted-blue mt-1" data-i18n="query_subtitle">Acesso rápido a normas e referências técnicas.</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="switchQueryTab('nbr8995')" id="btn-q-nbr8995" class="query-tab-btn query-tab-active" data-i18n="tab_interiors">Interiores (NBR 8995)</button>
                                    <button onclick="switchQueryTab('nbr5101')" id="btn-q-nbr5101" class="query-tab-btn" data-i18n="tab_roadway">Viária (NBR 5101)</button>
                                    <button onclick="switchQueryTab('leed')" id="btn-q-leed" class="query-tab-btn">LEED / WELL</button>
                                </div>
                            </div>
                            <div id="content-nbr8995" class="query-content">
                                <div class="overflow-x-auto max-h-[550px] overflow-y-auto custom-scrollbar">
                                    <table class="w-full text-left border-collapse">
                                        <thead class="bg-white/5 text-xs text-white font-bold uppercase tracking-wider sticky top-0 bg-midnight z-10">
                                            <tr><th class="p-4 border-b border-white/10" data-i18n="col_cat">Categoria</th><th class="p-4 border-b border-white/10" data-i18n="col_room">Ambiente</th><th class="p-4 border-b border-white/10 text-center">Lux (Em)</th><th class="p-4 border-b border-white/10 text-center">UGR Máx</th><th class="p-4 border-b border-white/10 text-center">Ra Min</th></tr>
                                        </thead>
                                        <tbody id="nbr8995-tbody" class="text-sm text-muted-blue divide-y divide-white/5"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div id="content-nbr5101" class="query-content hidden p-20 text-center opacity-40">CARREGANDO DADOS...</div>
                            <div id="content-leed" class="query-content hidden p-20 text-center opacity-40">CARREGANDO CERTIFICAÇÕES...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="fundamentos" class="py-24 px-6 border-t border-white/5 bg-midnight">
            <div class="max-w-[1800px] mx-auto text-center">
                 <h2 class="text-3xl text-luminous-gold font-bold tracking-widest mb-6 uppercase" data-i18n="about_title">SOBRE</h2>
                 <p class="text-sm text-dim-line font-light max-w-4xl mx-auto leading-relaxed" data-i18n="about_text">Plataforma de apoio para Lighting Designers baseada em cálculos fotométricos de precisão teórica.</p>
            </div>
        </section>

        <footer class="bg-midnight py-12 border-t border-white/5 text-[10px] text-center text-muted-blue uppercase font-black">
            <p>© 2026 LuxSintax. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // --- CONFIGURAÇÃO SUPABASE ---
        const SUPABASE_URL = 'https://ozytwdhuxsdefnunzinm.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96eXR3ZGh1eHNkZWZudW56aW5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NjM2MjEsImV4cCI6MjA4NjIzOTYyMX0.G6d564WnaaUQVSjTjpCDEA4d6zaVMvB_NQpo1KtE24s';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- AUTH MANAGER (REATORADO) ---
        const AuthManager = {
            init: async function() {
                const { data: { session } } = await supabase.auth.getSession();
                this.handleSessionUpdate(session);
                supabase.auth.onAuthStateChange((_event, session) => this.handleSessionUpdate(session));
            },
            handleSessionUpdate: function(session) {
                if (session) {
                    const name = session.user.user_metadata.first_name || session.user.email.split('@')[0];
                    document.getElementById('user-name-display').innerText = name.toUpperCase();
                    this.unlockApp();
                } else {
                    this.lockApp();
                }
            },
            lockApp: () => {
                document.getElementById('auth-modal').classList.remove('hidden');
                document.getElementById('app-content').classList.add('app-locked');
            },
            unlockApp: () => {
                document.getElementById('auth-modal').classList.add('hidden');
                document.getElementById('app-content').classList.remove('app-locked');
            },
            switchTab: (tab) => {
                const isLogin = tab === 'login';
                document.getElementById('form-login').classList.toggle('hidden', !isLogin);
                document.getElementById('form-register').classList.toggle('hidden', isLogin);
                document.getElementById('tab-auth-login').classList.toggle('border-b-2', isLogin);
                document.getElementById('tab-auth-register').classList.toggle('border-b-2', !isLogin);
            },
            handleLogin: async function() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) alert(error.message);
            },
            handleRegister: async function() {
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                const first_name = document.getElementById('reg-name').value;
                const last_name = document.getElementById('reg-surname').value;
                if (!document.getElementById('reg-terms').checked) return alert("Aceite os termos.");
                const { error } = await supabase.auth.signUp({
                    email, password, options: { data: { first_name, last_name } }
                });
                if (error) alert(error.message); else alert("Cadastro realizado! Verifique seu e-mail.");
            },
            logout: async () => { await supabase.auth.signOut(); location.reload(); }
        };

        // --- CORE STATE & UI HELPERS ---
        let currentTool = 'query';
        let calcMode = 'direct';
        const state = {
            ponto: { intensity: 3000, height: 3.0, beam: 30, tilt: 0, workPlane: 0.75, flux: 1500, cdklm: 2000 },
            vertical: { intensity: 3000, height: 3.0, dist: 1.0, tilt: 30, beam: 30, flux: 1500, cdklm: 2000, hq: 1.6 }, 
            homog: { intensity: 3000, height: 3.0, spacing: 2.0, workPlane: 0.75, beam: 30 }
        };

        const getIntensity = (s) => (calcMode === 'direct') ? s.intensity : (s.flux * s.cdklm) / 1000;

        function switchTool(tool) {
            currentTool = tool;
            const isQuery = tool === 'query';
            document.getElementById('visual-tools').classList.toggle('hidden', isQuery);
            document.getElementById('query-tool').classList.toggle('hidden', !isQuery);
            ['ponto', 'vertical', 'homog'].forEach(t => document.getElementById(`inputs-${t}`).classList.add('hidden'));
            if (!isQuery) document.getElementById(`inputs-${tool}`).classList.remove('hidden');
            
            document.querySelectorAll('.mode-tab-btn').forEach(btn => {
                const isActive = btn.id === `tab-${tool}`;
                btn.className = isActive ? "mode-tab-btn tab-active text-luminous-gold" : "mode-tab-btn tab-inactive";
            });
            updateCalculations();
        }

        function updateCalcMode(mode) {
            calcMode = mode;
            document.querySelectorAll('.mode-direct-group').forEach(el => el.classList.toggle('hidden', mode !== 'direct'));
            document.querySelectorAll('.mode-photo-group').forEach(el => el.classList.toggle('hidden', mode === 'direct'));
            updateCalculations();
        }

        // --- CALCULADORA ENGINE (LÓGICA PRESERVADA) ---
        function updateCalculations() {
            const canvas = document.getElementById('beamCanvas');
            if (!canvas || currentTool === 'query') return;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            canvas.width = canvas.clientWidth * dpr;
            canvas.height = canvas.clientHeight * dpr;
            ctx.scale(dpr, dpr);
            
            const cw = canvas.clientWidth, ch = canvas.clientHeight, floorY = ch - 70, centerX = cw / 2;
            ctx.clearRect(0, 0, cw, ch);
            
            // Desenho do Piso
            ctx.strokeStyle = '#334155'; ctx.beginPath(); ctx.moveTo(0, floorY); ctx.lineTo(cw, floorY); ctx.stroke();
            
            const s = state[currentTool];
            const I = getIntensity(s);
            const scale = 50; // simplificado para o preview

            if (currentTool === 'ponto') {
                const sy = floorY - (s.height * scale);
                ctx.fillStyle = '#FBBF24'; ctx.beginPath(); ctx.arc(centerX, sy, 5, 0, Math.PI*2); ctx.fill();
                // Lux Cálculo Simples (Lei do Cosseno Cúbico)
                const lux = (I * Math.pow(Math.cos(s.tilt * Math.PI/180), 3)) / Math.pow(s.height, 2);
                ctx.fillStyle = "#FBBF24"; ctx.font = "bold 12px Manrope";
                ctx.fillText(`${Math.round(lux)} LUX NO EIXO`, centerX + 10, sy + 20);
            }
        }

        // --- NORMAS DATABASE (SAMPLE) ---
        const norms = [
            { cat: "Escritório", room: "Escrita, Leitura, CAD", lux: 500, ugr: 19, ra: 80 },
            { cat: "Escritório", room: "Arquivamento, Cópia", lux: 300, ugr: 22, ra: 80 },
            { cat: "Indústria", room: "Montagem de precisão", lux: 750, ugr: 19, ra: 80 }
        ];

        function populateNorms() {
            const tbody = document.getElementById('nbr8995-tbody');
            tbody.innerHTML = norms.map(n => `
                <tr class="border-b border-white/5">
                    <td class="p-4 text-xs font-bold text-luminous-gold">${n.cat}</td>
                    <td class="p-4 text-dim-gray">${n.room}</td>
                    <td class="p-4 text-center text-white">${n.lux}</td>
                    <td class="p-4 text-center text-dim-gray">${n.ugr}</td>
                    <td class="p-4 text-center text-dim-gray">${n.ra}</td>
                </tr>
            `).join('');
        }

        // --- INITIALIZATION ---
        document.addEventListener("DOMContentLoaded", () => {
            AuthManager.init();
            populateNorms();
            switchTool('query');

            // Binding Inputs
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const [toolPrefix, param] = e.target.id.split('-');
                    const toolKey = toolPrefix === 'p' ? 'ponto' : toolPrefix === 'v' ? 'vertical' : 'homog';
                    const mapping = { height: 'height', plane: 'workPlane', beam: 'beam', tilt: 'tilt', intensity: 'intensity' };
                    if (state[toolKey]) state[toolKey][mapping[param]] = parseFloat(e.target.value);
                    updateCalculations();
                });
            });
        });

        window.addEventListener('resize', updateCalculations);
    </script>
</body>
</html>