<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxSintax | Lighting Design SaaS (v1.1)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'midnight': '#020617', 'twilight': '#0f172a', 'glass': 'rgba(15, 23, 42, 0.6)',
                        'luminous-gold': '#FBBF24', 'tech-cyan': '#22d3ee', 'dim-gray': '#94a3b8',
                        'dim-line': '#cbd5e1', 'starlight': '#f8fafc', 'leed-green': '#84cc16'
                    },
                    fontFamily: { sans: ['Manrope', 'sans-serif'] },
                    backgroundImage: {
                        'blue-hour-gradient': 'linear-gradient(to bottom, #020617, #0f172a)',
                        'gold-glow': 'radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, rgba(2, 6, 23, 0) 70%)'
                    },
                    animation: { 'fade-in-up': 'fadeInUp 0.8s ease-out forwards' },
                    keyframes: { fadeInUp: { '0%': { opacity: 0, transform: 'translateY(20px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } } }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Manrope', sans-serif; background-color: #020617; color: #f8fafc; background: linear-gradient(180deg, #020617 0%, #0f172a 100%); letter-spacing: 0.5px; min-height: 100vh; }
        h1, h2, h3, h4, .nav-link, button, input, label, select { text-transform: uppercase !important; }
        
        /* Glassmorphism & UI Components */
        .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(148, 163, 184, 0.1); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); }
        
        /* Form Inputs */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: #FBBF24; cursor: pointer; margin-top: -5px; box-shadow: 0 0 10px rgba(251, 191, 36, 0.8); border: 2px solid #0f172a; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #1e293b; border-radius: 2px; }
        input[type=number], select, input[type=text], input[type=date], input[type=email], input[type=password] { background-color: transparent; color: #f8fafc; border: none; border-bottom: 1px solid #334155; text-align: left; width: 100%; font-family: 'Manrope', sans-serif; font-weight: 300; -moz-appearance: textfield; padding: 8px 0; }
        input[type=number] { text-align: right; width: 65px; } 
        input:focus, select:focus { outline: none; border-bottom: 1px solid #FBBF24 !important; color: #FBBF24; }
        select.custom-select option { background-color: #0f172a; color: #f8fafc; }
        
        /* Auth & Locking specific styles */
        .auth-input-group label { font-size: 10px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; color: #FBBF24 !important; }
        .auth-input-group input { width: 100%; text-align: left; }
        .app-locked { filter: blur(8px) grayscale(0.5); pointer-events: none; user-select: none; overflow: hidden; height: 100vh; transition: filter 0.5s ease; }
        
        /* Navigation & Tabs */
        .nav-link { position: relative; font-size: 0.85rem; letter-spacing: 2px; color: #94a3b8; transition: color 0.3s; }
        .nav-link:hover { color: #FBBF24; text-shadow: 0 0 8px rgba(251, 191, 36, 0.4); }
        .tab-active { border-bottom: 2px solid #FBBF24 !important; color: #FBBF24 !important; opacity: 1 !important; }
        .tab-inactive { border-bottom: 2px solid transparent !important; color: #94a3b8 !important; opacity: 0.6; }
        .mode-tab-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 20px; min-width: 130px; height: 90px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05); background: rgba(255, 255, 255, 0.02); transition: all 0.3s ease; backdrop-filter: blur(5px); position: relative; }
        .mode-tab-btn:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); border-color: rgba(255, 255, 255, 0.2); }
        
        /* Visual Tools */
        .canvas-container { background: linear-gradient(135deg, #0B1221 0%, #1e293b 100%); box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(251, 191, 36, 0.3); border-radius: 4px; }
        
        /* Radio Button Styling */
        input[type="radio"] { appearance: none; background-color: transparent; margin: 0; font: inherit; color: #FBBF24; width: 1.15em; height: 1.15em; border: 1px solid #FBBF24; border-radius: 50%; display: grid; place-content: center; }
        input[type="radio"]::before { content: ""; width: 0.65em; height: 0.65em; background-color: #FBBF24; border-radius: 50%; transform: scale(0); transition: 120ms transform ease-in-out; }
        input[type="radio"]:checked::before { transform: scale(1); }

        .query-tab-btn { padding: 8px 16px; font-size: 10px; font-weight: bold; text-transform: uppercase; border-radius: 9999px; border: 1px solid transparent; transition: all 0.3s; color: #94a3b8; }
        .query-tab-active { background-color: rgba(251, 191, 36, 0.1); color: #FBBF24; border-color: #FBBF24; }
        .leed-level-box { transition: all 0.3s; border: 1px solid transparent; opacity: 0.5; cursor: pointer; }
        .leed-level-box.active { opacity: 1; border-color: #FBBF24; background: rgba(251, 191, 36, 0.1); transform: scale(1.05); }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-luminous-gold selection:text-midnight">

    <div id="auth-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 transition-all duration-500">
        <div class="absolute inset-0 bg-midnight/90 backdrop-blur-sm"></div>
        <div class="glass-panel w-full max-w-md p-8 rounded-2xl relative z-10 animate-fade-in-up border border-luminous-gold/20 shadow-[0_0_50px_rgba(251,191,36,0.1)]">
            <div class="text-center mb-8">
                <div class="text-2xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)] mb-2">LUX<span class="text-white font-light opacity-60">SINTAX</span></div>
                <p class="text-[10px] text-dim-gray uppercase tracking-widest">SaaS de Inteligência em Iluminação</p>
                <p id="connection-status" class="text-[9px] text-red-400 mt-2 font-bold animate-pulse">CONECTANDO AO SERVIDOR...</p>
            </div>
            <div class="flex border-b border-white/10 mb-6">
                <button onclick="window.AuthManager.switchTab('login')" id="tab-auth-login" class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-luminous-gold border-b-2 border-luminous-gold transition-all">Login</button>
                <button onclick="window.AuthManager.switchTab('register')" id="tab-auth-register" class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-dim-gray hover:text-white transition-all">Cadastro</button>
            </div>
            <div id="form-login" class="space-y-6">
                <div class="auth-input-group"><label>E-mail</label><input type="email" id="login-email" placeholder="seu@email.com"></div>
                <div class="auth-input-group"><label>Senha</label><input type="password" id="login-password" placeholder="••••••••"></div>
                <button onclick="window.AuthManager.handleLogin()" class="w-full py-4 bg-luminous-gold text-midnight font-bold rounded-lg uppercase tracking-widest text-xs hover:bg-white transition-colors shadow-[0_0_20px_rgba(251,191,36,0.3)]">Acessar Plataforma</button>
            </div>
            <div id="form-register" class="space-y-5 hidden">
                <div class="grid grid-cols-2 gap-4">
                    <div class="auth-input-group"><label>Nome</label><input type="text" id="reg-name" placeholder="Nome"></div>
                    <div class="auth-input-group"><label>Sobrenome</label><input type="text" id="reg-surname" placeholder="Sobrenome"></div>
                </div>
                <div class="auth-input-group"><label>E-mail Corporativo</label><input type="email" id="reg-email" placeholder="nome@empresa.com"></div>
                 <div class="auth-input-group"><label>Senha</label><input type="password" id="reg-password" placeholder="Crie uma senha forte"></div>
                <div class="flex items-start gap-2 mt-2">
                    <input type="checkbox" id="reg-terms" class="mt-1 w-3 h-3 accent-luminous-gold"><label for="reg-terms" class="text-[9px] leading-tight text-dim-gray cursor-pointer">Concordo com os termos de uso.</label>
                </div>
                <button onclick="window.AuthManager.handleRegister()" class="w-full py-4 bg-transparent border border-luminous-gold text-luminous-gold font-bold rounded-lg uppercase tracking-widest text-xs hover:bg-luminous-gold hover:text-midnight transition-colors">Criar Conta Gratuita</button>
            </div>
        </div>
    </div>

    <div id="app-content" class="transition-all duration-700 app-locked flex flex-col min-h-screen">
        <nav class="fixed w-full z-50 bg-midnight/90 backdrop-blur-xl border-b border-white/5">
            <div class="max-w-[1800px] mx-auto px-6 py-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <a href="#" class="text-xl font-bold tracking-[0.2em] text-luminous-gold drop-shadow-[0_0_10px_rgba(251,191,36,0.3)]">LUX<span class="text-white font-light opacity-60">SINTAX</span></a>
                    <span class="bg-luminous-gold/20 text-luminous-gold text-[9px] font-black px-2 py-0.5 rounded border border-luminous-gold/30 tracking-widest animate-pulse">BETA</span>
                </div>
                <div class="hidden md:flex gap-8 items-center">
                    <button class="nav-link">INICIO</button>
                    <button class="nav-link">SOBRE</button>
                    <div id="user-display" class="flex items-center gap-2 pl-4 border-l border-white/10">
                        <div class="w-8 h-8 rounded-full bg-luminous-gold/20 flex items-center justify-center text-luminous-gold font-bold text-xs border border-luminous-gold/30"><i class="fas fa-user"></i></div>
                        <div class="flex flex-col"><span id="user-name-display" class="text-[10px] font-bold text-white uppercase leading-none">Usuário</span><button onclick="window.AuthManager.logout()" class="text-[9px] text-dim-gray hover:text-red-400 text-left uppercase font-bold">Sair</button></div>
                    </div>
                </div>
            </div>
        </nav>

        <section id="calculadora" class="pt-24 pb-10 px-4 md:px-8 relative min-h-screen">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-gold-glow pointer-events-none opacity-30"></div>
            <div class="max-w-[1800px] mx-auto flex flex-col items-center">
                
                <div class="flex justify-start w-full gap-4 sm:gap-6 mb-8 relative z-10 fade-in-up overflow-x-auto pb-2 custom-scrollbar">
                    <button onclick="window.switchTool('query')" id="tab-query" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-active whitespace-nowrap text-luminous-gold"><i class="fas fa-search"></i><span>CONSULTA<br>(NBR/LEED)</span></button>
                    <button onclick="window.switchTool('ponto')" id="tab-ponto" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap"><i class="fas fa-grip-lines"></i><span>SUPERFÍCIE<br>HORIZONTAL</span></button>
                    <button onclick="window.switchTool('vertical')" id="tab-vertical" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap"><i class="fas fa-grip-lines-vertical"></i><span>SUPERFÍCIE<br>VERTICAL</span></button>
                    <button onclick="window.switchTool('homog')" id="tab-homog" class="mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all tab-inactive whitespace-nowrap"><i class="fas fa-border-all"></i><span>DISTRIBUIÇÃO<br>& DESENHO</span></button>
                </div>

                <div id="calculator-interface" class="w-full relative">
                    <div id="visual-tools" class="grid grid-cols-1 lg:grid-cols-12 gap-8 w-full transition-opacity duration-300 hidden">
                        <div class="lg:col-span-3 flex flex-col gap-6">
                            <div class="glass-panel p-6 rounded-2xl relative h-auto sticky top-24">
                                <div class="mb-4">
                                    <h3 class="text-md text-white mb-2 font-bold whitespace-nowrap text-center drop-shadow-md border-b border-white/10 pb-3">Parâmetros da Fonte</h3>
                                    <div class="flex flex-col sm:flex-row gap-4 p-1 mb-6 justify-center">
                                        <label class="flex items-center gap-2 cursor-pointer group"><input type="radio" name="calc_mode" value="direct" checked onchange="window.updateCalcMode('direct')"><span class="text-[10px] text-muted-blue group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap">INTENSIDADE (CD)</span></label>
                                        <label class="flex items-center gap-2 cursor-pointer group"><input type="radio" name="calc_mode" value="photometric" onchange="window.updateCalcMode('photometric')"><span class="text-[10px] text-muted-blue group-hover:text-luminous-gold transition-colors font-bold uppercase whitespace-nowrap">FOTOMETRIA</span></label>
                                    </div>
                                </div>
                                <div id="inputs-ponto" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="p-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-p-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">PLANO DE TRABALHO (HP)</label><div class="flex items-baseline gap-1"><input type="number" id="p-plane" value="0.75" min="0" max="5" step="0.05"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-p-plane" min="0" max="5" step="0.05" value="0.75"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="p-beam" value="30" min="5" max="120"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-p-beam" min="5" max="120" step="1" value="30"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ORIENTAÇÃO (TILT)</label><div class="flex items-baseline gap-1"><input type="number" id="p-tilt" value="0" min="0" max="60"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-p-tilt" min="0" max="60" step="1" value="0"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-white/5 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="p-intensity" value="3000"><span class="text-[9px] text-muted-blue font-bold">CD</span></div></div><input type="range" id="range-p-intensity" min="0" max="20000" step="10" value="3000"></div>
                                </div>
                                <div id="inputs-vertical" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="v-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-v-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">EIXO DO QUADRO (hq)</label><div class="flex items-baseline gap-1"><input type="number" id="v-hq" value="1.6" min="0" max="10" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-v-hq" min="0" max="10" step="0.1" value="1.6"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">DISTÂNCIA PAREDE (D)</label><div class="flex items-baseline gap-1"><input type="number" id="v-dist" value="1.0" min="0.5" max="10" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-v-dist" min="0.5" max="10" step="0.1" value="1.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="v-beam" value="30" min="5" max="120"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-v-beam" min="5" max="120" step="1" value="30"></div>
                                    <div class="mb-2 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ORIENTAÇÃO (TILT)</label><div class="flex items-baseline gap-1"><input type="number" id="v-tilt" value="30" min="0" max="90"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-v-tilt" min="0" max="90" step="1" value="30"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-white/5 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="v-intensity" value="3000"><span class="text-[9px] text-muted-blue font-bold">CD</span></div></div><input type="range" id="range-v-intensity" min="0" max="20000" step="10" value="3000"></div>
                                </div>
                                <div id="inputs-homog" class="hidden">
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ALTURA DA FONTE (H)</label><div class="flex items-baseline gap-1"><input type="number" id="h-height" value="3.0" min="0.5" max="20" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-h-height" min="0.5" max="20" step="0.1" value="3.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">PLANO DE TRABALHO (HP)</label><div class="flex items-baseline gap-1"><input type="number" id="h-plane" value="0.75" min="0" max="5" step="0.05"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-h-plane" min="0" max="5" step="0.05" value="0.75"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">DISTÂNCIA FONTES (D)</label><div class="flex items-baseline gap-1"><input type="number" id="h-spacing" value="2.0" min="0.5" max="10" step="0.1"><span class="text-[9px] text-muted-blue font-bold">M</span></div></div><input type="range" id="range-h-spacing" min="0.5" max="10" step="0.1" value="2.0"></div>
                                    <div class="mb-6 group"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">ABERTURA DO FACHO</label><div class="flex items-baseline gap-1"><input type="number" id="h-beam" value="30" min="5" max="120"><span class="text-[9px] text-muted-blue font-bold">°</span></div></div><input type="range" id="range-h-beam" min="5" max="120" step="1" value="30"></div>
                                    <div class="mode-direct-group mb-6 group border-t border-white/5 pt-4"><div class="flex justify-between items-end mb-2"><label class="text-[10px] text-muted-blue font-bold whitespace-nowrap">INTENSIDADE (I)</label><div class="flex items-baseline gap-1"><input type="number" id="h-intensity" value="3000"><span class="text-[9px] text-muted-blue font-bold">CD</span></div></div><input type="range" id="range-h-intensity" min="0" max="20000" step="10" value="3000"></div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-9 flex flex-col gap-6">
                            <div class="glass-panel p-6 rounded-2xl flex-grow flex flex-col relative h-full min-h-[600px]">
                                <h3 class="text-sm text-white mb-6 border-b border-white/10 pb-4 drop-shadow-md uppercase tracking-widest font-bold">Resultados em Tempo Real</h3>
                                <div class="relative w-full flex-grow bg-twilight/50 border border-white/10 rounded-2xl mb-6 overflow-hidden canvas-container shadow-inner">
                                    <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px); background-size: 40px 40px;"></div>
                                    <canvas id="beamCanvas" class="w-full h-full relative z-10"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="query-tool" class="w-full animate-fade-in-up col-span-12">
                         <div class="glass-panel p-6 rounded-2xl">
                            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-white/10 pb-4 gap-4">
                                <div>
                                    <h3 class="text-lg text-luminous-gold font-bold tracking-widest flex items-center gap-2 uppercase"><i class="fas fa-search"></i> <span>Centro de Consultas</span></h3>
                                    <p class="text-xs text-muted-blue mt-1">Acesso rápido a normas e referências técnicas.</p>
                                </div>
                                <div class="flex gap-2"><button class="query-tab-btn query-tab-active">Interiores (NBR 8995)</button></div>
                            </div>
                            <div id="content-nbr8995" class="query-content">
                                <div class="overflow-hidden rounded-xl border border-white/10">
                                    <div class="overflow-x-auto max-h-[550px] overflow-y-auto custom-scrollbar">
                                        <table class="w-full text-left border-collapse">
                                            <thead class="bg-white/5 text-xs text-white font-bold uppercase tracking-wider sticky top-0 bg-midnight z-10">
                                                <tr><th class="p-4 border-b border-white/10">Categoria</th><th class="p-4 border-b border-white/10">Ambiente / Tarefa</th><th class="p-4 border-b border-white/10 text-center text-white">Lux (Em)</th><th class="p-4 border-b border-white/10 text-center">UGR Máx</th><th class="p-4 border-b border-white/10 text-center">Ra Min</th></tr>
                                            </thead>
                                            <tbody id="nbr8995-tbody" class="text-sm text-muted-blue divide-y divide-white/5"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <footer class="bg-midnight py-12 px-6 border-t border-white/5 mt-auto text-[10px] tracking-widest text-muted-blue opacity-60">
            <div class="max-w-[1800px] mx-auto text-center uppercase font-black">
                <a href="#" class="text-lg font-bold tracking-[0.2em] text-luminous-gold uppercase">LuxSintax</a>
                <p class="mt-2">© 2026 LuxSintax. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        // 1. SUPABASE CONFIG
        const SUPABASE_URL = 'https://ozytwdhuxsdefnunzinm.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96eXR3ZGh1eHNkZWZudW56aW5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NjM2MjEsImV4cCI6MjA4NjIzOTYyMX0.G6d564WnaaUQVSjTjpCDEA4d6zaVMvB_NQpo1KtE24s';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        const statusEl = document.getElementById('connection-status');
        if(statusEl) { statusEl.innerText = "SISTEMA ONLINE"; statusEl.classList.remove('text-red-400', 'animate-pulse'); statusEl.classList.add('text-leed-green'); }

        // 2. STATE & GLOBALS
        window.state = {
            ponto: { intensity: 3000, height: 3.0, beam: 30, tilt: 0, workPlane: 0.75, flux: 1500, cdklm: 2000 },
            vertical: { intensity: 3000, height: 3.0, dist: 1.0, tilt: 30, beam: 30, flux: 1500, cdklm: 2000, hq: 1.6 }, 
            homog: { intensity: 3000, height: 3.0, spacing: 2.0, workPlane: 0.75, beam: 30, flux: 1500, cdklm: 2000, tilt: 0 },
        };
        window.currentTool = 'query';
        window.calcMode = 'direct';

        // 3. AUTH MANAGER
        window.AuthManager = {
            init: async function() {
                const { data: { session } } = await supabase.auth.getSession();
                this.handleSessionUpdate(session);
                supabase.auth.onAuthStateChange((event, session) => this.handleSessionUpdate(session));
            },
            handleSessionUpdate: function(session) {
                if (session) {
                    const name = session.user.user_metadata.first_name || (session.user.email ? session.user.email.split('@')[0] : 'Usuário');
                    document.getElementById('user-name-display').innerText = name.toUpperCase();
                    this.unlockApp();
                } else { this.lockApp(); }
            },
            lockApp: function() { document.getElementById('auth-modal').classList.remove('hidden'); document.getElementById('app-content').classList.add('app-locked'); },
            unlockApp: function() { document.getElementById('auth-modal').classList.add('hidden'); document.getElementById('app-content').classList.remove('app-locked'); setTimeout(() => { window.updateCalculations(); }, 500); },
            switchTab: function(tab) {
                const loginForm = document.getElementById('form-login'); const regForm = document.getElementById('form-register');
                const btnLogin = document.getElementById('tab-auth-login'); const btnReg = document.getElementById('tab-auth-register');
                if (tab === 'login') {
                    loginForm.classList.remove('hidden'); regForm.classList.add('hidden');
                    btnLogin.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-luminous-gold border-b-2 border-luminous-gold transition-all";
                    btnReg.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-dim-gray hover:text-white transition-all";
                } else {
                    loginForm.classList.add('hidden'); regForm.classList.remove('hidden');
                    btnReg.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-luminous-gold border-b-2 border-luminous-gold transition-all";
                    btnLogin.className = "flex-1 py-3 text-xs font-bold uppercase tracking-wider text-dim-gray hover:text-white transition-all";
                }
            },
            handleLogin: async function() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) alert(error.message);
            },
            handleRegister: async function() {
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                const firstName = document.getElementById('reg-name').value;
                const lastName = document.getElementById('reg-surname').value;
                if (!document.getElementById('reg-terms').checked) return alert("Aceite os termos.");
                const { data, error } = await supabase.auth.signUp({ email, password, options: { data: { first_name: firstName, last_name: lastName } } });
                if (error) alert(error.message); else if (data.session) this.unlockApp(); else alert("Cadastro feito. Verifique e-mail.");
            },
            logout: async function() { await supabase.auth.signOut(); location.reload(); }
        };

        // 4. LÓGICA DE NEGÓCIO E RENDERIZAÇÃO
        window.switchTool = function(toolId) {
            window.currentTool = toolId;
            const isQuery = toolId === 'query';
            document.getElementById('visual-tools').classList.toggle('hidden', isQuery);
            document.getElementById('query-tool').classList.toggle('hidden', !isQuery);
            
            ['ponto', 'vertical', 'homog'].forEach(t => {
                const el = document.getElementById(`inputs-${t}`);
                if(el) el.classList.add('hidden');
            });
            if(!isQuery) { document.getElementById(`inputs-${toolId}`).classList.remove('hidden'); }

            ['query', 'ponto', 'vertical', 'homog'].forEach(id => {
                const btn = document.getElementById('tab-' + id);
                let cls = "mode-tab-btn text-[12px] font-bold tracking-widest uppercase transition-all whitespace-nowrap ";
                if(id === 'query') cls += "text-luminous-gold ";
                btn.className = cls + (id === toolId ? "tab-active" : "tab-inactive");
            });

            if (toolId === 'query') window.filterNorms();
            else setTimeout(() => window.updateCalculations(), 50);
        }

        window.updateCalcMode = function(mode) {
            window.calcMode = mode;
            document.querySelectorAll('.mode-direct-group').forEach(el => el.classList.toggle('hidden', mode !== 'direct'));
            document.querySelectorAll('.mode-photo-group').forEach(el => el.classList.toggle('hidden', mode === 'direct'));
            window.updateCalculations();
        }

        function getIntensity(s) { return window.calcMode === 'direct' ? s.intensity : (s.flux * s.cdklm) / 1000; }

        // --- DRAWING HELPERS ---
        const drawFloor = (ctx, cw, floorY, currentTool) => { 
            ctx.strokeStyle = '#334155'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, floorY); ctx.lineTo(cw, floorY); ctx.stroke(); 
            ctx.fillStyle = "#94a3b8"; ctx.font = "11px Manrope"; ctx.textAlign = "left";
            if(currentTool === 'ponto') {
                 ctx.fillText("LINHA DE PISO (lp)", 10, floorY + 15); ctx.fillText("lp: 0.00m", 10, floorY - 5); ctx.beginPath(); ctx.moveTo(0, floorY); ctx.lineTo(5, floorY); ctx.stroke();
            } else if(currentTool === 'vertical') {
                 ctx.fillText("lp: 0.00m", 10, floorY - 5);
            }
        };
        const drawPlaneLine = (ctx, cw, py, text) => { 
            ctx.beginPath(); ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(148, 163, 184, 0.4)"; ctx.moveTo(0, py); ctx.lineTo(cw, py); ctx.stroke(); ctx.setLineDash([]); 
            ctx.fillStyle = "#94a3b8"; ctx.font = "11px Manrope"; ctx.fillText(text, 10, py - 5); 
        }; 
        const drawSource = (ctx, x, y) => { ctx.fillStyle = '#FBBF24'; ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI * 2); ctx.fill(); };
        const drawBeam = (ctx, floorY, x, y, bm, tl, scale, op = 0.6) => {
            const H = floorY - y, tr = tl * Math.PI / 180, br = bm * Math.PI / 180;
            ctx.save(); ctx.translate(x, y);
            const g = ctx.createLinearGradient(0, 0, 0, H); g.addColorStop(0, `rgba(251, 191, 36, ${op})`); g.addColorStop(1, `rgba(251, 191, 36, 0)`);
            ctx.fillStyle = g; ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(H * Math.tan(tr - br / 2), H); ctx.lineTo(H * Math.tan(tr + br / 2), H); ctx.closePath(); ctx.fill(); ctx.restore();
        };
        const drawHeightLine = (ctx, x, y, hVal, offsetX = 45) => { 
            ctx.beginPath(); ctx.setLineDash([2, 4]); ctx.moveTo(x - 20, y); ctx.lineTo(x - 10, y); ctx.strokeStyle = '#475569'; ctx.stroke(); ctx.setLineDash([]); 
            ctx.font = "11px Manrope"; ctx.fillStyle = "#94a3b8"; ctx.fillText(`${hVal.toFixed(1)}m`, x - offsetX, y + 3); 
        };
        const drawDimLine = (ctx, x1, y1, x2, y2, text) => { 
            ctx.beginPath(); ctx.strokeStyle = "#cbd5e1"; ctx.lineWidth = 1; 
            ctx.moveTo(x1, y1 - 3); ctx.lineTo(x1, y1 + 3); ctx.moveTo(x1, y1); ctx.lineTo(x2, y1); ctx.moveTo(x2, y1 - 3); ctx.lineTo(x2, y1 + 3); ctx.stroke(); 
            ctx.font = "11px Manrope"; const mx = (x1 + x2) / 2; const my = (y1 + y2) / 2; const tw = ctx.measureText(text).width; 
            ctx.fillStyle = "rgba(2, 6, 23, 0.95)"; ctx.fillRect(mx - tw / 2 - 4, my - 8, tw + 8, 16); 
            ctx.fillStyle = "#cbd5e1"; ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.fillText(text, mx, my); ctx.textAlign = "start"; ctx.textBaseline = "alphabetic";
        };
        const drawDimLineVertical = (ctx, x, y1, y2, text) => { 
            ctx.beginPath(); ctx.strokeStyle = "#cbd5e1"; ctx.lineWidth = 1; ctx.moveTo(x, y1); ctx.lineTo(x, y2); ctx.stroke(); 
            const cy = (y1 + y2) / 2; ctx.save(); ctx.translate(x, cy); ctx.rotate(-Math.PI/2); 
            ctx.font = "11px Manrope"; const tw = ctx.measureText(text).width; 
            ctx.fillStyle = "rgba(2, 6, 23, 0.95)"; ctx.fillRect(-tw/2-4, -8, tw+8, 16); 
            ctx.fillStyle = "#cbd5e1"; ctx.fillText(text, -tw/2, 4); ctx.restore(); 
        };
        const drawAngleDim = (ctx, x, y, angle, tilt, radius, color, isTilt = false) => {
            const tr = tilt * Math.PI / 180;
            let startAngle, endAngle, centerAngle;
            if (isTilt) { centerAngle = (Math.PI / 2) - (tr / 2); startAngle = (Math.PI / 2) - tr; endAngle = (Math.PI / 2); } 
            else { const br = angle * Math.PI / 180; const beamAxis = (Math.PI / 2) - tr; centerAngle = beamAxis; startAngle = beamAxis - (br / 2); endAngle = beamAxis + (br / 2); }
            ctx.beginPath(); ctx.arc(x, y, radius, startAngle, endAngle); ctx.strokeStyle = color; ctx.lineWidth = 1.5; ctx.stroke();
            const textRadius = radius + 15; const tx = x + textRadius * Math.cos(centerAngle); const ty = y + textRadius * Math.sin(centerAngle);
            ctx.font = "bold 11px Manrope"; const text = angle + "°"; const tw = ctx.measureText(text).width;
            ctx.fillStyle = "rgba(2, 6, 23, 0.9)"; ctx.fillRect(tx - tw/2 - 2, ty - 8, tw + 4, 16);
            ctx.fillStyle = color; ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.fillText(text, tx, ty); ctx.textAlign = "start"; ctx.textBaseline = "alphabetic";
        };
        const drawTextVal = (ctx, text, x, y) => {
            ctx.font = "bold 11px Manrope"; const tw = ctx.measureText(text).width;
            ctx.fillStyle = "rgba(15, 23, 42, 0.9)"; ctx.fillRect(x - tw/2 - 4, y - 16, tw + 8, 20);
            ctx.fillStyle = "#FBBF24"; ctx.textAlign = "center"; ctx.fillText(text, x, y - 2); ctx.textAlign = "start"; 
        }

        // --- CORE RENDER LOOP ---
        window.updateCalculations = function() {
            const canvas = document.getElementById('beamCanvas');
            if (!canvas || window.currentTool === 'query') return;

            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
            
            const ctx = canvas.getContext('2d'); ctx.scale(dpr, dpr);
            const cw = rect.width; const ch = rect.height; const floorY = ch - 70; const centerX = cw / 2;

            // Scalling Logic
            let boundsH = 3.0; let boundsW = 3.0; 
            const s = window.state[window.currentTool];
            if (window.currentTool === 'ponto') {
                boundsH = s.height;
                const maxAngleRad = (Math.abs(s.tilt) + s.beam/2) * Math.PI / 180;
                const limitRad = Math.min(maxAngleRad, 1.48); // ~85 deg
                boundsW = s.height * Math.tan(limitRad);
            } else if (window.currentTool === 'vertical') { boundsH = s.height; boundsW = Math.max(s.dist * 1.6, 3.5); } 
            else if (window.currentTool === 'homog') { boundsH = s.height; const halfBeamRad = (s.beam/2) * Math.PI / 180; boundsW = (s.spacing / 2) + (s.height * Math.tan(halfBeamRad)); }

            const availH = floorY - 60; const availW = (cw / 2) - 50; 
            let scaleH = availH / Math.max(boundsH, 0.5); let scaleW = availW / Math.max(boundsW, 0.5);
            let scale = Math.min(scaleH, scaleW); scale = Math.min(Math.max(scale, 12), 160);

            ctx.clearRect(0, 0, cw, ch);
            
            // DRAWING LOGIC PER TOOL
            if (window.currentTool === 'ponto') {
                const I = getIntensity(s), sy = floorY - (s.height * scale), py = floorY - (s.workPlane * scale), tr = s.tilt * Math.PI / 180, br = s.beam * Math.PI / 180;
                
                const luxFloor = (I * Math.pow(Math.cos(tr), 3)) / (s.height ** 2);
                const hEff = s.height - s.workPlane;
                const luxPlane = hEff > 0 ? (I * Math.pow(Math.cos(tr), 3)) / (hEff ** 2) : 0;
                const dia = 2 * (s.height / Math.cos(tr)) * Math.tan(br / 2); 
                
                drawFloor(ctx, cw, floorY, 'ponto'); drawSource(ctx, centerX, sy); drawBeam(ctx, floorY, centerX, sy, s.beam, s.tilt, scale); drawHeightLine(ctx, centerX, sy, parseFloat(s.height)); drawPlaneLine(ctx, cw, py, `hp: ${s.workPlane}m`);
                drawAngleDim(ctx, centerX, sy, s.beam, s.tilt, 40, "rgba(251, 191, 36, 0.8)", false); 
                
                if (s.tilt > 0) {
                    const axisX = centerX + (s.height * scale) * Math.tan(tr);
                    ctx.beginPath(); ctx.setLineDash([5, 3, 2, 3]); ctx.strokeStyle = "rgba(148, 163, 184, 0.5)"; ctx.moveTo(centerX, sy); ctx.lineTo(axisX, floorY); ctx.stroke(); ctx.setLineDash([]);
                    ctx.beginPath(); ctx.setLineDash([2, 2]); ctx.strokeStyle = "rgba(148, 163, 184, 0.3)"; ctx.moveTo(centerX, sy); ctx.lineTo(centerX, sy + 60); ctx.stroke(); ctx.setLineDash([]);
                    drawAngleDim(ctx, centerX, sy, s.tilt, s.tilt, 70, "#22d3ee", true);
                    const distH = s.height * Math.tan(tr);
                    drawDimLine(ctx, centerX, floorY + 20, axisX, floorY + 20, `d: ${distH.toFixed(2)}m`);
                }

                const hitXFloor = centerX + (s.height * scale) * Math.tan(tr);
                ctx.beginPath(); ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(251, 191, 36, 0.4)"; ctx.moveTo(centerX, sy); ctx.lineTo(hitXFloor, floorY); ctx.stroke(); ctx.setLineDash([]);
                ctx.beginPath(); ctx.arc(hitXFloor, floorY, 4, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill();
                drawTextVal(ctx, Math.round(luxFloor) + " Lux", hitXFloor, floorY - 10); 

                if (hEff > 0) { 
                    const ix = centerX + (hEff * scale) * Math.tan(tr); 
                    ctx.beginPath(); ctx.arc(ix, py, 3, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill(); 
                    drawTextVal(ctx, Math.round(luxPlane) + " Lux", ix, py - 10); 
                }

                const xL = (floorY - sy) * Math.tan(tr - br / 2), xR = (floorY - sy) * Math.tan(tr + br / 2); 
                drawDimLine(ctx, centerX + xL, floorY + 45, centerX + xR, floorY + 45, `Ø ${dia.toFixed(2)}m`);
                const xL_p = (py - sy) * Math.tan(tr - br / 2); const xR_p = (py - sy) * Math.tan(tr + br / 2); const diaPlane = Math.abs((xR_p - xL_p) / scale);
                drawDimLine(ctx, centerX + xL_p, py + 20, centerX + xR_p, py + 20, `Ø ${diaPlane.toFixed(2)}m`);
                
            } else if (window.currentTool === 'vertical') {
                const I = getIntensity(s), sy = floorY - (s.height * scale), wx = centerX + (s.dist * scale), tr = s.tilt * Math.PI / 180, br = s.beam * Math.PI / 180;
                
                let ev = 0; if (s.tilt > 0) ev = (I * Math.pow(Math.sin(tr), 3)) / (s.dist * s.dist);
                let hitY_metric = s.height - (s.dist / Math.tan(tr)); let hitY_px = floorY - (hitY_metric * scale);

                drawFloor(ctx, cw, floorY, 'vertical'); 
                ctx.beginPath(); ctx.moveTo(wx, floorY); ctx.lineTo(wx, floorY - (s.height * scale * 1.5)); ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 3; ctx.stroke(); ctx.lineWidth = 2; 
                drawSource(ctx, centerX, sy);
                
                const hqY = floorY - (s.hq * scale);
                ctx.beginPath(); ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(148, 163, 184, 0.4)"; ctx.moveTo(0, hqY); ctx.lineTo(wx, hqY); ctx.stroke(); ctx.setLineDash([]);
                ctx.fillStyle = "#94a3b8"; ctx.font = "11px Manrope"; ctx.textAlign = "left"; ctx.fillText(`hq: ${s.hq.toFixed(2)}m`, 10, hqY - 5);

                ctx.save(); ctx.beginPath(); ctx.rect(0, -1000, wx, floorY + 1000); ctx.clip(); drawBeam(ctx, floorY, centerX, sy, s.beam, s.tilt, scale); ctx.restore();
                drawAngleDim(ctx, centerX, sy, s.beam, s.tilt, 40, "rgba(251, 191, 36, 0.8)", false);

                if (s.tilt > 0) {
                    const axisX = centerX + (s.height * scale) * Math.tan(tr);
                    ctx.beginPath(); ctx.setLineDash([5, 3, 2, 3]); ctx.strokeStyle = "rgba(148, 163, 184, 0.5)"; ctx.moveTo(centerX, sy); ctx.lineTo(centerX + (s.height * scale * 2) * Math.tan(tr), floorY + (s.height * scale)); ctx.stroke(); ctx.setLineDash([]);
                    ctx.beginPath(); ctx.setLineDash([2, 2]); ctx.strokeStyle = "rgba(148, 163, 184, 0.3)"; ctx.moveTo(centerX, sy); ctx.lineTo(centerX, sy + 60); ctx.stroke(); ctx.setLineDash([]);
                    drawAngleDim(ctx, centerX, sy, s.tilt, s.tilt, 70, "#22d3ee", true);
                }

                if (s.tilt > 0) {
                    ctx.beginPath(); ctx.moveTo(centerX, sy); ctx.lineTo(wx, hitY_px); ctx.strokeStyle = "rgba(255, 255, 255, 0.4)"; ctx.setLineDash([4, 4]); ctx.stroke(); ctx.setLineDash([]);
                     if (hitY_metric > -10 && hitY_metric < s.height * 3) {
                        ctx.beginPath(); ctx.arc(wx, hitY_px, 3, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill();
                        ctx.beginPath(); ctx.moveTo(wx, hitY_px); ctx.lineTo(wx + 40, hitY_px); ctx.strokeStyle = "#FBBF24"; ctx.setLineDash([2, 2]); ctx.stroke(); ctx.setLineDash([]);
                        drawTextVal(ctx, Math.round(ev) + " Lux", wx - 40, hitY_px);
                        
                        const angleTop = tr + br/2;
                        if(angleTop < Math.PI/2) {
                            const yTopMetric = s.height - (s.dist / Math.tan(angleTop));
                            if(yTopMetric > 0 && yTopMetric < s.height * 2) {
                                const yTopPx = floorY - (yTopMetric * scale);
                                drawDimLineVertical(ctx, wx - 15, yTopPx, floorY, `hMax: ${yTopMetric.toFixed(2)}m`);
                            }
                        }
                     }
                    const hitXFloor = centerX + (s.height * scale) * Math.tan(tr);
                    if (hitXFloor < wx) { ctx.beginPath(); ctx.arc(hitXFloor, floorY, 4, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill(); }
                }
                
                drawHeightLine(ctx, centerX, sy, parseFloat(s.height), 12);
                drawDimLine(ctx, centerX, sy - 30, wx, sy - 30, `d: ${parseFloat(s.dist).toFixed(1)}m`);
                drawDimLineVertical(ctx, wx + 15, floorY, hqY, `hq: ${parseFloat(s.hq).toFixed(1)}m`); 

            } else if (window.currentTool === 'homog') {
                const I = getIntensity(window.state.homog); 
                const sy = floorY - (s.height * scale); const py = floorY - (s.workPlane * scale);
                const hS = (s.spacing * scale) / 2; const br = s.beam * Math.PI / 180; const tl = 0; 
                
                const dia = 2 * s.height * Math.tan(br / 2);
                const hEff = s.height - s.workPlane;
                const diaPlane = hEff > 0 ? 2 * hEff * Math.tan(br / 2) : 0;
                
                const luxFloor = I / (s.height ** 2);
                const luxPlane = hEff > 0 ? I / (hEff ** 2) : 0;

                const leftX = centerX - hS; const rightX = centerX + hS;

                drawFloor(ctx, cw, floorY, 'homog'); drawPlaneLine(ctx, cw, py, `hp: ${s.workPlane}m`); 
                drawSource(ctx, leftX, sy); drawSource(ctx, rightX, sy); 
                drawBeam(ctx, floorY, leftX, sy, s.beam, tl, scale, 0.6); drawBeam(ctx, floorY, rightX, sy, s.beam, -tl, scale, 0.6); 
                drawAngleDim(ctx, leftX, sy, s.beam, tl, 40, "rgba(251, 191, 36, 0.8)", false);
                
                ctx.beginPath(); ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(255,255,255,0.2)"; 
                ctx.moveTo(leftX, sy); ctx.lineTo(leftX, floorY); ctx.moveTo(rightX, sy); ctx.lineTo(rightX, floorY); 
                ctx.stroke(); ctx.setLineDash([]);

                drawHeightLine(ctx, leftX, sy, parseFloat(s.height)); 
                drawDimLine(ctx, leftX, sy - 20, rightX, sy - 20, `D: ${parseFloat(s.spacing).toFixed(1)}m`);

                ctx.beginPath(); ctx.arc(leftX, floorY, 4, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill();
                drawTextVal(ctx, Math.round(luxFloor) + " Lux", leftX, floorY - 10);

                if (hEff > 0) {
                    ctx.beginPath(); ctx.arc(leftX, py, 3, 0, Math.PI * 2); ctx.fillStyle = "#FBBF24"; ctx.fill();
                    drawTextVal(ctx, Math.round(luxPlane) + " Lux", leftX, py - 10);
                }

                const xL_f = leftX - (dia * scale / 2); const xR_f = leftX + (dia * scale / 2);
                drawDimLine(ctx, xL_f, floorY + 20, xR_f, floorY + 20, `Ø ${dia.toFixed(2)}m`);

                if (hEff > 0) {
                    const xL_p = leftX - (diaPlane * scale / 2); const xR_p = leftX + (diaPlane * scale / 2);
                    drawDimLine(ctx, xL_p, py + 20, xR_p, py + 20, `Ø ${diaPlane.toFixed(2)}m`);
                }
            }
        }

        // --- BINDING & INIT ---
        function bind(id, key, param) { 
            const el = document.getElementById(id); if(!el) return; 
            el.addEventListener('input', (e) => { 
                let val = parseFloat(e.target.value); 
                const pairId = id.includes('range') ? id.replace('range-', '') : 'range-' + id, pairEl = document.getElementById(pairId); 
                if(pairEl) pairEl.value = val; 
                window.state[key][param] = val; window.updateCalculations(); 
            }); 
        }

        ['ponto', 'vertical', 'homog'].forEach(key => {
            ['intensity', 'height', 'beam', 'tilt', 'workPlane', 'dist', 'spacing', 'flux', 'cdklm', 'hq'].forEach(param => {
                bind(`${key[0]}-${param}`, key, param); bind(`range-${key[0]}-${param}`, key, param);
            });
        });

        // Norms Database & Query Logic
        const normsDatabase = [
            { cat: "Escritório", room: "Escrita, digitação, leitura", lux: 500, ugr: 19, ra: 80 },
            { cat: "Indústria", room: "Trabalho de precisão", lux: 1000, ugr: 19, ra: 80 },
            { cat: "Varejo", room: "Área de vendas geral", lux: 300, ugr: 22, ra: 80 },
            { cat: "Educação", room: "Salas de aula", lux: 300, ugr: 19, ra: 80 }
        ];

        window.filterNorms = function() {
            const tbody = document.getElementById('nbr8995-tbody'); tbody.innerHTML = "";
            normsDatabase.forEach(n => { tbody.innerHTML += `<tr class="hover:bg-white/5 transition-colors border-b border-white/5"><td class="p-4 font-bold text-luminous-gold text-xs uppercase">${n.cat}</td><td class="p-4 text-dim-gray">${n.room}</td><td class="p-4 text-center font-bold text-white bg-white/5">${n.lux}</td><td class="p-4 text-center text-muted-blue">${n.ugr}</td><td class="p-4 text-center text-muted-blue">${n.ra}</td></tr>`; });
        }

        window.AuthManager.init();
        window.switchTool('query');
        window.addEventListener('resize', () => setTimeout(window.updateCalculations, 100));

    </script>
</body>
</html>